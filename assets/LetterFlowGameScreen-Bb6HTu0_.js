import{_ as o,u as Dt,a as Ot,b as xt,c as gt,r as w,j as g,f as st}from"./index-CPFhwo1J.js";import{s as Vt,u as $t,a as Ct,N as Mt}from"./Notification-DnCPIT6y.js";import{G as kt}from"./GameControls-GzEqOEM7.js";import{G as St}from"./GameLayout-DrUlvt8n.js";import"./GameButton-Cx9sHjkM.js";import"./circle-check-big-BANamxNY.js";function Nt(r,a,c=70,d=50){if(a<=0)return`hsl(0, ${c}%, ${d}%)`;const y=Math.round(r*360/a)%360,L=d>50?d*.9:d*1.1;return`hsl(${y}, ${c}%, ${L}%)`}class Ft{async loadLevels(a){const{language:c,difficulty:d}=a;if(!d)return[];try{const y=`/src/data/${c}/letter-flow/${c}-flow-${d}.json`,O=Object.assign({"/src/data/ar/clue/animals/easy.json":()=>o(()=>import("./easy-B_GJKLA_.js"),[]),"/src/data/ar/clue/animals/hard.json":()=>o(()=>import("./hard-7EfMbXs4.js"),[]),"/src/data/ar/clue/animals/medium.json":()=>o(()=>import("./medium-Bcn1oCUk.js"),[]),"/src/data/ar/clue/geography/easy.json":()=>o(()=>import("./easy-B_kcdeCx.js"),[]),"/src/data/ar/clue/geography/hard.json":()=>o(()=>import("./hard-BCuCMNGp.js"),[]),"/src/data/ar/clue/geography/medium.json":()=>o(()=>import("./medium-CkoNY3Du.js"),[]),"/src/data/ar/clue/science/easy.json":()=>o(()=>import("./easy-f07zg_lU.js"),[]),"/src/data/ar/clue/science/hard.json":()=>o(()=>import("./hard-CV32qLEY.js"),[]),"/src/data/ar/clue/science/medium.json":()=>o(()=>import("./medium-BtIrOjNp.js"),[]),"/src/data/ar/formation/ar-formation-easy.json":()=>o(()=>import("./ar-formation-easy-CuHzQLY1.js"),[]),"/src/data/ar/formation/ar-formation-hard.json":()=>o(()=>import("./ar-formation-hard-CRxFgu7h.js"),[]),"/src/data/ar/image-clue/animals/data.json":()=>o(()=>import("./data-USJTiWy0.js"),[]),"/src/data/ar/image-clue/fruits-and-vegetables/data.json":()=>o(()=>import("./data-DlhJ3pZw.js"),[]),"/src/data/ar/image-clue/shapes/data.json":()=>o(()=>import("./data-B126H-NP.js"),[]),"/src/data/ar/letter-flow/ar-flow-easy.json":()=>o(()=>import("./ar-flow-easy-C68xgLTr.js"),[]),"/src/data/ar/letter-flow/ar-flow-medium.json":()=>o(()=>import("./ar-flow-medium-BL27Zp8Y.js"),[]),"/src/data/ar/outside-the-story/animals.json":()=>o(()=>import("./animals-BD_uC3F6.js"),[]),"/src/data/ar/outside-the-story/anime.json":()=>o(()=>import("./anime-X9XTb-jh.js"),[]),"/src/data/ar/outside-the-story/cars.json":()=>o(()=>import("./cars-LFoQ5kcr.js"),[]),"/src/data/ar/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-9ln4fVtF.js"),[]),"/src/data/ar/outside-the-story/characters.json":()=>o(()=>import("./characters-BClrgWDD.js"),[]),"/src/data/ar/outside-the-story/clothes.json":()=>o(()=>import("./clothes-DZukcyjc.js"),[]),"/src/data/ar/outside-the-story/drinks.json":()=>o(()=>import("./drinks-DWTisQdZ.js"),[]),"/src/data/ar/outside-the-story/foods.json":()=>o(()=>import("./foods-BPEl4jwc.js"),[]),"/src/data/ar/outside-the-story/football.json":()=>o(()=>import("./football-BkDTW0je.js"),[]),"/src/data/ar/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-CWZ59ral.js"),[]),"/src/data/ar/outside-the-story/gamers.json":()=>o(()=>import("./gamers-DU27ka0Y.js"),[]),"/src/data/ar/outside-the-story/geography.json":()=>o(()=>import("./geography-Bmt1Mp9F.js"),[]),"/src/data/ar/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-CvncURYW.js"),[]),"/src/data/ar/outside-the-story/science.json":()=>o(()=>import("./science-C1rxd0mO.js"),[]),"/src/data/ar/outside-the-story/series.json":()=>o(()=>import("./series-DgCSJJru.js"),[]),"/src/data/ar/outside-the-story/spy.json":()=>o(()=>import("./spy-CTUdze8o.js"),[]),"/src/data/ar/outside-the-story/sweets.json":()=>o(()=>import("./sweets-0_2hbNMS.js"),[]),"/src/data/ar/picture-choice/animals/data.json":()=>o(()=>import("./data-6hZ_2-dK.js"),[]),"/src/data/ar/word-choice/animals/data.json":()=>o(()=>import("./data-Bij5nysW.js"),[]),"/src/data/en/clue/animals/easy.json":()=>o(()=>import("./easy-vc2CgBiI.js"),[]),"/src/data/en/clue/animals/hard.json":()=>o(()=>import("./hard-BmQiyFGH.js"),[]),"/src/data/en/clue/animals/medium.json":()=>o(()=>import("./medium-CDppU-oU.js"),[]),"/src/data/en/clue/geography/easy.json":()=>o(()=>import("./easy-v49lXgS1.js"),[]),"/src/data/en/clue/geography/hard.json":()=>o(()=>import("./hard-Hc9ZYG1D.js"),[]),"/src/data/en/clue/geography/medium.json":()=>o(()=>import("./medium-Yt4_5ZKV.js"),[]),"/src/data/en/clue/science/easy.json":()=>o(()=>import("./easy-CXDUIzZm.js"),[]),"/src/data/en/clue/science/hard.json":()=>o(()=>import("./hard-BPi6SzUA.js"),[]),"/src/data/en/clue/science/medium.json":()=>o(()=>import("./medium-Dm_81XWt.js"),[]),"/src/data/en/formation/en-formation-easy.json":()=>o(()=>import("./en-formation-easy-CqPS8TrH.js"),[]),"/src/data/en/image-clue/animals/data.json":()=>o(()=>import("./data-BYo_61tt.js"),[]),"/src/data/en/image-clue/fruits-and-vegetables/data.json":()=>o(()=>import("./data-B6FoT8eG.js"),[]),"/src/data/en/image-clue/shapes/data.json":()=>o(()=>import("./data-Bu1Ld6Qx.js"),[]),"/src/data/en/letter-flow/en-flow-easy.json":()=>o(()=>import("./en-flow-easy-DqbTaQjR.js"),[]),"/src/data/en/outside-the-story/animals.json":()=>o(()=>import("./animals-D78oH89-.js"),[]),"/src/data/en/outside-the-story/anime.json":()=>o(()=>import("./anime-DXIlEidq.js"),[]),"/src/data/en/outside-the-story/cars.json":()=>o(()=>import("./cars-Cw03Nxyo.js"),[]),"/src/data/en/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-DwVIQVvA.js"),[]),"/src/data/en/outside-the-story/characters.json":()=>o(()=>import("./characters-Dl2vwTPn.js"),[]),"/src/data/en/outside-the-story/clothes.json":()=>o(()=>import("./clothes-BiLKpCWj.js"),[]),"/src/data/en/outside-the-story/drinks.json":()=>o(()=>import("./drinks-CP1Emjyy.js"),[]),"/src/data/en/outside-the-story/foods.json":()=>o(()=>import("./foods-BKBSmJG2.js"),[]),"/src/data/en/outside-the-story/football.json":()=>o(()=>import("./football-B8eU_HgW.js"),[]),"/src/data/en/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-B5narx4J.js"),[]),"/src/data/en/outside-the-story/gamers.json":()=>o(()=>import("./gamers-Dm5Tu0YA.js"),[]),"/src/data/en/outside-the-story/geography.json":()=>o(()=>import("./geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-BnHY6_tE.js"),[]),"/src/data/en/outside-the-story/science.json":()=>o(()=>import("./science-DF1sazzy.js"),[]),"/src/data/en/outside-the-story/series.json":()=>o(()=>import("./series-dqakDLa9.js"),[]),"/src/data/en/outside-the-story/spy.json":()=>o(()=>import("./spy-DLpfZG_H.js"),[]),"/src/data/en/outside-the-story/sweets.json":()=>o(()=>import("./sweets-DDZ5JqsI.js"),[]),"/src/data/en/picture-choice/animals/data.json":()=>o(()=>import("./data-CtXqoHRL.js"),[]),"/src/data/en/word-choice/animals/data.json":()=>o(()=>import("./data-BDxquZu-.js"),[])})[y];return O?((await O()).default?.levels||[]).map(u=>{if(typeof u=="object"&&u!==null&&"id"in u&&"solutionWord"in u&&"gridSize"in u&&"endpoints"in u){const{width:b,height:i}=u.gridSize,V=[];for(let m=0;m<i;m++)for(let t=0;t<b;t++)V.push({x:t,y:m,letter:"",isUsed:!1});const N=u.endpoints,$=Array.from(new Set(N.map(m=>m.letter))),R=new Map;$.forEach((m,t)=>{R.set(m,Nt(t,$.length,72,48))}),N.forEach(m=>{const t=m.y*b+m.x,s=R.get(m.letter);t<V.length&&(V[t]={x:m.x,y:m.y,letter:m.letter,isUsed:!1,color:s})});const x=u;return{id:String(x.id),difficulty:d,words:[x.solutionWord],board:V,solution:x.solutionWord,endpoints:x.endpoints.map(m=>({...m,color:R.get(m.letter)}))}}return null}).filter(u=>u!==null):[]}catch(y){return console.error(`LetterFlowGameEngine: Failed to load levels for ${c}/${d}.`,y),[{id:"error",difficulty:"easy",words:[],board:[],solution:"",endpoints:[]}]}}generateBoard(a,c,d,y){if(!y)return[];const L=Vt(y.split("")),O=Math.ceil(Math.sqrt(L.length)),M=[];for(let S=0;S<O;S++)for(let u=0;u<O;u++){const b=S*O+u;b<L.length&&M.push({x:u,y:S,letter:L[b],isUsed:!1})}return M}}const pt=new Ft,ut=24;function Ut(r,a=ut,c=68,d=48){return`hsl(${Math.round(r*360/a)%360}, ${c}%, ${d}%)`}function Et(r){if(!r)return;let a=0;const c=r.toUpperCase();for(let y=0;y<c.length;y++)a=(a<<5)-a+c.charCodeAt(y),a|=0;const d=Math.abs(a)%ut;return Ut(d,ut)}function Bt(){const r=Dt(),a=Ot(),{language:c,categories:d,difficulty:y,gameMode:L,teams:O,currentTeam:M,consumeHint:S}=xt(),{t:u}=gt(),{loading:b,currentLevel:i,currentLevelIndex:V,nextLevel:N}=$t(pt,{language:c,categories:d,difficulty:y}),[$,R]=w.useState([]),[x,m]=w.useState([]),[t,s]=w.useState([]),[C,A]=w.useState(null),[f,_]=w.useState(null),[E,k]=w.useState("playing");w.useEffect(()=>{if(i){if(i.board&&i.board.length>0&&i.board.some(e=>e.letter))R(i.board.map(e=>({...e})));else{const e=pt.generateBoard("",i.difficulty,c,i.board.map(n=>n.letter).join(""));R(e)}s([]),m([]),_(null),k("playing")}},[i,c]);const v=w.useMemo(()=>[...new Set(i?.endpoints.map(e=>e.letter)||[])],[i]),j=w.useMemo(()=>{const e=new Map;return i?.endpoints.forEach(n=>e.set(`${n.x}-${n.y}`,n.color)),e},[i]),q=w.useCallback(e=>{if(e)return Et(e)},[]),H=w.useCallback(e=>i?i.endpoints.some(n=>n.x===e.x&&n.y===e.y&&n.letter===e.letter):!1,[i]),_t=w.useCallback((e,n)=>{const h=Math.abs(e.x-n.x),I=Math.abs(e.y-n.y);return h===1&&I===0||h===0&&I===1},[]),mt=w.useCallback(e=>{if(e.length<2)return!0;for(let n=1;n<e.length;n++)if(!_t(e[n-1],e[n]))return!1;return!0},[_t]),ft=w.useCallback((e,n,h)=>{if(!e.letter){if(e.isUsed){if(h){const I=t.find(F=>F.word===h);if(I&&I.cells.some(F=>F.x===e.x&&F.y===e.y))return!1}return!0}return!1}return!(n&&e.x===n.x&&e.y===n.y||h&&e.letter===h&&H(e))},[t,H]),ot=w.useCallback(e=>t.length===0?[]:t.filter(n=>n.cells.some(h=>e.some(I=>I.x===h.x&&I.y===h.y))),[t]),D=w.useCallback((e,n=1200)=>{A(e),n>0&&setTimeout(()=>A(null),n)},[]),vt=w.useCallback(e=>{if(!H(e))return;const n=t.find(h=>h.word===e.letter);n&&(s(h=>h.filter(I=>I.word!==e.letter)),R(h=>h.map(I=>{const F=n.cells.some(U=>U.x===I.x&&U.y===I.y),G=j.get(`${I.x}-${I.y}`);return F?{...I,isUsed:!1,color:G??void 0}:I})),D(`Removed connection for ${e.letter}`,900)),_(e.letter),m([e])},[t,H,D,j]),jt=w.useCallback(e=>{if(!f||x.length===0)return;const n=x[0]||null;if(ft(e,n,f)||!(e.letter===f||e.letter===""))return;const h=x[x.length-1];if(h&&h.x===e.x&&h.y===e.y)return;const I=Math.abs(e.x-h.x),F=Math.abs(e.y-h.y);if(I===1&&F===1||I>1||F>1)return;const G=x.findIndex(X=>X.x===e.x&&X.y===e.y);if(G!==-1){m(X=>X.slice(0,G+1));return}if(e.isUsed)return;const U=[...x,e];if(!mt(U))return;if(H(e)&&!(x.length>0&&x[0].x===e.x&&x[0].y===e.y)&&e.letter===f){const X=ot(U);X.length>0&&(s(T=>T.filter(P=>!X.includes(P))),R(T=>T.map(P=>{const K=X.some(Q=>Q.cells.some(Z=>Z.x===P.x&&Z.y===P.y)),et=j.get(`${P.x}-${P.y}`);return K?{...P,isUsed:!1,color:et??void 0}:P})),D("Existing connection(s) removed by new connection",1100));const rt=$.find(T=>T.x===U[0].x&&T.y===U[0].y)?.color||q(U[0].letter);R(T=>T.map(P=>{const K=U.some(Q=>Q.x===P.x&&Q.y===P.y),et=j.get(`${P.x}-${P.y}`);return K?{...P,isUsed:!0,color:et??rt}:P}));const it={word:f,cells:U.map(T=>{const P=$.find(K=>K.x===T.x&&K.y===T.y);return{...T,color:P&&P.color||rt}}),startIndex:0};s(T=>[...T.filter(K=>K.word!==f),it]),D(`Connected ${f}`,900),_(null),m([]);const dt=[...t.map(T=>T.word),f].filter(Boolean),tt=Array.from(new Set(dt));v.every(T=>tt.includes(T))&&(D(u.congrats,2e3),L==="competitive"?setTimeout(()=>N(),2e3):k("won"))}else m(U)},[f,x,ft,H,mt,ot,$,q,t,v,N,u,D,j,L]),wt=w.useCallback(()=>{if(x.length>0){const e=x[x.length-1];H(e)&&!(x.length>1&&x[0].x===e.x&&x[0].y===e.y)&&e.letter===f||(_(null),m([]),D("Path must connect two endpoints!",1200))}},[x,H,f,D]),It=w.useCallback(()=>{if(!i||t.length>=i.endpoints.length/2)return;if(L==="competitive"&&!S(O[M].id)){D(u.noHintsLeft,2e3);return}const e=v.filter(l=>!t.some(p=>p.word===l));if(e.length===0)return;const n=e[0],h=i.endpoints.filter(l=>l.letter===n);if(h.length<2){D(`No endpoints found for ${n}`,1500);return}const I=h[0],F=h[1],G=new Map;$.forEach(l=>G.set(`${l.x}-${l.y}`,l));const U=$.map(l=>l.x),at=$.map(l=>l.y),X=Math.min(...U),rt=Math.max(...U),it=Math.min(...at),dt=Math.max(...at),tt=`${I.x}-${I.y}`,ct=`${F.x}-${F.y}`,T=[tt],P=new Set([tt]),K=new Map;K.set(tt,null);const et=(l,p)=>{const B=`${l}-${p}`,Y=G.get(B);return Y?!Y.letter||Y.letter===n:!1},Q=l=>{const[p,B]=l.split("-").map(z=>parseInt(z,10));return[[p+1,B],[p-1,B],[p,B+1],[p,B-1]].filter(([z,J])=>z>=X&&z<=rt&&J>=it&&J<=dt).map(([z,J])=>`${z}-${J}`)};let Z=!1;for(;T.length>0&&!Z;){const l=T.shift();if(l===ct){Z=!0;break}for(const p of Q(l)){if(P.has(p))continue;const[B,Y]=p.split("-").map(z=>parseInt(z,10));et(B,Y)&&(P.add(p),K.set(p,l),T.push(p))}}if(!Z){D(`No path found for ${n}`,1600);return}const W=[];let nt=ct;for(;nt;){const l=G.get(nt);if(!l)break;W.push({...l}),nt=K.get(nt)??null}W.reverse();const lt=ot(W);lt.length>0&&(s(l=>l.filter(p=>!lt.includes(p))),R(l=>l.map(p=>{const B=lt.some(z=>z.cells.some(J=>J.x===p.x&&J.y===p.y)),Y=j.get(`${p.x}-${p.y}`);return B?{...p,isUsed:!1,color:Y??void 0}:p})),D("Existing connection(s) removed by hint connection",1100));const ht=G.get(`${W[0].x}-${W[0].y}`)?.color||q(W[0].letter);R(l=>l.map(p=>{const B=W.some(z=>z.x===p.x&&z.y===p.y),Y=j.get(`${p.x}-${p.y}`);return B?{...p,isUsed:!0,color:Y??ht}:p}));const At={word:n,cells:W.map(l=>{const p=G.get(`${l.x}-${l.y}`);return{...l,color:p&&p.color||ht}}),startIndex:0};s(l=>[...l.filter(B=>B.word!==n),At]),D(`Hint: Connected ${n}`,900),_(null),m([]);const bt=[...t.map(l=>l.word),n].filter(Boolean),Rt=Array.from(new Set(bt));v.every(l=>Rt.includes(l))&&(D(u.congrats,2e3),L==="competitive"?setTimeout(()=>N(),2e3):k("won"))},[i,$,t,v,j,q,ot,D,L,O,M,S,u,N]),Lt=w.useCallback(()=>{if(t.length===0)return;const e=t[t.length-1];s(n=>n.slice(0,-1)),R(n=>n.map(h=>{if(!e.cells.some(G=>G.x===h.x&&G.y===h.y))return h;const F=j.get(`${h.x}-${h.y}`);return{...h,isUsed:!1,color:F??void 0}})),m([]),_(null),D(`Undo: Removed connection for ${e.word}`),E==="won"&&k("playing")},[t,D,j,E]),Tt=w.useCallback(()=>{s([]),R(e=>e.map(n=>{const h=j.get(`${n.x}-${n.y}`);return{...n,isUsed:!1,color:h}})),m([]),_(null),k("playing"),D("Game reset - all connections removed")},[D,j]),Pt=w.useCallback(()=>{r(L==="competitive"?`/team-config/${a.gameType}`:`/game-mode/${a.gameType}`)},[r,a.gameType,L]);return{loading:b,currentLevel:i,currentLevelIndex:V,board:$,selectedPath:x,foundWords:t,notification:C,gameState:E,isChecking:!1,activeLetter:f,isDrawing:!!f,handleBack:Pt,handleMouseDown:vt,handleMouseEnter:jt,handleMouseUp:wt,clearSelection:()=>{m([]),_(null)},onHint:It,onUndo:Lt,onReset:Tt}}function Gt({letter:r,x:a,y:c,isSelected:d=!1,isFound:y=!1,isActive:L=!1,onMouseDown:O,onMouseEnter:M,onMouseUp:S,disabled:u=!1,className:b,connectionDirections:i=[],connectionColor:V,cellColor:N}){const $=w.useRef(null),R=E=>{u||(E.target?.setPointerCapture?.(E.pointerId),O?.({x:a,y:c,letter:r}),E.preventDefault())},x=E=>{if(u)return;const v=document.elementFromPoint(E.clientX,E.clientY)?.closest?.("[data-cell-x]");if(v){const j=parseInt(v.getAttribute("data-cell-x")||"0",10),q=parseInt(v.getAttribute("data-cell-y")||"0",10);M?.({x:j,y:q,letter:v.textContent?.trim()||""})}},m=E=>{try{E.target?.releasePointerCapture?.(E.pointerId)}catch(k){console.debug("releasePointerCapture failed",k)}S?.()},t=E=>{if(u)return;E.preventDefault();const k=E.touches[0],v=document.elementFromPoint(k.clientX,k.clientY);if(v&&v.getAttribute("data-cell-x")&&v.getAttribute("data-cell-y")){const j=parseInt(v.getAttribute("data-cell-x")||"0"),q=parseInt(v.getAttribute("data-cell-y")||"0"),H=v.textContent?.trim()||"";O?.({x:j,y:q,letter:H})}},s=E=>{if(u)return;E.preventDefault();const k=E.touches[0],v=document.elementFromPoint(k.clientX,k.clientY);if(v&&v.getAttribute("data-cell-x")&&v.getAttribute("data-cell-y")){const j=parseInt(v.getAttribute("data-cell-x")||"0"),q=parseInt(v.getAttribute("data-cell-y")||"0"),H=v.textContent?.trim()||"";M?.({x:j,y:q,letter:H})}},C=E=>{u||(E.preventDefault(),S?.())},A=E=>{u||(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),O?.({x:a,y:c,letter:r}))},f=56,_=V??N??void 0;return g.jsxs("div",{ref:$,role:"button",tabIndex:u?-1:0,"aria-disabled":u,"aria-pressed":d||void 0,"data-cell-x":a,"data-cell-y":c,onPointerDown:R,onPointerMove:x,onPointerUp:m,onTouchStart:t,onTouchMove:s,onTouchEnd:C,onKeyDown:A,className:st("aspect-square flex items-center justify-center rounded-md text-xl font-bold select-none relative transition-all duration-150",{"bg-gray-50 dark:bg-gray-800":!d&&!y&&!L,"cursor-not-allowed opacity-70":u,"text-gray-900 dark:text-gray-100":!d&&!y&&!L&&!_},b),children:[i.includes("top")&&g.jsx("div",{"aria-hidden":!0,className:"absolute top-0 left-1/2 transform -translate-x-1/2",style:{width:`${Math.max(6,f*.08)}%`,height:"40%",background:V,borderRadius:4,zIndex:0}}),i.includes("bottom")&&g.jsx("div",{"aria-hidden":!0,className:"absolute bottom-0 left-1/2 transform -translate-x-1/2",style:{width:`${Math.max(6,f*.08)}%`,height:"40%",background:V,borderRadius:4,zIndex:0}}),i.includes("left")&&g.jsx("div",{"aria-hidden":!0,className:"absolute left-0 top-1/2 transform -translate-y-1/2",style:{height:`${Math.max(6,f*.08)}%`,width:"40%",background:V,borderRadius:4,zIndex:0}}),i.includes("right")&&g.jsx("div",{"aria-hidden":!0,className:"absolute right-0 top-1/2 transform -translate-y-1/2",style:{height:`${Math.max(6,f*.08)}%`,width:"40%",background:V,borderRadius:4,zIndex:0}}),g.jsx("div",{className:"flex items-center justify-center rounded-full z-10",style:{width:`${f}%`,height:`${f}%`,background:_??"#ffffff",boxShadow:_?"0 2px 8px rgba(0,0,0,0.12)":void 0,border:_?"none":"1px solid rgba(0,0,0,0.06)"},children:r?g.jsx("span",{className:"text-sm font-bold",style:{color:_||d||y||L?"#fff":"#111"},children:r}):null})]})}function yt(r){return Et(r)}function zt({cells:r,selectedPath:a,foundWords:c,activeLetter:d,onMouseDown:y,onMouseEnter:L,onMouseUp:O,className:M,dir:S="ltr"}){const u=r.length===0?0:Math.max(...r.map(t=>t.x))+1,b=S==="rtl",i=t=>`${t.x}-${t.y}`,V=new Map;a.forEach(t=>V.set(i(t),t));const N=new Map;c.forEach(t=>t.cells.forEach(s=>N.set(i(s),{word:t.word,cells:t.cells})));const $=t=>{const s=[],C=[...c.map(A=>A.cells),a];for(const A of C){const f=A.findIndex(_=>_.x===t.x&&_.y===t.y);if(f!==-1){if(f>0){const _=A[f-1];_.x===t.x-1&&_.y===t.y&&s.push("left"),_.x===t.x+1&&_.y===t.y&&s.push("right"),_.x===t.x&&_.y===t.y-1&&s.push("top"),_.x===t.x&&_.y===t.y+1&&s.push("bottom")}if(f<A.length-1){const _=A[f+1];_.x===t.x-1&&_.y===t.y&&s.push("left"),_.x===t.x+1&&_.y===t.y&&s.push("right"),_.x===t.x&&_.y===t.y-1&&s.push("top"),_.x===t.x&&_.y===t.y+1&&s.push("bottom")}}}return[...new Set(s)]},R=t=>{for(const s of c)if(s.cells.some(C=>C.x===t.x&&C.y===t.y)){const C=s.cells[0]?.color??s.cells.find(f=>f.color)?.color;if(C)return C;const A=r.find(f=>f.x===s.cells[0].x&&f.y===s.cells[0].y);return A?.color?A.color:yt(s.word)}if(a&&a.length>0&&a.some(s=>s.x===t.x&&s.y===t.y)){const s=a[0];if(s?.color)return s.color;const C=r.find(A=>A.x===s.x&&A.y===s.y);return C?.color?C.color:yt(s?.letter)}if(t.color)return t.color},x=t=>V.has(i(t)),m=t=>N.has(i(t));return g.jsx("div",{className:st("grid gap-1 mx-auto max-w-md",M,{"rtl-direction":b}),style:{gridTemplateColumns:`repeat(${u}, minmax(0, 1fr))`,direction:b?"rtl":"ltr",touchAction:"none"},children:r.map(t=>{const s=$(t),C=R(t),A=m(t)||t.letter!==""&&t.letter!==d&&t.isUsed;return g.jsx(Gt,{letter:t.letter,x:t.x,y:t.y,isSelected:x(t),isFound:m(t),isActive:d&&t.letter===d?!0:void 0,onMouseDown:y,onMouseEnter:L,onMouseUp:O,disabled:A,connectionDirections:s,connectionColor:C,cellColor:t.color},`${t.x}-${t.y}`)})})}function Ht({foundWords:r,t:a,className:c}){return r.length===0?null:g.jsxs("div",{className:st("mt-6",c),children:[g.jsxs("div",{className:"text-lg font-semibold mb-2",children:[a.selected,":"]}),g.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((d,y)=>g.jsx("div",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-md",children:d.word},y))})]})}function Kt({foundWords:r,totalWords:a,t:c,className:d}){const y=r.length/a;return g.jsxs("div",{className:st("mt-6 text-center",d),children:[g.jsxs("div",{className:"text-gray-600",children:[c.selected," ",r.length," ",c.of," ",a]}),g.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:g.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-500",style:{width:`${y*100}%`}})})]})}function qt(){w.useEffect(()=>{const r=EventTarget.prototype.addEventListener;return EventTarget.prototype.addEventListener=function(a,c,d){if((a==="touchmove"||a==="touchstart"||a==="touchend")&&typeof d=="object"&&d&&!("passive"in d)){const y={...d,passive:!1};return r.call(this,a,c,y)}return r.call(this,a,c,d)},()=>{EventTarget.prototype.addEventListener=r}},[])}const ee=()=>{const{t:r,i18n:a}=gt(),c=a.dir(),d=Ct("letterFlow"),y=d?{title:d.title??"",description:d.description??"",steps:d.steps??[]}:void 0;qt();const{gameMode:L}=xt(),{loading:O,currentLevel:M,board:S,selectedPath:u,foundWords:b,notification:i,gameState:V,activeLetter:N,handleBack:$,handleMouseDown:R,handleMouseEnter:x,handleMouseUp:m,onHint:t,onUndo:s,onReset:C,clearSelection:A,currentLevelIndex:f}=Bt(),_=()=>g.jsx(zt,{cells:S,selectedPath:u,foundWords:b,activeLetter:N,onMouseDown:j=>R({...j,isUsed:!1}),onMouseEnter:j=>x({...j,isUsed:!1}),onMouseUp:m}),E=()=>b.length===0?null:g.jsx(Ht,{foundWords:b,t:{selected:r.selected}}),k=()=>{if(!i)return null;let j="info";return i.includes("congrats")||i===r.congrats?j="success":i.includes("Already found")||i.includes("cannot cross")?j="warning":(i.includes("must connect")||i.includes("horizontal or vertical"))&&(j="error"),g.jsx(Mt,{message:i,type:j})};if(O)return g.jsx("div",{className:`flex flex-col items-center justify-center min-h-screen ${c==="rtl"?"text-right":""}`,dir:c,children:g.jsxs("div",{className:"text-xl",children:[r.loading,"..."]})});if(!M)return g.jsxs("div",{className:`flex flex-col items-center justify-center min-h-screen ${c==="rtl"?"text-right":""}`,dir:c,children:[g.jsx("div",{className:"text-xl",children:r.noLevelsFound}),g.jsx("button",{onClick:$,className:"mt-4 btn",children:r.back})]});const v=Math.floor((M?.endpoints.length??0)/2);return g.jsxs(St,{title:r.letterFlowTitle??M.id,levelIndex:f??0,onBack:$,difficulty:M.difficulty,layoutType:"text",instructions:y,children:[k(),g.jsx("div",{className:`mb-6 touch-none ${c==="rtl"?"arabic-layout":""} transition-colors duration-300`,dir:c,children:_()}),E(),g.jsx(kt,{onReset:C,onRemoveLetter:s,onClearAnswer:A,onHint:t,onNextLevel:void 0,onPrevLevel:void 0,onCheckAnswer:()=>{},onShowSolution:void 0,canRemove:b.length>0,canClear:u.length>0,canCheck:!1,canPrev:!!(f&&f>0),canNext:V==="won",canHint:b.length<v,hintsRemaining:void 0,gameState:V==="won"?"won":"playing",gameMode:L,isKidsMode:!1,labels:{remove:r.undo,clear:r.clear,check:r.check,hint:r.hint,showSolution:r.showSolution,reset:r.reset,prev:r.prev,next:r.next},showOnly:["remove","hint","reset","next"]}),g.jsx(Kt,{foundWords:b,totalWords:v,t:{selected:r.selected,of:r.of}})]})};export{ee as default};
