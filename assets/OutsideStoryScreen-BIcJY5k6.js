import{_ as o,r as y,j as e,B as E,c as Q,f as Y}from"./index-co89HZIf.js";import{B as W,u as F,G as H}from"./GameLayout-Cn31E4fK.js";class K extends W{getGameId(){return"outside-the-story"}getModulePath(t,s){return`/src/data/${t}/outside-the-story/${s}.json`}validateLevel(){return null}async loadLevels(t){const{language:s,categories:l}=t,d=Object.assign({"/src/data/ar/outside-the-story/animals.json":()=>o(()=>import("./animals-BD_uC3F6.js"),[]),"/src/data/ar/outside-the-story/anime.json":()=>o(()=>import("./anime-X9XTb-jh.js"),[]),"/src/data/ar/outside-the-story/cars.json":()=>o(()=>import("./cars-LFoQ5kcr.js"),[]),"/src/data/ar/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-9ln4fVtF.js"),[]),"/src/data/ar/outside-the-story/characters.json":()=>o(()=>import("./characters-BClrgWDD.js"),[]),"/src/data/ar/outside-the-story/clothes.json":()=>o(()=>import("./clothes-DZukcyjc.js"),[]),"/src/data/ar/outside-the-story/drinks.json":()=>o(()=>import("./drinks-DWTisQdZ.js"),[]),"/src/data/ar/outside-the-story/foods.json":()=>o(()=>import("./foods-BPEl4jwc.js"),[]),"/src/data/ar/outside-the-story/football.json":()=>o(()=>import("./football-BkDTW0je.js"),[]),"/src/data/ar/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-CWZ59ral.js"),[]),"/src/data/ar/outside-the-story/gamers.json":()=>o(()=>import("./gamers-DU27ka0Y.js"),[]),"/src/data/ar/outside-the-story/geography.json":()=>o(()=>import("./geography-Bmt1Mp9F.js"),[]),"/src/data/ar/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-CvncURYW.js"),[]),"/src/data/ar/outside-the-story/science.json":()=>o(()=>import("./science-C1rxd0mO.js"),[]),"/src/data/ar/outside-the-story/series.json":()=>o(()=>import("./series-DgCSJJru.js"),[]),"/src/data/ar/outside-the-story/spy.json":()=>o(()=>import("./spy-CTUdze8o.js"),[]),"/src/data/ar/outside-the-story/sweets.json":()=>o(()=>import("./sweets-0_2hbNMS.js"),[]),"/src/data/en/outside-the-story/animals.json":()=>o(()=>import("./animals-D78oH89-.js"),[]),"/src/data/en/outside-the-story/anime.json":()=>o(()=>import("./anime-DXIlEidq.js"),[]),"/src/data/en/outside-the-story/cars.json":()=>o(()=>import("./cars-Cw03Nxyo.js"),[]),"/src/data/en/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-DwVIQVvA.js"),[]),"/src/data/en/outside-the-story/characters.json":()=>o(()=>import("./characters-Dl2vwTPn.js"),[]),"/src/data/en/outside-the-story/clothes.json":()=>o(()=>import("./clothes-BiLKpCWj.js"),[]),"/src/data/en/outside-the-story/drinks.json":()=>o(()=>import("./drinks-CP1Emjyy.js"),[]),"/src/data/en/outside-the-story/foods.json":()=>o(()=>import("./foods-BKBSmJG2.js"),[]),"/src/data/en/outside-the-story/football.json":()=>o(()=>import("./football-B8eU_HgW.js"),[]),"/src/data/en/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-B5narx4J.js"),[]),"/src/data/en/outside-the-story/gamers.json":()=>o(()=>import("./gamers-Dm5Tu0YA.js"),[]),"/src/data/en/outside-the-story/geography.json":()=>o(()=>import("./geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-BnHY6_tE.js"),[]),"/src/data/en/outside-the-story/science.json":()=>o(()=>import("./science-DF1sazzy.js"),[]),"/src/data/en/outside-the-story/series.json":()=>o(()=>import("./series-dqakDLa9.js"),[]),"/src/data/en/outside-the-story/spy.json":()=>o(()=>import("./spy-DLpfZG_H.js"),[]),"/src/data/en/outside-the-story/sweets.json":()=>o(()=>import("./sweets-DDZ5JqsI.js"),[])}),r=[];for(const c of l){const m=`/src/data/${s}/outside-the-story/${c}.json`,u=d[m];if(!u){console.warn(`OutsideStoryGameEngine: Could not find data file at path: ${m}`);continue}try{const i=await u(),a=Array.isArray(i.default?.words)?i.default.words.map(String):[],j=a.length>0?a[0]:"";r.push({id:`${s}-${c}`,language:s,category:c,words:a,solution:j,meta:i.default?.meta??{}})}catch(i){console.error(`OutsideStoryGameEngine: Failed to load or parse ${m}`,i)}}return r.length===0?[this.getErrorLevel()]:r}getErrorLevel(){return{id:"error",language:"en",category:"general",words:["ERROR"],solution:"ERROR"}}}const z=new K;function J(){const n=F({engine:z,gameId:"outsideStory"}),{levels:t,loading:s,gameModeState:l,setNotification:d}=n,{teams:r,resetScores:c,setGameMode:m}=l,[u,i]=y.useState("role_reveal_handoff"),[a,j]=y.useState(null),[p,_]=y.useState([]),[P,I]=y.useState(0),[w,A]=y.useState([]),[L,N]=y.useState(0),T=y.useCallback(h=>{const g=t.find(R=>R.category===h);if(!g||g.words.length<8){d({messageKey:"notEnoughWords",type:"error"});return}if(r.length<3){d({messageKey:"min3Players",type:"error"});return}const f=[...g.words].sort(()=>.5-Math.random()).slice(0,8),v=f[0],q=Math.floor(Math.random()*r.length),O=r[q].id,B=r.map(R=>R.id).filter(R=>R!==O),M={id:`${Date.now()}`,category:h,secret:v,words:f.sort(),outsiderId:O,insiders:B,votes:{},revealed:!1};j(M),I(0),i("role_reveal_handoff")},[t,r,d]);y.useEffect(()=>{s||t.length===0||a||T(t[0].category)},[s,t,a,T]);const b=y.useCallback(()=>{if(r.length<2)return;const h=[...r].sort(()=>Math.random()-.5),g=[];for(let x=0;x<h.length;x++)g.push({asker:h[x],askee:h[(x+1)%h.length]});A(g),I(0),i("question_turn")},[r]),S=y.useCallback(()=>{if(!a)return;const h={};for(const f in a.votes)if(parseInt(f,10)!==a.outsiderId){const v=a.votes[f];h[v]=(h[v]||0)+1}let g=0,x=-1;for(const f in h)h[f]>g&&(g=h[f],x=parseInt(f,10));j(f=>f?{...f,roundResult:{votedPlayerId:x,pointsAwarded:{}}}:null),i("outsider_guess")},[a]),C=y.useCallback(h=>{if(!a)return;const g=h===a.secret,x={};r.forEach(v=>x[v.id]=0),g&&(x[a.outsiderId]=10);for(const v in a.votes)parseInt(v,10)!==a.outsiderId&&a.votes[v]===a.outsiderId&&(x[parseInt(v,10)]=(x[parseInt(v,10)]||0)+10);c(x);const f={...a,revealed:!0,roundResult:{...a.roundResult,outsiderGuessedCorrectly:g,pointsAwarded:x}};j(f),_(v=>[f,...v]),i("results")},[a,r,c]),k=()=>I(h=>h+1),D=()=>N(h=>h+1),G=y.useCallback(()=>{I(0),N(0),j(null)},[]),$=y.useCallback(()=>{m("competitive"),c({})},[m,c]);return{...n,players:r,levels:t,loadingLevels:s,currentRound:a,history:p,startRound:T,playAgain:G,changePlayersAndReset:$,gameState:u,setGameState:i,currentPlayerTurn:P,nextTurn:k,finishVoting:S,handleOutsiderGuess:C,setupQuestionTurns:b,questionPairs:w,submitVote:(h,g)=>{j(x=>x?{...x,votes:{...x.votes,[h]:g}}:null)},votingPlayerIndex:L,nextVoter:D}}const U=({children:n,...t})=>e.jsx(H,{...t,layoutType:"text",levelIndex:0,children:e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 bg-blue-500 text-white rounded-lg min-h-[50vh]",children:n})}),V=({game:n})=>{const{t,players:s,currentPlayerTurn:l,setGameState:d}=n;if(y.useEffect(()=>{l>=s.length&&d("question_intro")},[l,s.length,d]),l>=s.length)return null;const r=s[l];return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:r.name}),e.jsx("p",{className:"text-xl",children:t.givePhoneToPlayer?.replace("{player}",r.name)??`Give the phone to ${r.name}`}),e.jsx("p",{className:"text-xl mt-2",children:t.pressNextToSeeRole??"Press next to see if you are in or out of the story. Don't let anyone else see the screen!"}),e.jsx(E,{onClick:()=>d("role_reveal_player"),className:"mt-8 w-full",children:t.next??"Next"})]})},X=({game:n})=>{const{t,players:s,currentRound:l,currentPlayerTurn:d,nextTurn:r,setGameState:c}=n,m=s[d],u=m.id===l?.outsiderId,i=()=>{r(),c("role_reveal_handoff")},a=l?.category??"",j=t[a]??a;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:m.name}),u?e.jsx("p",{className:"text-xl",children:t.youAreTheOutsider?.replace("{category}",j)??"You are the Outsider! Try to figure out the story."}):e.jsx("p",{className:"text-xl",children:t.youAreAnInsider?.replace("{secret}",l?.secret??"")??`You are an Insider! The story is **${l?.secret}**. Your goal is to find out who among you is the Outsider.`}),e.jsx(E,{onClick:i,className:"mt-8 w-full",children:t.next??"Next"})]})},Z=({game:n})=>{const{t,setupQuestionTurns:s}=n;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.questionTime??"Question Time"}),e.jsx("p",{className:"text-xl",children:t.questionIntroInstruction??"Each person will ask another person a question related to the topic. Press next to see who asks who."}),e.jsx(E,{onClick:s,className:"mt-8 w-full",children:t.next??"Next"})]})},ee=({game:n})=>{const{t,currentPlayerTurn:s,setGameState:l,nextTurn:d,questionPairs:r}=n;if(!r||r.length===0||s>=r.length)return e.jsx("p",{children:t.loading??"Loading..."});const c=r[s],{asker:m,askee:u}=c,i=()=>{s>=r.length-1?l("voting"):d()};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.questionTime??"Question Time"}),e.jsx("p",{className:"text-xl",children:t.askerToAskeeInstruction?.replace("{asker}",m.name).replace("{askee}",u.name)??`${m.name}, ask ${u.name} a question about the topic! Choose your question carefully so the Outsider doesn't figure it out.`}),e.jsx(E,{onClick:i,className:"mt-8 w-full",children:t.next??"Next"})]})},te=({game:n})=>{const{t,players:s,submitVote:l,finishVoting:d,votingPlayerIndex:r,nextVoter:c}=n,[m,u]=y.useState(!1),i=s[r];if(!i)return d(),e.jsx("p",{children:t.loading??"Loading..."});const a=s.filter(_=>_.id!==i.id),j=_=>{l(i.id,_),u(!0)},p=()=>{c(),u(!1)};if(m){const _=s[r+1],P=_?t.passDeviceAndVote?.replace("{player}",_.name)??`Pass the device to ${_.name} to vote.`:t.submitVote??"Submit Vote";return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:P}),e.jsx(E,{onClick:p,className:"mt-8 w-full",children:t.next??"Next"})]})}return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.yourTurnToVote?.replace("{player}",i.name)??`${i.name}, it's your turn to vote.`}),e.jsx("div",{className:"flex flex-col gap-3 w-full",children:a.map(_=>e.jsx(E,{onClick:()=>j(_.id),variant:"secondary",className:"h-16 text-xl",children:_.name},_.id))})]})},se=({game:n})=>{const{t,currentRound:s,handleOutsiderGuess:l,players:d,setGameState:r}=n,[c,m]=y.useState(null),[u,i]=y.useState(null),a=d.find(p=>p.id===s?.outsiderId);if(!s||!a)return r("results"),null;const j=p=>{if(c)return;m(p);const _=p===s.secret;i(_?"correct":"incorrect"),setTimeout(()=>{l(p)},1500)};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.outsiderGuessTitle?.replace("{player}",a.name)??`${a.name}, what's the story?`}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.words.map(p=>{const _=c===p,P=u==="correct",I=u==="incorrect";return e.jsx(E,{onClick:()=>j(p),disabled:!!c,className:Q("w-full h-16 text-lg transition-all duration-300",_&&P&&"bg-green-500 hover:bg-green-600 ring-4 ring-white",_&&I&&"bg-red-500 hover:bg-red-600 ring-4 ring-white",!_&&c&&"opacity-50"),children:p},p)})})]})},re=({game:n})=>{const{t,currentRound:s,players:l,setGameState:d}=n;if(!s||!s.roundResult)return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:t.loadingResults??"Loading results..."}),e.jsx(E,{onClick:()=>d("round_end"),className:"mt-4",children:t.continue??"Continue"})]});const{votedPlayerId:r,outsiderGuessedCorrectly:c}=s.roundResult,m=l.find(i=>i.id===s.outsiderId);let u="";return r===s.outsiderId?c?u=t.outsiderCaughtButGuessed?.replace("{secret}",s.secret)??`You were caught! But you guessed the story (${s.secret}), well done!`:u=t.insidersWin?.replace("{secret}",s.secret)??`The Insiders win! The story was (${s.secret}).`:u=t.outsiderWins?.replace("{player}",m?.name??"")??`${m?.name} fooled you all! They were the Outsider.`,e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-4xl font-bold mb-6",children:t.results??"Results"}),e.jsx("div",{className:"space-y-2 my-4 w-full text-2xl",children:l.map(i=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:i.name}),e.jsx("span",{children:i.score})]},i.id))}),e.jsx("p",{className:"text-xl my-6",children:u}),e.jsx(E,{onClick:()=>d("round_end"),className:"mt-8 w-full",children:t.next??"Next"})]})},oe=({game:n})=>{const{t,playAgain:s,changePlayersAndReset:l}=n,d=Y(),r=()=>{l(),d("/settings/teams/outside-the-story")};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.roundEndTitle??"End of Round!"}),e.jsx("p",{className:"text-xl mb-8",children:t.roundEndInstruction??"You can continue playing, change players, or go back to the category selection screen."}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(E,{onClick:s,className:"w-full",children:t.continuePlay??"Continue Playing"}),e.jsx(E,{onClick:r,variant:"secondary",className:"w-full",children:t.changePlayers??"Change Players"})]})]})},ie=()=>{const n=J(),{loadingLevels:t,currentRound:s,notification:l,onClearNotification:d,handleBack:r,t:c,instructions:m}=n;if(t||!s)return e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen gap-4 p-4 text-center",children:[e.jsx("p",{className:"text-xl font-semibold",children:c.loading??"Loading..."}),e.jsx(E,{onClick:r,children:c.back})]});const u=()=>{switch(n.gameState){case"role_reveal_handoff":return e.jsx(V,{game:n});case"role_reveal_player":return e.jsx(X,{game:n});case"question_intro":return e.jsx(Z,{game:n});case"question_turn":return e.jsx(ee,{game:n});case"voting":return e.jsx(te,{game:n});case"outsider_guess":return e.jsx(se,{game:n});case"results":return e.jsx(re,{game:n});case"round_end":return e.jsx(oe,{game:n});default:return e.jsx(V,{game:n})}};return e.jsx(U,{title:c.outsideTheStoryTitle,onBack:r,instructions:m,notification:l,onClearNotification:d,children:u()})};export{ie as default};
