import{_ as o,r as y,j as e,B as E,c as Q,u as W}from"./index-BxQq2Rjb.js";import{B as F,u as H,G as K}from"./GameLayout-e_zlDEVl.js";class z extends F{getGameId(){return"outside-the-story"}getModulePath(t,s){return`/src/data/${t}/outside-the-story/${s}.json`}validateLevel(){return null}async loadLevels(t){const{language:s,categories:d}=t,c=Object.assign({"/src/data/ar/outside-the-story/animals.json":()=>o(()=>import("./animals-BD_uC3F6.js"),[]),"/src/data/ar/outside-the-story/anime.json":()=>o(()=>import("./anime-X9XTb-jh.js"),[]),"/src/data/ar/outside-the-story/cars.json":()=>o(()=>import("./cars-LFoQ5kcr.js"),[]),"/src/data/ar/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-9ln4fVtF.js"),[]),"/src/data/ar/outside-the-story/characters.json":()=>o(()=>import("./characters-BClrgWDD.js"),[]),"/src/data/ar/outside-the-story/clothes.json":()=>o(()=>import("./clothes-DZukcyjc.js"),[]),"/src/data/ar/outside-the-story/drinks.json":()=>o(()=>import("./drinks-DWTisQdZ.js"),[]),"/src/data/ar/outside-the-story/foods.json":()=>o(()=>import("./foods-BPEl4jwc.js"),[]),"/src/data/ar/outside-the-story/football.json":()=>o(()=>import("./football-BkDTW0je.js"),[]),"/src/data/ar/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-CWZ59ral.js"),[]),"/src/data/ar/outside-the-story/gamers.json":()=>o(()=>import("./gamers-DU27ka0Y.js"),[]),"/src/data/ar/outside-the-story/geography.json":()=>o(()=>import("./geography-Bmt1Mp9F.js"),[]),"/src/data/ar/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-CvncURYW.js"),[]),"/src/data/ar/outside-the-story/science.json":()=>o(()=>import("./science-C1rxd0mO.js"),[]),"/src/data/ar/outside-the-story/series.json":()=>o(()=>import("./series-DgCSJJru.js"),[]),"/src/data/ar/outside-the-story/spy.json":()=>o(()=>import("./spy-CTUdze8o.js"),[]),"/src/data/ar/outside-the-story/sweets.json":()=>o(()=>import("./sweets-0_2hbNMS.js"),[]),"/src/data/en/outside-the-story/animals.json":()=>o(()=>import("./animals-D78oH89-.js"),[]),"/src/data/en/outside-the-story/anime.json":()=>o(()=>import("./anime-DXIlEidq.js"),[]),"/src/data/en/outside-the-story/cars.json":()=>o(()=>import("./cars-Cw03Nxyo.js"),[]),"/src/data/en/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-DwVIQVvA.js"),[]),"/src/data/en/outside-the-story/characters.json":()=>o(()=>import("./characters-Dl2vwTPn.js"),[]),"/src/data/en/outside-the-story/clothes.json":()=>o(()=>import("./clothes-BiLKpCWj.js"),[]),"/src/data/en/outside-the-story/drinks.json":()=>o(()=>import("./drinks-CP1Emjyy.js"),[]),"/src/data/en/outside-the-story/foods.json":()=>o(()=>import("./foods-BKBSmJG2.js"),[]),"/src/data/en/outside-the-story/football.json":()=>o(()=>import("./football-B8eU_HgW.js"),[]),"/src/data/en/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-B5narx4J.js"),[]),"/src/data/en/outside-the-story/gamers.json":()=>o(()=>import("./gamers-Dm5Tu0YA.js"),[]),"/src/data/en/outside-the-story/geography.json":()=>o(()=>import("./geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-BnHY6_tE.js"),[]),"/src/data/en/outside-the-story/science.json":()=>o(()=>import("./science-DF1sazzy.js"),[]),"/src/data/en/outside-the-story/series.json":()=>o(()=>import("./series-dqakDLa9.js"),[]),"/src/data/en/outside-the-story/spy.json":()=>o(()=>import("./spy-DLpfZG_H.js"),[]),"/src/data/en/outside-the-story/sweets.json":()=>o(()=>import("./sweets-DDZ5JqsI.js"),[])}),r=[];for(const l of d){const m=`/src/data/${s}/outside-the-story/${l}.json`,u=c[m];if(!u){console.warn(`OutsideStoryGameEngine: Could not find data file at path: ${m}`);continue}try{const i=await u(),a=Array.isArray(i.default?.words)?i.default.words.map(String):[],j=a.length>0?a[0]:"";r.push({id:`${s}-${l}`,language:s,category:l,words:a,solution:j,meta:i.default?.meta??{}})}catch(i){console.error(`OutsideStoryGameEngine: Failed to load or parse ${m}`,i)}}return r.length===0?[this.getErrorLevel()]:r}getErrorLevel(){return{id:"error",language:"en",category:"general",words:["ERROR"],solution:"ERROR"}}}const J=new z;function U(){const n=H({engine:J,gameId:"outsideStory"}),{levels:t,loading:s,gameModeState:d,setNotification:c}=n,{teams:r,resetScores:l,setGameMode:m}=d,[u,i]=y.useState("role_reveal_handoff"),[a,j]=y.useState(null),[f,x]=y.useState([]),[R,I]=y.useState(0),[A,S]=y.useState([]),[b,N]=y.useState(0),T=y.useCallback(_=>{const g=t.find(P=>P.category===_);if(!g||g.words.length<8){c({messageKey:"notEnoughWords",type:"error"});return}if(r.length<3){c({messageKey:"min3Players",type:"error"});return}const p=[...g.words].sort(()=>.5-Math.random()).slice(0,8),v=p[0],$=Math.floor(Math.random()*r.length),V=r[$].id,M=r.map(P=>P.id).filter(P=>P!==V),B={id:`${Date.now()}`,category:_,secret:v,words:p.sort(),outsiderId:V,insiders:M,votes:{},revealed:!1};j(B),I(0),i("role_reveal_handoff")},[t,r,c]);y.useEffect(()=>{s||t.length===0||a||T(t[0].category)},[s,t,a,T]);const L=y.useCallback(()=>{if(r.length<2)return;const _=[...r].sort(()=>Math.random()-.5),g=[];for(let h=0;h<_.length;h++)g.push({asker:_[h],askee:_[(h+1)%_.length]});S(g),I(0),i("question_turn")},[r]),w=y.useCallback(()=>{if(!a)return;const _={};for(const p in a.votes)if(parseInt(p,10)!==a.outsiderId){const v=a.votes[p];_[v]=(_[v]||0)+1}let g=0,h=-1;for(const p in _)_[p]>g&&(g=_[p],h=parseInt(p,10));j(p=>p?{...p,roundResult:{votedPlayerId:h,pointsAwarded:{}}}:null),i("outsider_guess")},[a]),D=y.useCallback(_=>{if(!a)return;const g=_===a.secret,h={};r.forEach(v=>h[v.id]=0),g&&(h[a.outsiderId]=10);for(const v in a.votes)parseInt(v,10)!==a.outsiderId&&a.votes[v]===a.outsiderId&&(h[parseInt(v,10)]=(h[parseInt(v,10)]||0)+10);l(h);const p={...a,revealed:!0,roundResult:{...a.roundResult,outsiderGuessedCorrectly:g,pointsAwarded:h}};j(p),x(v=>[p,...v]),i("results")},[a,r,l]),C=()=>I(_=>_+1),k=()=>N(_=>_+1),G=y.useCallback(()=>{I(0),N(0),j(null)},[]),q=y.useCallback(()=>{m("competitive"),l({})},[m,l]);return{...n,players:r,levels:t,loadingLevels:s,currentRound:a,history:f,startRound:T,playAgain:G,changePlayersAndReset:q,gameState:u,setGameState:i,currentPlayerTurn:R,nextTurn:C,finishVoting:w,handleOutsiderGuess:D,setupQuestionTurns:L,questionPairs:A,submitVote:(_,g)=>{j(h=>h?{...h,votes:{...h.votes,[_]:g}}:null)},votingPlayerIndex:b,nextVoter:k}}const X=({children:n,...t})=>e.jsx(K,{...t,layoutType:"text",levelIndex:0,children:e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 bg-blue-500 text-white rounded-lg min-h-[50vh]",children:n})}),O=({game:n})=>{const{t,players:s,currentPlayerTurn:d,setGameState:c}=n;if(y.useEffect(()=>{d>=s.length&&c("question_intro")},[d,s.length,c]),d>=s.length)return null;const r=s[d];return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:r.name}),e.jsx("p",{className:"text-xl",children:t("givePhoneToPlayer",{ns:"outside_the_story"})?.replace("{player}",r.name)}),e.jsx("p",{className:"text-xl mt-2",children:t("pressNextToSeeRole",{ns:"outside_the_story"})}),e.jsx(E,{onClick:()=>c("role_reveal_player"),className:"mt-8 w-full",children:t("next")})]})},Y=({game:n})=>{const{t,players:s,currentRound:d,currentPlayerTurn:c,nextTurn:r,setGameState:l}=n,m=s[c],u=m.id===d?.outsiderId,i=()=>{r(),l("role_reveal_handoff")},a=d?.category??"",j=t[a]??a;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:m.name}),u?e.jsx("p",{className:"text-xl",children:t("youAreTheOutsider",{ns:"outside_the_story"})?.replace("{category}",j)}):e.jsx("p",{className:"text-xl",children:t("youAreAnInsider",{ns:"outside_the_story"})?.replace("{secret}",d?.secret??"")}),e.jsx(E,{onClick:i,className:"mt-8 w-full",children:t("next")})]})},Z=({game:n})=>{const{t,setupQuestionTurns:s}=n;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t("questionTime",{ns:"outside_the_story"})}),e.jsx("p",{className:"text-xl",children:t("questionIntroInstruction",{ns:"outside_the_story"})}),e.jsx(E,{onClick:s,className:"mt-8 w-full",children:t("next")})]})},ee=({game:n})=>{const{t,currentPlayerTurn:s,setGameState:d,nextTurn:c,questionPairs:r}=n;if(!r||r.length===0||s>=r.length)return e.jsx("p",{children:t("loading")});const l=r[s],{asker:m,askee:u}=l,i=()=>{s>=r.length-1?d("voting"):c()};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t("questionTime",{ns:"outside_the_story"})}),e.jsx("p",{className:"text-xl",children:t("askerToAskeeInstruction",{ns:"outside_the_story"})?.replace("{asker}",m.name).replace("{askee}",u.name)}),e.jsx(E,{onClick:i,className:"mt-8 w-full",children:t("next")})]})},te=({game:n})=>{const{t,players:s,submitVote:d,finishVoting:c,votingPlayerIndex:r,nextVoter:l}=n,[m,u]=y.useState(!1),i=s[r];if(!i)return c(),e.jsx("p",{children:t("loading")});const a=s.filter(x=>x.id!==i.id),j=x=>{d(i.id,x),u(!0)},f=()=>{l(),u(!1)};if(m){const x=s[r+1],R=x?t("passDeviceAndVote",{ns:"outside_the_story"})?.replace("{player}",x.name):t("submitVote",{ns:"outside_the_story"});return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:R}),e.jsx(E,{onClick:f,className:"mt-8 w-full",children:t("next")})]})}return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t("yourTurnToVote",{ns:"outside_the_story"})?.replace("{player}",i.name)}),e.jsx("div",{className:"flex flex-col gap-3 w-full",children:a.map(x=>e.jsx(E,{onClick:()=>j(x.id),variant:"secondary",className:"h-16 text-xl",children:x.name},x.id))})]})},se=({game:n})=>{const{t,currentRound:s,handleOutsiderGuess:d,players:c,setGameState:r}=n,[l,m]=y.useState(null),[u,i]=y.useState(null),a=c.find(f=>f.id===s?.outsiderId);if(!s||!a)return r("results"),null;const j=f=>{if(l)return;m(f);const x=f===s.secret;i(x?"correct":"incorrect"),setTimeout(()=>{d(f)},1500)};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t("outsiderGuessTitle",{ns:"outside_the_story"})?.replace("{player}",a.name)}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.words.map(f=>{const x=l===f,R=u==="correct",I=u==="incorrect";return e.jsx(E,{onClick:()=>j(f),disabled:!!l,className:Q("w-full h-16 text-lg transition-all duration-300",x&&R&&"bg-green-500 hover:bg-green-600 ring-4 ring-white",x&&I&&"bg-red-500 hover:bg-red-600 ring-4 ring-white",!x&&l&&"opacity-50"),children:f},f)})})]})},re=({game:n})=>{const{t,currentRound:s,players:d,setGameState:c}=n;if(!s||!s.roundResult)return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:t("loadingResults",{ns:"outside_the_story"})}),e.jsx(E,{onClick:()=>c("round_end"),className:"mt-4",children:t("continue")})]});const{votedPlayerId:r,outsiderGuessedCorrectly:l}=s.roundResult,m=d.find(i=>i.id===s.outsiderId);let u="";return r===s.outsiderId?l?u=t("outsiderCaughtButGuessed",{ns:"outside_the_story"})?.replace("{secret}",s.secret):u=t("insidersWin",{ns:"outside_the_story"})?.replace("{secret}",s.secret):u=t("outsiderWins",{ns:"outside_the_story"})?.replace("{player}",m?.name??""),e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-4xl font-bold mb-6",children:t("results",{ns:"outside_the_story"})}),e.jsx("div",{className:"space-y-2 my-4 w-full text-2xl",children:d.map(i=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:i.name}),e.jsx("span",{children:i.score})]},i.id))}),e.jsx("p",{className:"text-xl my-6",children:u}),e.jsx(E,{onClick:()=>c("round_end"),className:"mt-8 w-full",children:t("next")})]})},oe=({game:n})=>{const{t,playAgain:s,changePlayersAndReset:d}=n,c=W(),r=()=>{d(),c("/settings/teams/outside-the-story")};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t("roundEndTitle",{ns:"outside_the_story"})}),e.jsx("p",{className:"text-xl mb-8",children:t("roundEndInstruction",{ns:"outside_the_story"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(E,{onClick:s,className:"w-full",children:t("continuePlay",{ns:"outside_the_story"})}),e.jsx(E,{onClick:r,variant:"secondary",className:"w-full",children:t("changePlayers",{ns:"outside_the_story"})})]})]})},ie=()=>{const n=U(),{loadingLevels:t,currentRound:s,notification:d,onClearNotification:c,handleBack:r,t:l,instructions:m}=n;if(t||!s)return e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen gap-4 p-4 text-center",children:[e.jsx("p",{className:"text-xl font-semibold",children:l("loading")}),e.jsx(E,{onClick:r,children:l("back")})]});const u=()=>{switch(n.gameState){case"role_reveal_handoff":return e.jsx(O,{game:n});case"role_reveal_player":return e.jsx(Y,{game:n});case"question_intro":return e.jsx(Z,{game:n});case"question_turn":return e.jsx(ee,{game:n});case"voting":return e.jsx(te,{game:n});case"outsider_guess":return e.jsx(se,{game:n});case"results":return e.jsx(re,{game:n});case"round_end":return e.jsx(oe,{game:n});default:return e.jsx(O,{game:n})}};return e.jsx(X,{title:l("outsideTheStoryTitle",{ns:"games"}),onBack:r,instructions:m,notification:d,onClearNotification:c,children:u()})};export{ie as default};
