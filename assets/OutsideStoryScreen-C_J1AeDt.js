import{_ as o,r as h,j as e,B as I,c as K,f as U}from"./index-1P8EEWAI.js";import{B as X,u as Z,G as ee}from"./GameLayout-By1wpSWm.js";class te extends X{getGameId(){return"outside-the-story"}getModulePath(t,s){return`/src/data/${t}/outside-the-story/${s}.json`}validateLevel(){return null}async loadLevels(t){const{language:s,categories:a}=t,c=Object.assign({"/src/data/ar/outside-the-story/animals.json":()=>o(()=>import("./animals-BD_uC3F6.js"),[]),"/src/data/ar/outside-the-story/anime.json":()=>o(()=>import("./anime-X9XTb-jh.js"),[]),"/src/data/ar/outside-the-story/cars.json":()=>o(()=>import("./cars-LFoQ5kcr.js"),[]),"/src/data/ar/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-9ln4fVtF.js"),[]),"/src/data/ar/outside-the-story/characters.json":()=>o(()=>import("./characters-BClrgWDD.js"),[]),"/src/data/ar/outside-the-story/clothes.json":()=>o(()=>import("./clothes-DZukcyjc.js"),[]),"/src/data/ar/outside-the-story/drinks.json":()=>o(()=>import("./drinks-DWTisQdZ.js"),[]),"/src/data/ar/outside-the-story/foods.json":()=>o(()=>import("./foods-BPEl4jwc.js"),[]),"/src/data/ar/outside-the-story/football.json":()=>o(()=>import("./football-BkDTW0je.js"),[]),"/src/data/ar/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-CWZ59ral.js"),[]),"/src/data/ar/outside-the-story/gamers.json":()=>o(()=>import("./gamers-DU27ka0Y.js"),[]),"/src/data/ar/outside-the-story/geography.json":()=>o(()=>import("./geography-Bmt1Mp9F.js"),[]),"/src/data/ar/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-CvncURYW.js"),[]),"/src/data/ar/outside-the-story/science.json":()=>o(()=>import("./science-C1rxd0mO.js"),[]),"/src/data/ar/outside-the-story/series.json":()=>o(()=>import("./series-DgCSJJru.js"),[]),"/src/data/ar/outside-the-story/spy.json":()=>o(()=>import("./spy-CTUdze8o.js"),[]),"/src/data/ar/outside-the-story/sweets.json":()=>o(()=>import("./sweets-0_2hbNMS.js"),[]),"/src/data/en/outside-the-story/animals.json":()=>o(()=>import("./animals-D78oH89-.js"),[]),"/src/data/en/outside-the-story/anime.json":()=>o(()=>import("./anime-DXIlEidq.js"),[]),"/src/data/en/outside-the-story/cars.json":()=>o(()=>import("./cars-Cw03Nxyo.js"),[]),"/src/data/en/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-DwVIQVvA.js"),[]),"/src/data/en/outside-the-story/characters.json":()=>o(()=>import("./characters-Dl2vwTPn.js"),[]),"/src/data/en/outside-the-story/clothes.json":()=>o(()=>import("./clothes-BiLKpCWj.js"),[]),"/src/data/en/outside-the-story/drinks.json":()=>o(()=>import("./drinks-CP1Emjyy.js"),[]),"/src/data/en/outside-the-story/foods.json":()=>o(()=>import("./foods-BKBSmJG2.js"),[]),"/src/data/en/outside-the-story/football.json":()=>o(()=>import("./football-B8eU_HgW.js"),[]),"/src/data/en/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-B5narx4J.js"),[]),"/src/data/en/outside-the-story/gamers.json":()=>o(()=>import("./gamers-Dm5Tu0YA.js"),[]),"/src/data/en/outside-the-story/geography.json":()=>o(()=>import("./geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-BnHY6_tE.js"),[]),"/src/data/en/outside-the-story/science.json":()=>o(()=>import("./science-DF1sazzy.js"),[]),"/src/data/en/outside-the-story/series.json":()=>o(()=>import("./series-dqakDLa9.js"),[]),"/src/data/en/outside-the-story/spy.json":()=>o(()=>import("./spy-DLpfZG_H.js"),[]),"/src/data/en/outside-the-story/sweets.json":()=>o(()=>import("./sweets-DDZ5JqsI.js"),[])}),r=[];for(const u of a){const m=`/src/data/${s}/outside-the-story/${u}.json`,d=c[m];if(!d){console.warn(`OutsideStoryGameEngine: Could not find data file at path: ${m}`);continue}try{const i=await d(),v=Array.isArray(i.default?.words)?i.default.words.map(String):[],j=v.length>0?v[0]:"";r.push({id:`${s}-${u}`,language:s,category:u,words:v,solution:j,meta:i.default?.meta??{}})}catch(i){console.error(`OutsideStoryGameEngine: Failed to load or parse ${m}`,i)}}return r.length===0?[this.getErrorLevel()]:r}getErrorLevel(){return{id:"error",language:"en",category:"general",words:["ERROR"],solution:"ERROR"}}}const A=new te;function se(){const n=Z({engine:A,gameId:"outsideStory"}),{gameModeState:t,t:s,instructions:a,handleBack:c}=n,{teams:r,language:u,categories:m,resetScores:d,setGameMode:i}=t,[v,j]=h.useState("role_reveal_handoff"),[_,x]=h.useState([]),[P,N]=h.useState(!0),[f,R]=h.useState(null),[b,k]=h.useState([]),[C,O]=h.useState(0),[D,G]=h.useState([]),[$,V]=h.useState(0),L=h.useCallback(l=>{const g=_.find(T=>T.category===l);if(!g||g.words.length<8){console.error(s.notEnoughWords??"Not enough words for this category.");return}if(r.length<3){console.error(s.min3Players??"Add at least 3 players.");return}const p=[...g.words].sort(()=>.5-Math.random()).slice(0,8),E=p[0],H=Math.floor(Math.random()*r.length),w=r[H].id,z=r.map(T=>T.id).filter(T=>T!==w),J={id:`${Date.now()}`,category:l,secret:E,words:p.sort(),outsiderId:w,insiders:z,votes:{},revealed:!1};R(J),O(0),j("role_reveal_handoff")},[_,r,s]);h.useEffect(()=>{let l=!0;return N(!0),(async()=>{try{const g=await A.loadLevels({language:u,categories:m});l&&x(g)}finally{l&&N(!1)}})(),()=>{l=!1}},[u,m]),h.useEffect(()=>{P||_.length===0||f||L(_[0].category)},[P,_,f,L]);const q=h.useCallback(()=>{if(r.length<2)return;const l=[...r].sort(()=>Math.random()-.5),g=[];for(let y=0;y<l.length;y++)g.push({asker:l[y],askee:l[(y+1)%l.length]});G(g),O(0),j("question_turn")},[r]),B=h.useCallback(()=>{if(!f)return;const l={};for(const p in f.votes)if(parseInt(p,10)!==f.outsiderId){const E=f.votes[p];l[E]=(l[E]||0)+1}let g=0,y=-1;for(const p in l)l[p]>g&&(g=l[p],y=parseInt(p,10));R(p=>p?{...p,roundResult:{votedPlayerId:y,pointsAwarded:{}}}:null),j("outsider_guess")},[f]),M=h.useCallback(l=>{if(!f)return;const g=l===f.secret,y={};r.forEach(E=>y[E.id]=0),g&&(y[f.outsiderId]=10);for(const E in f.votes)parseInt(E,10)!==f.outsiderId&&f.votes[E]===f.outsiderId&&(y[parseInt(E,10)]=(y[parseInt(E,10)]||0)+10);d(y);const p={...f,revealed:!0,roundResult:{...f.roundResult,outsiderGuessedCorrectly:g,pointsAwarded:y}};R(p),k(E=>[p,...E]),j("results")},[f,r,d]),Q=()=>O(l=>l+1),Y=()=>V(l=>l+1),W=h.useCallback(()=>{O(0),V(0),R(null)},[]),F=h.useCallback(()=>{i("competitive"),d({})},[i,d]);return{players:r,levels:_,loadingLevels:P,currentRound:f,history:b,startRound:L,playAgain:W,changePlayersAndReset:F,gameState:v,setGameState:j,currentPlayerTurn:C,nextTurn:Q,finishVoting:B,handleOutsiderGuess:M,setupQuestionTurns:q,questionPairs:D,submitVote:(l,g)=>{R(y=>y?{...y,votes:{...y.votes,[l]:g}}:null)},votingPlayerIndex:$,nextVoter:Y,t:s,instructions:a,handleBack:c}}const re=({title:n,children:t,onBack:s,instructions:a})=>e.jsx(ee,{title:n,onBack:s,layoutType:"text",levelIndex:0,instructions:a,children:e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 bg-blue-500 text-white rounded-lg min-h-[50vh]",children:t})}),S=({game:n})=>{const{t,players:s,currentPlayerTurn:a,setGameState:c}=n;if(h.useEffect(()=>{a>=s.length&&c("question_intro")},[a,s.length,c]),a>=s.length)return null;const r=s[a];return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:r.name}),e.jsx("p",{className:"text-xl",children:t.givePhoneToPlayer?.replace("{player}",r.name)??`Give the phone to ${r.name}`}),e.jsx("p",{className:"text-xl mt-2",children:t.pressNextToSeeRole??"Press next to see if you are in or out of the story. Don't let anyone else see the screen!"}),e.jsx(I,{onClick:()=>c("role_reveal_player"),className:"mt-8 w-full",children:t.next??"Next"})]})},oe=({game:n})=>{const{t,players:s,currentRound:a,currentPlayerTurn:c,nextTurn:r,setGameState:u}=n,m=s[c],d=m.id===a?.outsiderId,i=()=>{r(),u("role_reveal_handoff")},v=a?.category??"",j=t[v]??v;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:m.name}),d?e.jsx("p",{className:"text-xl",children:t.youAreTheOutsider?.replace("{category}",j)??"You are the Outsider! Try to figure out the story."}):e.jsx("p",{className:"text-xl",children:t.youAreAnInsider?.replace("{secret}",a?.secret??"")??`You are an Insider! The story is **${a?.secret}**. Your goal is to find out who among you is the Outsider.`}),e.jsx(I,{onClick:i,className:"mt-8 w-full",children:t.next??"Next"})]})},ne=({game:n})=>{const{t,setupQuestionTurns:s}=n;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.questionTime??"Question Time"}),e.jsx("p",{className:"text-xl",children:t.questionIntroInstruction??"Each person will ask another person a question related to the topic. Press next to see who asks who."}),e.jsx(I,{onClick:s,className:"mt-8 w-full",children:t.next??"Next"})]})},ae=({game:n})=>{const{t,currentPlayerTurn:s,setGameState:a,nextTurn:c,questionPairs:r}=n;if(!r||r.length===0||s>=r.length)return e.jsx("p",{children:t.loading??"Loading..."});const u=r[s],{asker:m,askee:d}=u,i=()=>{s>=r.length-1?a("voting"):c()};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.questionTime??"Question Time"}),e.jsx("p",{className:"text-xl",children:t.askerToAskeeInstruction?.replace("{asker}",m.name).replace("{askee}",d.name)??`${m.name}, ask ${d.name} a question about the topic! Choose your question carefully so the Outsider doesn't figure it out.`}),e.jsx(I,{onClick:i,className:"mt-8 w-full",children:t.next??"Next"})]})},ie=({game:n})=>{const{t,players:s,submitVote:a,finishVoting:c,votingPlayerIndex:r,nextVoter:u}=n,[m,d]=h.useState(!1),i=s[r];if(!i)return c(),e.jsx("p",{children:t.loading??"Loading..."});const v=s.filter(x=>x.id!==i.id),j=x=>{a(i.id,x),d(!0)},_=()=>{u(),d(!1)};if(m){const x=s[r+1],P=x?t.passDeviceAndVote?.replace("{player}",x.name)??`Pass the device to ${x.name} to vote.`:t.submitVote??"Submit Vote";return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:P}),e.jsx(I,{onClick:_,className:"mt-8 w-full",children:t.next??"Next"})]})}return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.yourTurnToVote?.replace("{player}",i.name)??`${i.name}, it's your turn to vote.`}),e.jsx("div",{className:"flex flex-col gap-3 w-full",children:v.map(x=>e.jsx(I,{onClick:()=>j(x.id),variant:"secondary",className:"h-16 text-xl",children:x.name},x.id))})]})},le=({game:n})=>{const{t,currentRound:s,handleOutsiderGuess:a,players:c,setGameState:r}=n,[u,m]=h.useState(null),[d,i]=h.useState(null),v=c.find(_=>_.id===s?.outsiderId);if(!s||!v)return r("results"),null;const j=_=>{if(u)return;m(_);const x=_===s.secret;i(x?"correct":"incorrect"),setTimeout(()=>{a(_)},1500)};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.outsiderGuessTitle?.replace("{player}",v.name)??`${v.name}, what's the story?`}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.words.map(_=>{const x=u===_,P=d==="correct",N=d==="incorrect";return e.jsx(I,{onClick:()=>j(_),disabled:!!u,className:K("w-full h-16 text-lg transition-all duration-300",x&&P&&"bg-green-500 hover:bg-green-600 ring-4 ring-white",x&&N&&"bg-red-500 hover:bg-red-600 ring-4 ring-white",!x&&u&&"opacity-50"),children:_},_)})})]})},ce=({game:n})=>{const{t,currentRound:s,players:a,setGameState:c}=n;if(!s||!s.roundResult)return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:t.loadingResults??"Loading results..."}),e.jsx(I,{onClick:()=>c("round_end"),className:"mt-4",children:t.continue??"Continue"})]});const{votedPlayerId:r,outsiderGuessedCorrectly:u}=s.roundResult,m=a.find(i=>i.id===s.outsiderId);let d="";return r===s.outsiderId?u?d=t.outsiderCaughtButGuessed?.replace("{secret}",s.secret)??`You were caught! But you guessed the story (${s.secret}), well done!`:d=t.insidersWin?.replace("{secret}",s.secret)??`The Insiders win! The story was (${s.secret}).`:d=t.outsiderWins?.replace("{player}",m?.name??"")??`${m?.name} fooled you all! They were the Outsider.`,e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-4xl font-bold mb-6",children:t.results??"Results"}),e.jsx("div",{className:"space-y-2 my-4 w-full text-2xl",children:a.map(i=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:i.name}),e.jsx("span",{children:i.score})]},i.id))}),e.jsx("p",{className:"text-xl my-6",children:d}),e.jsx(I,{onClick:()=>c("round_end"),className:"mt-8 w-full",children:t.next??"Next"})]})},de=({game:n})=>{const{t,playAgain:s,changePlayersAndReset:a}=n,c=U(),r=()=>{a(),c("/settings/teams/outside-the-story")};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.roundEndTitle??"End of Round!"}),e.jsx("p",{className:"text-xl mb-8",children:t.roundEndInstruction??"You can continue playing, change players, or go back to the category selection screen."}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(I,{onClick:s,className:"w-full",children:t.continuePlay??"Continue Playing"}),e.jsx(I,{onClick:r,variant:"secondary",className:"w-full",children:t.changePlayers??"Change Players"})]})]})},me=()=>{const n=se(),{loadingLevels:t,currentRound:s,handleBack:a,t:c,instructions:r}=n;if(t||!s)return e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen gap-4 p-4 text-center",children:[e.jsx("p",{className:"text-xl font-semibold",children:c.loading??"Loading..."}),e.jsx(I,{onClick:a,children:c.back})]});const u=()=>{switch(n.gameState){case"role_reveal_handoff":return e.jsx(S,{game:n});case"role_reveal_player":return e.jsx(oe,{game:n});case"question_intro":return e.jsx(ne,{game:n});case"question_turn":return e.jsx(ae,{game:n});case"voting":return e.jsx(ie,{game:n});case"outsider_guess":return e.jsx(le,{game:n});case"results":return e.jsx(ce,{game:n});case"round_end":return e.jsx(de,{game:n});default:return e.jsx(S,{game:n})}};return e.jsx(re,{title:c.outsideTheStoryTitle,onBack:a,instructions:r,children:u()})};export{me as default};
