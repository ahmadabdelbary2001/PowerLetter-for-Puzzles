import{_ as o,u as De,a as be,b as xe,c as ge,r as L,j as y,f as se,B as Ve}from"./index-COWoNw8G.js";import{s as Ce,a as $e,N as Me,u as ke}from"./Notification-Cvl_M7Gf.js";import{G as Ne}from"./GameControls-vl8yal8t.js";import{G as Se}from"./GameLayout-BethVcVl.js";import"./GameButton-BpM1xyK0.js";import"./circle-check-big-DYVVbkko.js";function Fe(r,a,c=70,i=50){if(a<=0)return`hsl(0, ${c}%, ${i}%)`;const x=Math.round(r*360/a)%360,E=i>50?i*.9:i*1.1;return`hsl(${x}, ${c}%, ${E}%)`}class Ue{async loadLevels(a){const{language:c,difficulty:i}=a;if(!i)return[];try{const x=`/src/data/${c}/letter-flow/${i}.json`,I=Object.assign({"/src/data/ar/formation/easy.json":()=>o(()=>import("./easy-CuHzQLY1.js"),[]),"/src/data/ar/formation/hard.json":()=>o(()=>import("./hard-DzMXngiv.js"),[]),"/src/data/ar/image-clue/animals/data.json":()=>o(()=>import("./data-USJTiWy0.js"),[]),"/src/data/ar/image-clue/fruits-and-vegetables/data.json":()=>o(()=>import("./data-DlhJ3pZw.js"),[]),"/src/data/ar/image-clue/shapes/data.json":()=>o(()=>import("./data-B126H-NP.js"),[]),"/src/data/ar/img-choice/animals/data.json":()=>o(()=>import("./data-6hZ_2-dK.js"),[]),"/src/data/ar/letter-flow/easy.json":()=>o(()=>import("./easy-C68xgLTr.js"),[]),"/src/data/ar/letter-flow/medium.json":()=>o(()=>import("./medium-DnN41iEv.js"),[]),"/src/data/ar/outside-the-story/animals.json":()=>o(()=>import("./animals-BD_uC3F6.js"),[]),"/src/data/ar/outside-the-story/anime.json":()=>o(()=>import("./anime-X9XTb-jh.js"),[]),"/src/data/ar/outside-the-story/cars.json":()=>o(()=>import("./cars-LFoQ5kcr.js"),[]),"/src/data/ar/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-9ln4fVtF.js"),[]),"/src/data/ar/outside-the-story/characters.json":()=>o(()=>import("./characters-BClrgWDD.js"),[]),"/src/data/ar/outside-the-story/clothes.json":()=>o(()=>import("./clothes-DZukcyjc.js"),[]),"/src/data/ar/outside-the-story/drinks.json":()=>o(()=>import("./drinks-DWTisQdZ.js"),[]),"/src/data/ar/outside-the-story/foods.json":()=>o(()=>import("./foods-BPEl4jwc.js"),[]),"/src/data/ar/outside-the-story/football.json":()=>o(()=>import("./football-BkDTW0je.js"),[]),"/src/data/ar/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-CWZ59ral.js"),[]),"/src/data/ar/outside-the-story/gamers.json":()=>o(()=>import("./gamers-DU27ka0Y.js"),[]),"/src/data/ar/outside-the-story/geography.json":()=>o(()=>import("./geography-Bmt1Mp9F.js"),[]),"/src/data/ar/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-CvncURYW.js"),[]),"/src/data/ar/outside-the-story/science.json":()=>o(()=>import("./science-C1rxd0mO.js"),[]),"/src/data/ar/outside-the-story/series.json":()=>o(()=>import("./series-DgCSJJru.js"),[]),"/src/data/ar/outside-the-story/spy.json":()=>o(()=>import("./spy-CTUdze8o.js"),[]),"/src/data/ar/outside-the-story/sweets.json":()=>o(()=>import("./sweets-0_2hbNMS.js"),[]),"/src/data/ar/phrase-clue/animals/easy.json":()=>o(()=>import("./easy-B_GJKLA_.js"),[]),"/src/data/ar/phrase-clue/animals/hard.json":()=>o(()=>import("./hard-7EfMbXs4.js"),[]),"/src/data/ar/phrase-clue/animals/medium.json":()=>o(()=>import("./medium-Bcn1oCUk.js"),[]),"/src/data/ar/phrase-clue/geography/easy.json":()=>o(()=>import("./easy-B_kcdeCx.js"),[]),"/src/data/ar/phrase-clue/geography/hard.json":()=>o(()=>import("./hard-BCuCMNGp.js"),[]),"/src/data/ar/phrase-clue/geography/medium.json":()=>o(()=>import("./medium-CkoNY3Du.js"),[]),"/src/data/ar/phrase-clue/science/easy.json":()=>o(()=>import("./easy-f07zg_lU.js"),[]),"/src/data/ar/phrase-clue/science/hard.json":()=>o(()=>import("./hard-CV32qLEY.js"),[]),"/src/data/ar/phrase-clue/science/medium.json":()=>o(()=>import("./medium-BtIrOjNp.js"),[]),"/src/data/ar/word-choice/animals/data.json":()=>o(()=>import("./data-Bij5nysW.js"),[]),"/src/data/en/formation/easy.json":()=>o(()=>import("./easy-CqPS8TrH.js"),[]),"/src/data/en/image-clue/animals/data.json":()=>o(()=>import("./data-BYo_61tt.js"),[]),"/src/data/en/image-clue/fruits-and-vegetables/data.json":()=>o(()=>import("./data-B6FoT8eG.js"),[]),"/src/data/en/image-clue/shapes/data.json":()=>o(()=>import("./data-Bu1Ld6Qx.js"),[]),"/src/data/en/img-choice/animals/data.json":()=>o(()=>import("./data-CtXqoHRL.js"),[]),"/src/data/en/letter-flow/easy.json":()=>o(()=>import("./easy-DqbTaQjR.js"),[]),"/src/data/en/outside-the-story/animals.json":()=>o(()=>import("./animals-D78oH89-.js"),[]),"/src/data/en/outside-the-story/anime.json":()=>o(()=>import("./anime-DXIlEidq.js"),[]),"/src/data/en/outside-the-story/cars.json":()=>o(()=>import("./cars-Cw03Nxyo.js"),[]),"/src/data/en/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-DwVIQVvA.js"),[]),"/src/data/en/outside-the-story/characters.json":()=>o(()=>import("./characters-Dl2vwTPn.js"),[]),"/src/data/en/outside-the-story/clothes.json":()=>o(()=>import("./clothes-BiLKpCWj.js"),[]),"/src/data/en/outside-the-story/drinks.json":()=>o(()=>import("./drinks-CP1Emjyy.js"),[]),"/src/data/en/outside-the-story/foods.json":()=>o(()=>import("./foods-BKBSmJG2.js"),[]),"/src/data/en/outside-the-story/football.json":()=>o(()=>import("./football-B8eU_HgW.js"),[]),"/src/data/en/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-B5narx4J.js"),[]),"/src/data/en/outside-the-story/gamers.json":()=>o(()=>import("./gamers-Dm5Tu0YA.js"),[]),"/src/data/en/outside-the-story/geography.json":()=>o(()=>import("./geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-BnHY6_tE.js"),[]),"/src/data/en/outside-the-story/science.json":()=>o(()=>import("./science-DF1sazzy.js"),[]),"/src/data/en/outside-the-story/series.json":()=>o(()=>import("./series-dqakDLa9.js"),[]),"/src/data/en/outside-the-story/spy.json":()=>o(()=>import("./spy-DLpfZG_H.js"),[]),"/src/data/en/outside-the-story/sweets.json":()=>o(()=>import("./sweets-DDZ5JqsI.js"),[]),"/src/data/en/phrase-clue/animals/easy.json":()=>o(()=>import("./easy-vc2CgBiI.js"),[]),"/src/data/en/phrase-clue/animals/hard.json":()=>o(()=>import("./hard-BmQiyFGH.js"),[]),"/src/data/en/phrase-clue/animals/medium.json":()=>o(()=>import("./medium-CDppU-oU.js"),[]),"/src/data/en/phrase-clue/geography/easy.json":()=>o(()=>import("./easy-v49lXgS1.js"),[]),"/src/data/en/phrase-clue/geography/hard.json":()=>o(()=>import("./hard-Hc9ZYG1D.js"),[]),"/src/data/en/phrase-clue/geography/medium.json":()=>o(()=>import("./medium-Yt4_5ZKV.js"),[]),"/src/data/en/phrase-clue/science/easy.json":()=>o(()=>import("./easy-CXDUIzZm.js"),[]),"/src/data/en/phrase-clue/science/hard.json":()=>o(()=>import("./hard-BPi6SzUA.js"),[]),"/src/data/en/phrase-clue/science/medium.json":()=>o(()=>import("./medium-Dm_81XWt.js"),[]),"/src/data/en/word-choice/animals/data.json":()=>o(()=>import("./data-BDxquZu-.js"),[])})[x];return I?((await I()).default?.levels||[]).map(m=>{if(typeof m=="object"&&m!==null&&"id"in m&&"solutionWord"in m&&"gridSize"in m&&"endpoints"in m){const{width:C,height:f}=m.gridSize,D=[];for(let u=0;u<f;u++)for(let e=0;e<C;e++)D.push({x:e,y:u,letter:"",isUsed:!1});const $=m.endpoints,b=Array.from(new Set($.map(u=>u.letter))),R=new Map;b.forEach((u,e)=>{R.set(u,Fe(e,b.length,72,48))}),$.forEach(u=>{const e=u.y*C+u.x,s=R.get(u.letter);e<D.length&&(D[e]={x:u.x,y:u.y,letter:u.letter,isUsed:!1,color:s})});const g=m;return{id:String(g.id),difficulty:i,words:[g.solutionWord],board:D,solution:g.solutionWord,endpoints:g.endpoints.map(u=>({...u,color:R.get(u.letter)}))}}return null}).filter(m=>m!==null):[]}catch(x){return console.error(`LetterFlowGameEngine: Failed to load levels for ${c}/${i}.`,x),[{id:"error",difficulty:"easy",words:[],board:[],solution:"",endpoints:[]}]}}generateBoard(a,c,i,x){if(!x)return[];const E=Ce(x.split("")),I=Math.ceil(Math.sqrt(E.length)),V=[];for(let P=0;P<I;P++)for(let m=0;m<I;m++){const C=P*I+m;C<E.length&&V.push({x:m,y:P,letter:E[C],isUsed:!1})}return V}}const he=new Ue,ce=24;function Be(r,a=ce,c=68,i=48){return`hsl(${Math.round(r*360/a)%360}, ${c}%, ${i}%)`}function Ee(r){if(!r)return;let a=0;const c=r.toUpperCase();for(let x=0;x<c.length;x++)a=(a<<5)-a+c.charCodeAt(x),a|=0;const i=Math.abs(a)%ce;return Be(i,ce)}function Ge(){const r=De(),a=be(),{language:c,categories:i,difficulty:x,gameMode:E,teams:I,currentTeam:V,consumeHint:P}=xe(),{t:m}=ge(),{loading:C,currentLevel:f,currentLevelIndex:D,nextLevel:$}=$e(he,{language:c,categories:i,difficulty:x}),[b,R]=L.useState([]),[g,u]=L.useState([]),[e,s]=L.useState([]),[w,p]=L.useState(null),[v,d]=L.useState(null),[J,B]=L.useState("playing");L.useEffect(()=>{if(f){if(f.board&&f.board.length>0&&f.board.some(t=>t.letter))R(f.board.map(t=>({...t})));else{const t=he.generateBoard("",f.difficulty,c,f.board.map(n=>n.letter).join(""));R(t)}s([]),u([]),d(null),B("playing")}},[f,c]);const K=L.useMemo(()=>[...new Set(f?.endpoints.map(t=>t.letter)||[])],[f]),S=L.useMemo(()=>{const t=new Map;return f?.endpoints.forEach(n=>t.set(`${n.x}-${n.y}`,n.color)),t},[f]),ee=L.useCallback(t=>{if(t)return Ee(t)},[]),q=L.useCallback(t=>f?f.endpoints.some(n=>n.x===t.x&&n.y===t.y&&n.letter===t.letter):!1,[f]),ue=L.useCallback((t,n)=>{const l=Math.abs(t.x-n.x),j=Math.abs(t.y-n.y);return l===1&&j===0||l===0&&j===1},[]),_e=L.useCallback(t=>{if(t.length<2)return!0;for(let n=1;n<t.length;n++)if(!ue(t[n-1],t[n]))return!1;return!0},[ue]),me=L.useCallback((t,n,l)=>{if(!t.letter){if(t.isUsed){if(l){const j=e.find(M=>M.word===l);if(j&&j.cells.some(M=>M.x===t.x&&M.y===t.y))return!1}return!0}return!1}return!(n&&t.x===n.x&&t.y===n.y||l&&t.letter===l&&q(t))},[e,q]),te=L.useCallback(t=>e.length===0?[]:e.filter(n=>n.cells.some(l=>t.some(j=>j.x===l.x&&j.y===l.y))),[e]),O=L.useCallback((t,n="info",l=1200)=>{p({message:t,type:n}),l>0&&setTimeout(()=>p(null),l)},[]),ve=L.useCallback(t=>{if(!q(t))return;const n=e.find(l=>l.word===t.letter);n&&(s(l=>l.filter(j=>j.word!==t.letter)),R(l=>l.map(j=>{const M=n.cells.some(k=>k.x===j.x&&k.y===j.y),F=S.get(`${j.x}-${j.y}`);return M?{...j,isUsed:!1,color:F??void 0}:j})),O(`Removed connection for ${t.letter}`,"info",900)),d(t.letter),u([t])},[e,q,O,S]),je=L.useCallback(t=>{if(!v||g.length===0)return;const n=g[0]||null;if(me(t,n,v)||!(t.letter===v||t.letter===""))return;const l=g[g.length-1];if(l&&l.x===t.x&&l.y===t.y)return;const j=Math.abs(t.x-l.x),M=Math.abs(t.y-l.y);if(j===1&&M===1||j>1||M>1)return;const F=g.findIndex(z=>z.x===t.x&&z.y===t.y);if(F!==-1){u(z=>z.slice(0,F+1));return}if(t.isUsed)return;const k=[...g,t];if(!_e(k))return;if(q(t)&&!(g.length>0&&g[0].x===t.x&&g[0].y===t.y)&&t.letter===v){const z=te(k);z.length>0&&(s(T=>T.filter(A=>!z.includes(A))),R(T=>T.map(A=>{const W=z.some(X=>X.cells.some(Y=>Y.x===A.x&&Y.y===A.y)),Z=S.get(`${A.x}-${A.y}`);return W?{...A,isUsed:!1,color:Z??void 0}:A})),O("Existing connection(s) removed by new connection","warning",1100));const oe=b.find(T=>T.x===k[0].x&&T.y===k[0].y)?.color||ee(k[0].letter);R(T=>T.map(A=>{const W=k.some(X=>X.x===A.x&&X.y===A.y),Z=S.get(`${A.x}-${A.y}`);return W?{...A,isUsed:!0,color:Z??oe}:A}));const ae={word:v,cells:k.map(T=>({...T,color:oe})),startIndex:0};s(T=>[...T.filter(A=>A.word!==v),ae]),O(`Connected ${v}`,"success",900),d(null),u([]);const ie=[...e.map(T=>T.word),v].filter(Boolean),Q=Array.from(new Set(ie));K.every(T=>Q.includes(T))&&(O(m.congrats,"success",2e3),E==="competitive"?setTimeout(()=>$(),2e3):B("won"))}else u(k)},[v,g,me,q,_e,te,b,ee,e,K,$,m,O,S,E,B]),Le=L.useCallback(()=>{if(g.length>0){const t=g[g.length-1];q(t)&&!(g.length>1&&g[0].x===t.x&&g[0].y===t.y)&&t.letter===v||(d(null),u([]),O("Path must connect two endpoints!","error",1200))}},[g,q,v,O]),Ie=L.useCallback(()=>{if(!f||e.length>=f.endpoints.length/2)return;if(E==="competitive"&&!P(I[V].id)){O(m.noHintsLeft,"error",2e3);return}const t=K.filter(_=>!e.some(h=>h.word===_));if(t.length===0)return;const n=t[0],l=f.endpoints.filter(_=>_.letter===n);if(l.length<2){O(`No endpoints found for ${n}`,"error",1500);return}const j=l[0],M=l[1],F=new Map;b.forEach(_=>F.set(`${_.x}-${_.y}`,_));const k=b.map(_=>_.x),ne=b.map(_=>_.y),z=Math.min(...k),oe=Math.max(...k),ae=Math.min(...ne),ie=Math.max(...ne),Q=`${j.x}-${j.y}`,de=`${M.x}-${M.y}`,T=[Q],A=new Set([Q]),W=new Map([[Q,null]]),Z=(_,h)=>{const N=F.get(`${_}-${h}`);return N?!N.letter||N.letter===n:!1},X=_=>{const[h,N]=_.split("-").map(U=>parseInt(U,10));return[[h+1,N],[h-1,N],[h,N+1],[h,N-1]].filter(([U,G])=>U>=z&&U<=oe&&G>=ae&&G<=ie).map(([U,G])=>`${U}-${G}`)};let Y=!1;for(;T.length>0&&!Y;){const _=T.shift();if(_===de){Y=!0;break}for(const h of X(_)){if(A.has(h))continue;const[N,U]=h.split("-").map(G=>parseInt(G,10));Z(N,U)&&(A.add(h),W.set(h,_),T.push(h))}}if(!Y){O(`No path found for ${n}`,"error",1600);return}const H=[];let re=de;for(;re;){const _=F.get(re);_&&H.push({..._}),re=W.get(re)??null}H.reverse();const le=te(H);le.length>0&&(s(_=>_.filter(h=>!le.includes(h))),R(_=>_.map(h=>{const N=le.some(G=>G.cells.some(pe=>pe.x===h.x&&pe.y===h.y)),U=S.get(`${h.x}-${h.y}`);return N?{...h,isUsed:!1,color:U??void 0}:h})),O("Existing connection(s) removed by hint connection","warning",1100));const fe=F.get(`${H[0].x}-${H[0].y}`)?.color||ee(H[0].letter);R(_=>_.map(h=>{const N=H.some(G=>G.x===h.x&&G.y===h.y),U=S.get(`${h.x}-${h.y}`);return N?{...h,isUsed:!0,color:U??fe}:h}));const Ae={word:n,cells:H.map(_=>({..._,color:fe})),startIndex:0};s(_=>[..._.filter(h=>h.word!==n),Ae]),O(`Hint: Connected ${n}`,"info",900),d(null),u([]);const Re=[...e.map(_=>_.word),n].filter(Boolean),Oe=Array.from(new Set(Re));K.every(_=>Oe.includes(_))&&(O(m.congrats,"success",2e3),E==="competitive"?setTimeout(()=>$(),2e3):B("won"))},[f,b,e,K,S,ee,te,O,E,I,V,P,m,$,B]),we=L.useCallback(()=>{if(e.length===0)return;const t=e[e.length-1];s(n=>n.slice(0,-1)),R(n=>n.map(l=>{if(!t.cells.some(F=>F.x===l.x&&F.y===l.y))return l;const M=S.get(`${l.x}-${l.y}`);return{...l,isUsed:!1,color:M??void 0}})),u([]),d(null),O(`Undo: Removed connection for ${t.word}`,"info"),J==="won"&&B("playing")},[e,O,S,J,B]),Pe=L.useCallback(()=>{s([]),R(t=>t.map(n=>{const l=S.get(`${n.x}-${n.y}`);return{...n,isUsed:!1,color:l}})),u([]),d(null),B("playing"),O("Game reset - all connections removed","info")},[O,S,B]),Te=L.useCallback(()=>{r(E==="competitive"?`/team-config/${a.gameType}`:`/game-mode/${a.gameType}`)},[r,a.gameType,E]);return{loading:C,currentLevel:f,currentLevelIndex:D,board:b,selectedPath:g,foundWords:e,notification:w,gameState:J,activeLetter:v,handleBack:Te,handleMouseDown:ve,handleMouseEnter:je,handleMouseUp:Le,clearSelection:()=>{u([]),d(null)},onHint:Ie,onUndo:we,onReset:Pe,nextLevel:$}}function ze({letter:r,x:a,y:c,isSelected:i=!1,isFound:x=!1,isActive:E=!1,onMouseDown:I,onMouseEnter:V,onMouseUp:P,disabled:m=!1,className:C,connectionDirections:f=[],connectionColor:D,cellColor:$}){const b={x:a,y:c,letter:r},R=p=>{m||!I||(p.target.setPointerCapture(p.pointerId),I(b))},g=p=>{if(p.buttons!==1||m||!V)return;const d=document.elementFromPoint(p.clientX,p.clientY)?.closest("[data-cell-x]");if(d){const J=parseInt(d.dataset.cellX||"0",10),B=parseInt(d.dataset.cellY||"0",10),K=d.querySelector(".cell-letter");V({x:J,y:B,letter:K?.textContent?.trim()||""})}},u=p=>{m||!P||(p.target.releasePointerCapture(p.pointerId),P())},e=p=>{m||!I||(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),I(b))},s=56,w=D??$??void 0;return y.jsxs("div",{role:"button",tabIndex:m?-1:0,"aria-disabled":m,"aria-pressed":i||void 0,"data-cell-x":a,"data-cell-y":c,onPointerDown:R,onPointerMove:g,onPointerUp:u,onPointerCancel:u,onKeyDown:e,className:se("aspect-square flex items-center justify-center rounded-md text-xl font-bold select-none relative transition-all duration-150 touch-none",{"bg-gray-50 dark:bg-gray-800":!i&&!x&&!E,"cursor-pointer":!m,"cursor-not-allowed opacity-70":m,"text-gray-900 dark:text-gray-100":!i&&!x&&!E&&!w},C),children:[f.includes("top")&&y.jsx("div",{"aria-hidden":!0,className:"absolute top-0 left-1/2 transform -translate-x-1/2",style:{width:`${Math.max(6,s*.1)}%`,height:"50%",background:D,zIndex:0}}),f.includes("bottom")&&y.jsx("div",{"aria-hidden":!0,className:"absolute bottom-0 left-1/2 transform -translate-x-1/2",style:{width:`${Math.max(6,s*.1)}%`,height:"50%",background:D,zIndex:0}}),f.includes("left")&&y.jsx("div",{"aria-hidden":!0,className:"absolute left-0 top-1/2 transform -translate-y-1/2",style:{height:`${Math.max(6,s*.1)}%`,width:"50%",background:D,zIndex:0}}),f.includes("right")&&y.jsx("div",{"aria-hidden":!0,className:"absolute right-0 top-1/2 transform -translate-y-1/2",style:{height:`${Math.max(6,s*.1)}%`,width:"50%",background:D,zIndex:0}}),y.jsx("div",{className:"flex items-center justify-center rounded-full z-10 pointer-events-none",style:{width:`${s}%`,height:`${s}%`,background:w??"#ffffff",boxShadow:w?"0 2px 8px rgba(0,0,0,0.12)":void 0,border:w?"none":"1px solid rgba(0,0,0,0.06)"},children:r?y.jsx("span",{className:"text-sm font-bold cell-letter",style:{color:w?"#fff":"#111"},children:r}):null})]})}function ye(r){return Ee(r)}function qe({cells:r,selectedPath:a,foundWords:c,activeLetter:i,onMouseDown:x,onMouseEnter:E,onMouseUp:I,className:V,dir:P="ltr"}){const m=r.length===0?0:Math.max(...r.map(e=>e.x))+1,C=P==="rtl",f=e=>`${e.x}-${e.y}`,D=new Map;a.forEach(e=>D.set(f(e),e));const $=new Map;c.forEach(e=>e.cells.forEach(s=>$.set(f(s),{word:e.word,cells:e.cells})));const b=e=>{const s=[],w=[...c.map(p=>p.cells),a];for(const p of w){const v=p.findIndex(d=>d.x===e.x&&d.y===e.y);if(v!==-1){if(v>0){const d=p[v-1];d.x===e.x-1&&d.y===e.y&&s.push("left"),d.x===e.x+1&&d.y===e.y&&s.push("right"),d.x===e.x&&d.y===e.y-1&&s.push("top"),d.x===e.x&&d.y===e.y+1&&s.push("bottom")}if(v<p.length-1){const d=p[v+1];d.x===e.x-1&&d.y===e.y&&s.push("left"),d.x===e.x+1&&d.y===e.y&&s.push("right"),d.x===e.x&&d.y===e.y-1&&s.push("top"),d.x===e.x&&d.y===e.y+1&&s.push("bottom")}}}return[...new Set(s)]},R=e=>{for(const s of c)if(s.cells.some(w=>w.x===e.x&&w.y===e.y)){const w=s.cells[0]?.color??s.cells.find(v=>v.color)?.color;if(w)return w;const p=r.find(v=>v.x===s.cells[0].x&&v.y===s.cells[0].y);return p?.color?p.color:ye(s.word)}if(a&&a.length>0&&a.some(s=>s.x===e.x&&s.y===e.y)){const s=a[0];if(s?.color)return s.color;const w=r.find(p=>p.x===s.x&&p.y===s.y);return w?.color?w.color:ye(s?.letter)}if(e.color)return e.color},g=e=>D.has(f(e)),u=e=>$.has(f(e));return y.jsx("div",{className:se("grid gap-1 mx-auto max-w-md",V,{"rtl-direction":C}),style:{gridTemplateColumns:`repeat(${m}, minmax(0, 1fr))`,direction:C?"rtl":"ltr",touchAction:"none"},children:r.map(e=>{const s=b(e),w=R(e),p=u(e)||e.letter!==""&&e.letter!==i&&e.isUsed;return y.jsx(ze,{letter:e.letter,x:e.x,y:e.y,isSelected:g(e),isFound:u(e),isActive:i&&e.letter===i?!0:void 0,onMouseDown:x,onMouseEnter:E,onMouseUp:I,disabled:p,connectionDirections:s,connectionColor:w,cellColor:e.color},`${e.x}-${e.y}`)})})}function He({foundWords:r,t:a,className:c}){return r.length===0?null:y.jsxs("div",{className:se("mt-6",c),children:[y.jsxs("div",{className:"text-lg font-semibold mb-2",children:[a.selected,":"]}),y.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((i,x)=>y.jsx("div",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-md",children:i.word},x))})]})}function Ke({foundWords:r,totalWords:a,t:c,className:i}){const x=r.length/a;return y.jsxs("div",{className:se("mt-6 text-center",i),children:[y.jsxs("div",{className:"text-gray-600",children:[c.selected," ",r.length," ",c.of," ",a]}),y.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:y.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-500",style:{width:`${x*100}%`}})})]})}function We(){L.useEffect(()=>{const r=EventTarget.prototype.addEventListener;return EventTarget.prototype.addEventListener=function(a,c,i){if((a==="touchmove"||a==="touchstart"||a==="touchend")&&typeof i=="object"&&i&&!("passive"in i)){const x={...i,passive:!1};return r.call(this,a,c,x)}return r.call(this,a,c,i)},()=>{EventTarget.prototype.addEventListener=r}},[])}const Xe=({notification:r,boardContent:a,foundWordsContent:c,progressContent:i,gameControlsContent:x,...E})=>{const I=r?.message??null,V=r?.type??"info";return y.jsxs(Se,{...E,children:[I&&y.jsx(Me,{message:I,type:V}),y.jsxs("div",{className:"flex flex-col items-center gap-4",children:[y.jsx("div",{className:"w-full touch-none transition-colors duration-300",children:a}),c,y.jsx("div",{className:"w-full max-w-md",children:x}),i]})]})},rt=()=>{const{t:r}=ge(),{gameMode:a}=xe(),c=ke("letterFlow"),i=c?{title:c.title??"",description:c.description??"",steps:c.steps??[]}:void 0;We();const{loading:x,currentLevel:E,board:I,selectedPath:V,foundWords:P,notification:m,gameState:C,activeLetter:f,handleBack:D,handleMouseDown:$,handleMouseEnter:b,handleMouseUp:R,onHint:g,onUndo:u,onReset:e,clearSelection:s,currentLevelIndex:w,nextLevel:p}=Ge();if(x)return y.jsx("div",{className:"flex justify-center items-center h-screen",children:y.jsxs("p",{children:[r.loading,"..."]})});if(!E)return y.jsxs("div",{className:"flex flex-col items-center justify-center h-screen gap-4 p-4 text-center",children:[y.jsx("p",{className:"text-xl font-semibold",children:r.noLevelsFound}),y.jsx(Ve,{onClick:D,children:r.back})]});const v=Math.floor((E?.endpoints.length??0)/2);return y.jsx(Xe,{title:r.letterFlowTitle??E.id,levelIndex:w??0,onBack:D,difficulty:E.difficulty,instructions:i,notification:m,boardContent:y.jsx(qe,{cells:I,selectedPath:V,foundWords:P,activeLetter:f,onMouseDown:d=>$({...d,isUsed:!1}),onMouseEnter:d=>b({...d,isUsed:!1}),onMouseUp:R}),foundWordsContent:P.length>0?y.jsx(He,{foundWords:P,t:{selected:r.selected}}):null,gameControlsContent:y.jsx(Ne,{onReset:e,onRemoveLetter:u,onClearAnswer:s,onHint:g,onNextLevel:p,canRemove:P.length>0,canClear:V.length>0,canCheck:!1,canNext:C==="won",canHint:P.length<v,gameState:C,gameMode:a,isKidsMode:!1,labels:{remove:r.undo,clear:r.clear,check:r.check,hint:r.hint,showSolution:r.showSolution,reset:r.reset,prev:r.prev,next:r.next},showOnly:["remove","hint","reset","next"]}),progressContent:y.jsx(Ke,{foundWords:P,totalWords:v,t:{selected:r.selected,of:r.of}})})};export{rt as default};
