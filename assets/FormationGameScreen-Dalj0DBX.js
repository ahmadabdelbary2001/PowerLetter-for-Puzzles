import{_ as e,u as q,a as J,b as K,c as N,r as c,j as n,g as $,B as k,d as Q,C as X}from"./index-DEbMSiNp.js";import{s as Y,u as Z,a as ee,e as te,G as se,N as ae,L as re}from"./instructions-DjHNv5WI.js";import{R as ne,G as b,a as oe}from"./GameButton-BXB-vHJh.js";class ie{async loadLevels(m){const{language:d,difficulty:o}=m;if(!o)return[];try{const i=`/src/data/${d}/formation/${d}-formation-${o}.json`,_=Object.assign({"/src/data/ar/clue/animals/ar-clue-animals-easy.json":()=>e(()=>import("./ar-clue-animals-easy-B_GJKLA_.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-hard.json":()=>e(()=>import("./ar-clue-animals-hard-7EfMbXs4.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-medium.json":()=>e(()=>import("./ar-clue-animals-medium-Bcn1oCUk.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-words.json":()=>e(()=>import("./ar-clue-animals-words-DxH5pZeF.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-easy.json":()=>e(()=>import("./ar-clue-geography-easy-B_kcdeCx.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-hard.json":()=>e(()=>import("./ar-clue-geography-hard-BCuCMNGp.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-medium.json":()=>e(()=>import("./ar-clue-geography-medium-CkoNY3Du.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-words.json":()=>e(()=>import("./ar-clue-geography-words-C7oqRjv9.js"),[]),"/src/data/ar/clue/science/ar-clue-science-easy.json":()=>e(()=>import("./ar-clue-science-easy-f07zg_lU.js"),[]),"/src/data/ar/clue/science/ar-clue-science-hard.json":()=>e(()=>import("./ar-clue-science-hard-CV32qLEY.js"),[]),"/src/data/ar/clue/science/ar-clue-science-medium.json":()=>e(()=>import("./ar-clue-science-medium-BtIrOjNp.js"),[]),"/src/data/ar/clue/science/ar-clue-science-words.json":()=>e(()=>import("./ar-clue-science-words-DpIQpR0-.js"),[]),"/src/data/ar/formation/ar-formation-easy.json":()=>e(()=>import("./ar-formation-easy-CuHzQLY1.js"),[]),"/src/data/ar/formation/ar-formation-hard.json":()=>e(()=>import("./ar-formation-hard-CRxFgu7h.js"),[]),"/src/data/ar/image-clue/animals/data.json":()=>e(()=>import("./data-USJTiWy0.js"),[]),"/src/data/ar/image-clue/fruits/data.json":()=>e(()=>import("./data-CenmuYLK.js"),[]),"/src/data/ar/image-clue/shapes/data.json":()=>e(()=>import("./data-B126H-NP.js"),[]),"/src/data/ar/letter-flow/ar-flow-easy.json":()=>e(()=>import("./ar-flow-easy-C68xgLTr.js"),[]),"/src/data/ar/letter-flow/ar-flow-medium.json":()=>e(()=>import("./ar-flow-medium-BL27Zp8Y.js"),[]),"/src/data/ar/word-choice/animals/data.json":()=>e(()=>import("./data-Bij5nysW.js"),[]),"/src/data/en/clue/animals/en-clue-animals-easy.json":()=>e(()=>import("./en-clue-animals-easy-vc2CgBiI.js"),[]),"/src/data/en/clue/animals/en-clue-animals-hard.json":()=>e(()=>import("./en-clue-animals-hard-BmQiyFGH.js"),[]),"/src/data/en/clue/animals/en-clue-animals-medium.json":()=>e(()=>import("./en-clue-animals-medium-CDppU-oU.js"),[]),"/src/data/en/clue/animals/en-clue-animals-words.json":()=>e(()=>import("./en-clue-animals-words-OyMRQ2OB.js"),[]),"/src/data/en/clue/geography/en-clue-geography-easy.json":()=>e(()=>import("./en-clue-geography-easy-v49lXgS1.js"),[]),"/src/data/en/clue/geography/en-clue-geography-hard.json":()=>e(()=>import("./en-clue-geography-hard-Hc9ZYG1D.js"),[]),"/src/data/en/clue/geography/en-clue-geography-medium.json":()=>e(()=>import("./en-clue-geography-medium-Yt4_5ZKV.js"),[]),"/src/data/en/clue/geography/en-clue-geography-words.json":()=>e(()=>import("./en-clue-geography-words-BJFrdNPX.js"),[]),"/src/data/en/clue/science/en-clue-science-easy.json":()=>e(()=>import("./en-clue-science-easy-CXDUIzZm.js"),[]),"/src/data/en/clue/science/en-clue-science-hard.json":()=>e(()=>import("./en-clue-science-hard-Dqcig8Ht.js"),[]),"/src/data/en/clue/science/en-clue-science-medium.json":()=>e(()=>import("./en-clue-science-medium-Dm_81XWt.js"),[]),"/src/data/en/clue/science/en-clue-science-words.json":()=>e(()=>import("./en-clue-science-words-BdiwMlAj.js"),[]),"/src/data/en/formation/en-formation-easy.json":()=>e(()=>import("./en-formation-easy-CqPS8TrH.js"),[]),"/src/data/en/image-clue/animals/data.json":()=>e(()=>import("./data-BYo_61tt.js"),[]),"/src/data/en/image-clue/fruits/data.json":()=>e(()=>import("./data-OxJ4m8-5.js"),[]),"/src/data/en/image-clue/shapes/data.json":()=>e(()=>import("./data-Bu1Ld6Qx.js"),[]),"/src/data/en/letter-flow/en-flow-easy.json":()=>e(()=>import("./en-flow-easy-DqbTaQjR.js"),[]),"/src/data/en/word-choice/animals/data.json":()=>e(()=>import("./data-BDxquZu-.js"),[])})[i];return _?((await _()).default?.levels||[]).map(t=>typeof t=="object"&&t!==null&&"id"in t&&"words"in t&&Array.isArray(t.words)&&"grid"in t&&"baseLetters"in t?{id:String(t.id),difficulty:o,words:t.words,grid:t.grid,baseLetters:String(t.baseLetters),solution:t.words[0]||""}:null).filter(t=>t!==null):[]}catch(i){return console.error(`FormationGameEngine: Failed to load levels for ${d}/${o}.`,i),[{id:"error",difficulty:"easy",words:[],grid:[],baseLetters:"ERROR",solution:""}]}}generateLetters(m,d,o,i){return i?Y(i.split("")):[]}}const C=new ie;function ce(){const a=q(),m=J(),{language:d,categories:o,difficulty:i,gameMode:f,teams:_,currentTeam:l,consumeHint:r}=K(),{t}=N(),{loading:p,currentLevel:s,currentLevelIndex:h,nextLevel:x}=Z(C,{language:d,categories:o,difficulty:i}),[R,I]=c.useState([]),[g,j]=c.useState(""),[A,D]=c.useState(new Set),[T,V]=c.useState(new Set),[z,y]=c.useState(null),[S,O]=c.useState([]);c.useEffect(()=>{s&&(C.generateLetters&&I(C.generateLetters("",s.difficulty,d,s.baseLetters)),D(new Set),j(""),O([]),V(new Set))},[s,d]);const G=c.useCallback((u,L)=>{S.includes(L)||(j(E=>E+u),O(E=>[...E,L]))},[S]),F=c.useCallback(()=>{j(u=>u.slice(0,-1)),O(u=>u.slice(0,-1))},[]),W=c.useCallback(()=>{I(u=>[...u].sort(()=>Math.random()-.5))},[]),M=c.useCallback(()=>{if(!s||g.length===0)return;const u=new Set(A);if(s.words.includes(g)&&!u.has(g)){u.add(g),D(u);const L=s.words.indexOf(g),E=new Set(T);s.grid.forEach(w=>{w.words.includes(L)&&E.add(`${w.x},${w.y}`)}),V(E),y(t.congrats),u.size===s.words.length&&setTimeout(()=>x(),2e3)}else y(u.has(g)?t.alreadyFound:t.wrongAnswer);j(""),O([]),setTimeout(()=>y(null),1500)},[g,s,A,T,t,x]),B=c.useCallback(()=>{if(!s)return;if(f==="competitive"&&!r(_[l].id)){y(t.noHintsLeft),setTimeout(()=>y(null),2e3);return}const u=s.grid.filter(v=>!T.has(`${v.x},${v.y}`));if(u.length===0)return;const L=u[Math.floor(Math.random()*u.length)],E=new Set(T).add(`${L.x},${L.y}`);V(E);const w=[];if(s.words.forEach((v,U)=>{if(A.has(v))return;s.grid.filter(P=>P.words.includes(U)).every(P=>E.has(`${P.x},${P.y}`))&&w.push(v)}),w.length>0){const v=new Set([...A,...w]);D(v),y(`${t.congrats} ${t.found} ${w.join(", ")}`),v.size===s.words.length&&setTimeout(()=>x(),2e3)}else y(t.hintUsed);setTimeout(()=>y(null),1500)},[s,T,A,f,_,l,r,t,x]),H=c.useCallback(()=>{a(f==="competitive"?`/team-config/${m.gameType}`:`/game-mode/${m.gameType}`)},[a,m.gameType,f]);return{loading:p,currentLevel:s,currentLevelIndex:h,letters:R,currentInput:g,revealedCells:T,notification:z,usedLetterIndices:S,handleBack:H,onLetterSelect:G,onRemoveLast:F,onShuffle:W,onCheckWord:M,onHint:B}}const le=({letter:a="",isRevealed:m=!1,isEmpty:d=!1,size:o=40,className:i})=>d?n.jsx("div",{className:$("rounded-md border-2 border-transparent bg-transparent",i),style:{width:`${o}px`,height:`${o}px`}}):n.jsx("div",{className:$("rounded-md flex items-center justify-center font-bold border-2 flex-shrink-0 transition-all duration-300",m?"bg-primary/90 border-primary text-primary-foreground animate-in fade-in zoom-in-50":"bg-card border-border",i),style:{width:`${o}px`,height:`${o}px`,fontSize:`${o*.5}px`},children:m?a:""}),de=({grid:a,revealedCells:m,className:d})=>{const[o,i]=c.useState(40);if(c.useEffect(()=>{const r=()=>{const t=window.innerWidth;t<380?i(28):t<640?i(32):t<768?i(36):i(40)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),!a||a.length===0)return null;const f=Math.max(0,...a.map(r=>r.x)),_=Math.max(0,...a.map(r=>r.y)),l=Array.from({length:_+1},()=>Array(f+1).fill(null));return a.forEach(r=>{l[r.y]&&(l[r.y][r.x]=r)}),n.jsx("div",{className:$("flex flex-col gap-0.5 sm:gap-1 w-full overflow-x-auto py-1.5 sm:py-2",d),children:l.map((r,t)=>n.jsx("div",{className:"flex gap-0.5 sm:gap-1 justify-center",children:r.map((p,s)=>n.jsx(le,{letter:p?.letter,isRevealed:m.has(`${s},${t}`),isEmpty:!p,size:o},`${s}-${t}`))},t))})},ue=({letters:a,usedLetterIndices:m,onLetterSelect:d,onShuffle:o,className:i})=>{const[f,_]=c.useState(180),[l,r]=c.useState(40),[t,p]=c.useState(24);return c.useEffect(()=>{const s=()=>{const h=window.innerWidth;h<380?(_(120),r(28),p(16)):h<640?(_(140),r(32),p(20)):h<768?(_(160),r(36),p(24)):(_(180),r(40),p(28))};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),n.jsxs("div",{className:$("relative mx-auto my-0 sm:my-1",i),style:{width:`${f}px`,height:`${f}px`},children:[a.map((s,h)=>{const x=h/a.length*2*Math.PI,R=a.length>6?f*.45:f*.42,I=Math.cos(x)*R,g=Math.sin(x)*R,j=m.includes(h);return n.jsx(k,{onClick:()=>d(s,h),className:$("absolute rounded-full font-bold transition-all",j?"opacity-40 cursor-not-allowed":"hover:scale-105"),style:{width:`${l}px`,height:`${l}px`,fontSize:`${l*.5}px`,top:`calc(50% - ${l/2}px)`,left:`calc(50% - ${l/2}px)`,transform:`translate(${I}px, ${g}px)`},disabled:j,children:s},`${s}-${h}`)}),n.jsx(k,{size:"icon",variant:"ghost",onClick:o,className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full",style:{width:`${l*1.6}px`,height:`${l*1.6}px`},children:n.jsx(ne,{className:"text-muted-foreground",style:{width:`${t}px`,height:`${t}px`}})})]})};function me(){const{i18n:a}=Q();return(a.language?.toLowerCase()).startsWith("ar")?ee.formation:te.formation}const ge=()=>{const{t:a}=N(),m=me(),{loading:d,currentLevel:o,currentLevelIndex:i,letters:f,currentInput:_,revealedCells:l,notification:r,usedLetterIndices:t,handleBack:p,onLetterSelect:s,onRemoveLast:h,onShuffle:x,onCheckWord:R,onHint:I}=ce();return d?n.jsx("div",{className:"flex justify-center items-center h-screen",children:n.jsxs("p",{children:[a.loading,"..."]})}):!o||o.baseLetters==="ERROR"?n.jsxs("div",{className:"flex flex-col justify-center items-center h-screen gap-4 p-4 text-center",children:[n.jsx("p",{className:"text-xl font-semibold",children:a.noLevelsFound}),n.jsx(b,{onClick:p,children:a.back})]}):n.jsxs(se,{title:a.formationTitle,levelIndex:i,onBack:p,difficulty:o.difficulty,instructions:m,children:[r&&n.jsx(ae,{message:r,type:"info"}),n.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-3",children:[n.jsx(de,{grid:o.grid,revealedCells:l}),n.jsx("div",{className:"h-8 sm:h-10 flex justify-center items-center mb-1 sm:mb-2",children:n.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary tracking-wider",children:_||"..."})}),n.jsx(ue,{letters:f,usedLetterIndices:Array.from(t),onLetterSelect:s,onShuffle:x}),n.jsxs("div",{className:"flex w-full max-w-xs justify-center gap-1 sm:gap-2 px-1 flex-wrap sm:flex-nowrap items-center",children:[n.jsx(b,{variant:"outline",onClick:h,disabled:_.length===0,icon:oe,className:"flex-1 min-w-[80px] sm:min-w-[100px] py-1.5 sm:py-2 h-auto text-xs sm:text-sm px-2",children:a.remove}),n.jsx(b,{variant:"outline",onClick:I,disabled:l.size>=o.grid.length,icon:re,className:"flex-1 min-w-[80px] sm:min-w-[100px] py-1.5 sm:py-2 h-auto text-xs sm:text-sm px-2",children:a.hint}),n.jsx(b,{isPrimary:!0,onClick:R,disabled:_.length<2,icon:X,className:"flex-1 min-w-[120px] sm:min-w-[160px] py-2 sm:py-2.5 h-auto text-xs sm:text-sm px-3.5 text-center whitespace-nowrap font-semibold",children:a.check})]})]})]})};export{ge as default};
