import{_ as r,b as H,c as L,r as _,j as e,B as v,f as z,u as J}from"./index-B4fPtU2R.js";import{B as K,G as U}from"./GameLayout-D84wNv_h.js";class X extends K{getGameId(){return"outside-the-story"}getModulePath(t,s){return`/src/data/${t}/outside-the-story/${s}.json`}validateLevel(){return null}async loadLevels(t){const{language:s,categories:i}=t,m=Object.assign({"/src/data/ar/outside-the-story/animals.json":()=>r(()=>import("./animals-BD_uC3F6.js"),[]),"/src/data/ar/outside-the-story/anime.json":()=>r(()=>import("./anime-X9XTb-jh.js"),[]),"/src/data/ar/outside-the-story/cars.json":()=>r(()=>import("./cars-LFoQ5kcr.js"),[]),"/src/data/ar/outside-the-story/cartoons.json":()=>r(()=>import("./cartoons-9ln4fVtF.js"),[]),"/src/data/ar/outside-the-story/characters.json":()=>r(()=>import("./characters-BClrgWDD.js"),[]),"/src/data/ar/outside-the-story/clothes.json":()=>r(()=>import("./clothes-DZukcyjc.js"),[]),"/src/data/ar/outside-the-story/drinks.json":()=>r(()=>import("./drinks-DWTisQdZ.js"),[]),"/src/data/ar/outside-the-story/foods.json":()=>r(()=>import("./foods-BPEl4jwc.js"),[]),"/src/data/ar/outside-the-story/football.json":()=>r(()=>import("./football-BkDTW0je.js"),[]),"/src/data/ar/outside-the-story/fruits-and-vegetables.json":()=>r(()=>import("./fruits-and-vegetables-CWZ59ral.js"),[]),"/src/data/ar/outside-the-story/gamers.json":()=>r(()=>import("./gamers-DU27ka0Y.js"),[]),"/src/data/ar/outside-the-story/geography.json":()=>r(()=>import("./geography-Bmt1Mp9F.js"),[]),"/src/data/ar/outside-the-story/k-pop.json":()=>r(()=>import("./k-pop-CvncURYW.js"),[]),"/src/data/ar/outside-the-story/science.json":()=>r(()=>import("./science-C1rxd0mO.js"),[]),"/src/data/ar/outside-the-story/series.json":()=>r(()=>import("./series-DgCSJJru.js"),[]),"/src/data/ar/outside-the-story/spy.json":()=>r(()=>import("./spy-CTUdze8o.js"),[]),"/src/data/ar/outside-the-story/sweets.json":()=>r(()=>import("./sweets-0_2hbNMS.js"),[]),"/src/data/en/outside-the-story/animals.json":()=>r(()=>import("./animals-D78oH89-.js"),[]),"/src/data/en/outside-the-story/anime.json":()=>r(()=>import("./anime-DXIlEidq.js"),[]),"/src/data/en/outside-the-story/cars.json":()=>r(()=>import("./cars-Cw03Nxyo.js"),[]),"/src/data/en/outside-the-story/cartoons.json":()=>r(()=>import("./cartoons-DwVIQVvA.js"),[]),"/src/data/en/outside-the-story/characters.json":()=>r(()=>import("./characters-Dl2vwTPn.js"),[]),"/src/data/en/outside-the-story/clothes.json":()=>r(()=>import("./clothes-BiLKpCWj.js"),[]),"/src/data/en/outside-the-story/drinks.json":()=>r(()=>import("./drinks-CP1Emjyy.js"),[]),"/src/data/en/outside-the-story/foods.json":()=>r(()=>import("./foods-BKBSmJG2.js"),[]),"/src/data/en/outside-the-story/football.json":()=>r(()=>import("./football-B8eU_HgW.js"),[]),"/src/data/en/outside-the-story/fruits-and-vegetables.json":()=>r(()=>import("./fruits-and-vegetables-B5narx4J.js"),[]),"/src/data/en/outside-the-story/gamers.json":()=>r(()=>import("./gamers-Dm5Tu0YA.js"),[]),"/src/data/en/outside-the-story/geography.json":()=>r(()=>import("./geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/k-pop.json":()=>r(()=>import("./k-pop-BnHY6_tE.js"),[]),"/src/data/en/outside-the-story/science.json":()=>r(()=>import("./science-DF1sazzy.js"),[]),"/src/data/en/outside-the-story/series.json":()=>r(()=>import("./series-dqakDLa9.js"),[]),"/src/data/en/outside-the-story/spy.json":()=>r(()=>import("./spy-DLpfZG_H.js"),[]),"/src/data/en/outside-the-story/sweets.json":()=>r(()=>import("./sweets-DDZ5JqsI.js"),[])}),a=[];for(const y of i){const h=`/src/data/${s}/outside-the-story/${y}.json`,l=m[h];if(!l){console.warn(`OutsideStoryGameEngine: Could not find data file at path: ${h}`);continue}try{const c=await l(),g=Array.isArray(c.default?.words)?c.default.words.map(String):[];a.push({id:`${s}-${y}`,language:s,category:y,words:g,meta:c.default?.meta??{}})}catch(c){console.error(`OutsideStoryGameEngine: Failed to load or parse ${h}`,c)}}return a.length===0?[this.getErrorLevel()]:a}getErrorLevel(){return{id:"error",language:"en",category:"general",words:["ERROR"]}}}const Z=new X;function ee(){const{teams:o,language:t,categories:s,resetScores:i,setGameMode:m}=H(),{t:a}=L(),[y,h]=_.useState("role_reveal_handoff"),[l,c]=_.useState([]),[g,E]=_.useState(!0),[n,u]=_.useState(null),[P,w]=_.useState([]),[S,N]=_.useState(0),[k,D]=_.useState([]),[C,V]=_.useState(0),O=_.useCallback(d=>{const p=l.find(R=>R.category===d);if(!p||p.words.length<8){console.error(a.notEnoughWords??"Not enough words for this category.");return}if(o.length<3){console.error(a.min3Players??"Add at least 3 players.");return}const j=[...p.words].sort(()=>.5-Math.random()).slice(0,8),f=j[0],T=Math.floor(Math.random()*o.length),I=o[T].id,W=o.map(R=>R.id).filter(R=>R!==I),F={id:`${Date.now()}`,category:d,secret:f,words:j.sort(),outsiderId:I,insiders:W,votes:{},revealed:!1};u(F),N(0),h("role_reveal_handoff")},[l,o,a]);_.useEffect(()=>{let d=!0;return E(!0),(async()=>{try{const p=await Z.loadLevels({language:t??"ar",categories:s});d&&c(p)}finally{d&&E(!1)}})(),()=>{d=!1}},[t,s]),_.useEffect(()=>{g||l.length===0||n||O(l[0].category)},[g,l,n,O]);const G=_.useCallback(()=>{if(o.length<2)return;const d=[...o].sort(()=>Math.random()-.5),p=[];for(let x=0;x<d.length;x++){const j=d[x],f=d[(x+1)%d.length];p.push({asker:j,askee:f})}D(p),N(0),h("question_turn")},[o]),$=_.useCallback(()=>{if(!n)return;const d={};for(const f in n.votes)if(parseInt(f,10)!==n.outsiderId){const I=n.votes[f];d[I]=(d[I]||0)+1}let p=0,x=-1;for(const f in d)d[f]>p&&(p=d[f],x=parseInt(f,10));const j={...n,roundResult:{votedPlayerId:x,pointsAwarded:{}}};u(j),h("outsider_guess")},[n]),q=_.useCallback(d=>{if(!n)return;const p=d===n.secret,x={};o.forEach(f=>x[f.id]=0),p&&(x[n.outsiderId]=10);for(const f in n.votes){const T=parseInt(f,10),I=n.votes[f];T!==n.outsiderId&&I===n.outsiderId&&(x[T]=(x[T]||0)+10)}i(x);const j={...n,revealed:!0,roundResult:{...n.roundResult,outsiderGuessedCorrectly:p,pointsAwarded:x}};u(j),w(f=>[j,...f]),h("results")},[n,o,i]),B=()=>{N(d=>d+1)},M=()=>{V(d=>d+1)},Q=_.useCallback(()=>{N(0),V(0),u(null)},[]),Y=_.useCallback(()=>{m("competitive"),i({})},[m,i]);return{players:o,levels:l,loadingLevels:g,currentRound:n,history:P,startRound:O,playAgain:Q,changePlayersAndReset:Y,gameState:y,setGameState:h,currentPlayerTurn:S,nextTurn:B,finishVoting:$,handleOutsiderGuess:q,setupQuestionTurns:G,questionPairs:k,submitVote:(d,p)=>{u(x=>x?{...x,votes:{...x.votes,[d]:p}}:null)},votingPlayerIndex:C,nextVoter:M,t:a}}const A=({children:o,onBack:t})=>{const{t:s}=L();return e.jsx(U,{title:s.outsideTheStoryTitle??"Outside the Story",onBack:t,layoutType:"text",levelIndex:0,children:e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 bg-blue-500 text-white rounded-lg min-h-[50vh]",children:o})})},b=({game:o})=>{const{t,players:s,currentPlayerTurn:i,setGameState:m}=o;if(_.useEffect(()=>{i>=s.length&&m("question_intro")},[i,s.length,m]),i>=s.length)return null;const a=s[i];return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:a.name}),e.jsx("p",{className:"text-xl",children:t.givePhoneToPlayer?.replace("{player}",a.name)??`Give the phone to ${a.name}`}),e.jsx("p",{className:"text-xl mt-2",children:t.pressNextToSeeRole??"Press next to see if you are in or out of the story. Don't let anyone else see the screen!"}),e.jsx(v,{onClick:()=>m("role_reveal_player"),className:"mt-8 w-full",children:t.next??"Next"})]})},te=({game:o})=>{const{t,players:s,currentRound:i,currentPlayerTurn:m,nextTurn:a,setGameState:y}=o,h=s[m],l=h.id===i?.outsiderId,c=()=>{a(),y("role_reveal_handoff")},g=i?.category??"",E=t[g]??g;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:h.name}),l?e.jsx("p",{className:"text-xl",children:t.youAreTheOutsider?.replace("{category}",E)??"You are the Outsider! Try to figure out the story."}):e.jsx("p",{className:"text-xl",children:t.youAreAnInsider?.replace("{secret}",i?.secret??"")??`You are an Insider! The story is **${i?.secret}**. Your goal is to find out who among you is the Outsider.`}),e.jsx(v,{onClick:c,className:"mt-8 w-full",children:t.next??"Next"})]})},se=({game:o})=>{const{t,setupQuestionTurns:s}=o;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.questionTime??"Question Time"}),e.jsx("p",{className:"text-xl",children:t.questionIntroInstruction??"Each person will ask another person a question related to the topic. Press next to see who asks who."}),e.jsx(v,{onClick:s,className:"mt-8 w-full",children:t.next??"Next"})]})},re=({game:o})=>{const{t,currentPlayerTurn:s,setGameState:i,nextTurn:m,questionPairs:a}=o;if(!a||a.length===0||s>=a.length)return e.jsx("p",{children:t.loading??"Loading..."});const y=a[s],{asker:h,askee:l}=y,c=()=>{s>=a.length-1?i("voting"):m()};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.questionTime??"Question Time"}),e.jsx("p",{className:"text-xl",children:t.askerToAskeeInstruction?.replace("{asker}",h.name).replace("{askee}",l.name)??`${h.name}, ask ${l.name} a question about the topic! Choose your question carefully so the Outsider doesn't figure it out.`}),e.jsx(v,{onClick:c,className:"mt-8 w-full",children:t.next??"Next"})]})},oe=({game:o})=>{const{t,players:s,submitVote:i,finishVoting:m,votingPlayerIndex:a,nextVoter:y}=o,[h,l]=_.useState(!1),c=s[a];if(!c)return m(),e.jsx("p",{children:t.loading??"Loading..."});const g=s.filter(u=>u.id!==c.id),E=u=>{i(c.id,u),l(!0)},n=()=>{y(),l(!1)};if(h){const u=s[a+1],P=u?t.passDeviceAndVote?.replace("{player}",u.name)??`Pass the device to ${u.name} to vote.`:t.submitVote??"Submit Vote";return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:P}),e.jsx(v,{onClick:n,className:"mt-8 w-full",children:t.next??"Next"})]})}return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.yourTurnToVote?.replace("{player}",c.name)??`${c.name}, it's your turn to vote.`}),e.jsx("div",{className:"flex flex-col gap-3 w-full",children:g.map(u=>e.jsx(v,{onClick:()=>E(u.id),variant:"secondary",className:"h-16 text-xl",children:u.name},u.id))})]})},ne=({game:o})=>{const{t,currentRound:s,handleOutsiderGuess:i,players:m,setGameState:a}=o,[y,h]=_.useState(null),[l,c]=_.useState(null),g=m.find(n=>n.id===s?.outsiderId);if(!s||!g)return a("results"),null;const E=n=>{if(y)return;h(n);const u=n===s.secret;c(u?"correct":"incorrect"),setTimeout(()=>{i(n)},1500)};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.outsiderGuessTitle?.replace("{player}",g.name)??`${g.name}, what's the story?`}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.words.map(n=>{const u=y===n,P=l==="correct",w=l==="incorrect";return e.jsx(v,{onClick:()=>E(n),disabled:!!y,className:z("w-full h-16 text-lg transition-all duration-300",u&&P&&"bg-green-500 hover:bg-green-600 ring-4 ring-white",u&&w&&"bg-red-500 hover:bg-red-600 ring-4 ring-white",!u&&y&&"opacity-50"),children:n},n)})})]})},ae=({game:o})=>{const{t,currentRound:s,players:i,setGameState:m}=o;if(!s||!s.roundResult)return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:t.loadingResults??"Loading results..."}),e.jsx(v,{onClick:()=>m("round_end"),className:"mt-4",children:t.continue??"Continue"})]});const{votedPlayerId:a,outsiderGuessedCorrectly:y}=s.roundResult,h=i.find(c=>c.id===s.outsiderId);let l="";return a===s.outsiderId?y?l=t.outsiderCaughtButGuessed?.replace("{secret}",s.secret)??`You were caught! But you guessed the story (${s.secret}), well done!`:l=t.insidersWin?.replace("{secret}",s.secret)??`The Insiders win! The story was (${s.secret}).`:l=t.outsiderWins?.replace("{player}",h?.name??"")??`${h?.name} fooled you all! They were the Outsider.`,e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-4xl font-bold mb-6",children:t.results??"Results"}),e.jsx("div",{className:"space-y-2 my-4 w-full text-2xl",children:i.map(c=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:c.name}),e.jsx("span",{children:c.score})]},c.id))}),e.jsx("p",{className:"text-xl my-6",children:l}),e.jsx(v,{onClick:()=>m("round_end"),className:"mt-8 w-full",children:t.next??"Next"})]})},ie=({game:o})=>{const{t,playAgain:s,changePlayersAndReset:i}=o,m=J(),a=()=>{i(),m("/settings/teams/outside-the-story")};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.roundEndTitle??"End of Round!"}),e.jsx("p",{className:"text-xl mb-8",children:t.roundEndInstruction??"You can continue playing, change players, or go back to the category selection screen."}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(v,{onClick:s,className:"w-full",children:t.continuePlay??"Continue Playing"}),e.jsx(v,{onClick:a,variant:"secondary",className:"w-full",children:t.changePlayers??"Change Players"})]})]})},de=()=>{const{t:o}=L(),t=ee();if(t.loadingLevels||!t.currentRound)return e.jsx(A,{onBack:()=>window.history.back(),children:e.jsx("div",{className:"w-full h-full flex items-center justify-center p-4 min-h-[50vh]",children:e.jsx("p",{className:"text-xl",children:o.loading??"Loading..."})})});const s=()=>{switch(t.gameState){case"role_reveal_handoff":return e.jsx(b,{game:t});case"role_reveal_player":return e.jsx(te,{game:t});case"question_intro":return e.jsx(se,{game:t});case"question_turn":return e.jsx(re,{game:t});case"voting":return e.jsx(oe,{game:t});case"outsider_guess":return e.jsx(ne,{game:t});case"results":return e.jsx(ae,{game:t});case"round_end":return e.jsx(ie,{game:t});default:return e.jsx(b,{game:t})}};return e.jsx(A,{onBack:()=>window.history.back(),children:s()})};export{de as default};
