import{_ as p,b as B,c as H,r as d,j as e,i as I,k as E,l as O,m as L,f as z,B as k}from"./index-DSv16vA1.js";import{u as K,G as Y}from"./useInstructions-CdIQNVTe.js";class q{async loadLevels(_){const{language:m,categories:N}=_,g=Object.assign({"/src/data/ar/outside-the-story/ar-outside-the-story-animals.json":()=>p(()=>import("./ar-outside-the-story-animals-0m0m6kXG.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-fruits.json":()=>p(()=>import("./ar-outside-the-story-fruits-zTkTe7Gg.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-geography.json":()=>p(()=>import("./ar-outside-the-story-geography-CVgh5HaL.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-science.json":()=>p(()=>import("./ar-outside-the-story-science-D4AkFF1_.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-animals.json":()=>p(()=>import("./en-outside-the-story-animals-QFa7I_eA.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-fruits.json":()=>p(()=>import("./en-outside-the-story-fruits--LJxQFSa.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-geography.json":()=>p(()=>import("./en-outside-the-story-geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-science.json":()=>p(()=>import("./en-outside-the-story-science-DF1sazzy.js"),[])}),c=[];for(const l of N){const j=`/src/data/${m}/outside-the-story/${m}-outside-the-story-${l}.json`,R=g[j];if(!R){const i=Object.keys(g).find(x=>x.includes(`/${m}/outside-the-story/`)&&x.includes(`outside-the-story-${l}`));if(!i)continue;const h=await g[i](),n=Array.isArray(h.default?.words)?h.default.words.map(String):[];c.push({id:h.default?.id??`${m}-${l}`,language:m,category:l,words:n,meta:h.default?.meta??{}});continue}try{const i=await R(),h=Array.isArray(i.default?.words)?i.default.words.map(String):[];c.push({id:i.default?.id??`${m}-${l}`,language:m,category:l,words:h,meta:i.default?.meta??{}})}catch(i){console.error(`OutsideStoryGameEngine: Failed to load ${j}`,i)}}return c}}const J=new q;function Q(t){const _=B(),{language:m}=_,{t:N}=H(),g=d.useMemo(()=>{const r=_.teams;return r&&r.length>0?r.map((a,s)=>({id:s,name:a.name??`Team ${s+1}`})):["Alice","Bob","Carol"].map((a,s)=>({id:s,name:a}))},[_.teams,t]),[c,l]=d.useState(g.map(r=>({...r,score:0}))),[j,R]=d.useState([]),[i,h]=d.useState(!1),[n,x]=d.useState(null),[C,b]=d.useState([]),[w,A]=d.useState(["animals"]);d.useEffect(()=>{let r=!0;return h(!0),(async()=>{try{const a=await J.loadLevels({language:m??"en",categories:w});if(!r)return;R(a)}finally{r&&h(!1)}})(),()=>{r=!1}},[m,w]);const P=d.useCallback(r=>{l(a=>r.map((s,o)=>({id:o,name:s,score:a[o]?.score??0})))},[]),V=d.useCallback(r=>{l(a=>[...a,{id:a.length,name:r,score:0}])},[]),D=d.useCallback(r=>{l(a=>a.filter(s=>s.id!==r).map((s,o)=>({...s,id:o})))},[]),$=d.useCallback(r=>{const a=j.find(v=>v.category===r);if(!a||a.words.length===0)throw new Error(N.noLevelsFound||"No words found for category");if(c.length<3)throw new Error("Need at least 3 players to start Outside the Story");const s=a.words[Math.floor(Math.random()*a.words.length)],o=Math.floor(Math.random()*c.length),S=c.map(v=>v.id).filter(v=>v!==o),f={id:`${Date.now()}-${Math.random().toString(36).slice(2,9)}`,category:r,secret:s,outsiderId:o,insiders:S,votes:{},revealed:!1};return x(f),f},[j,c,N.noLevelsFound]),M=d.useCallback(r=>!n||r===n.outsiderId?null:n.secret,[n]),T=d.useCallback((r,a)=>{x(s=>s&&{...s,votes:{...s.votes,[r]:a}})},[]),F=d.useCallback(()=>{if(!n)return null;const r=n.votes,a=new Map;for(const u in r){const y=r[Number(u)];a.set(y,(a.get(y)||0)+1)}let s=-1,o;for(const[u,y]of a.entries())(y>s||y===s&&(o===void 0||u<o))&&(s=y,o=u);const S=o===n.outsiderId,f={};c.forEach(u=>f[u.id]=0),S?(n.insiders.forEach(u=>f[u]+=1),f[n.outsiderId]+=0):f[n.outsiderId]+=2,l(u=>u.map(y=>({...y,score:y.score+(f[y.id]||0)})));const v={...n,votes:{...n.votes},revealed:!0,roundResult:{outsiderIdentified:S,votedPlayerId:o,pointsAwarded:f}};return b(u=>[v,...u]),x(v),v},[n,c]),G=d.useCallback(()=>{l(r=>r.map(a=>({...a,score:0}))),x(null),b([])},[]);return{players:c,setPlayerNames:P,addPlayer:V,removePlayer:D,levels:j,loadingLevels:i,availableCategories:w,setAvailableCategories:A,currentRound:n,history:C,startRound:$,revealSecretToPlayer:M,submitVote:T,finishVotingAndReveal:F,resetGame:G}}const X=()=>{const{t,i18n:_}=H(),N=B().language,g=K("outsideStory"),c=g?{title:g.title??"",description:g.description??"",steps:g.steps??[]}:void 0,{players:l,startRound:j,revealSecretToPlayer:R,currentRound:i,submitVote:h,finishVotingAndReveal:n,history:x,availableCategories:C,levels:b,loadingLevels:w}=Q(),A=(C&&C[0])??"animals",[P,V]=d.useState(A),[D,$]=d.useState(null),[M,T]=d.useState({}),F=()=>{try{j(P),$(null),T({})}catch(s){alert(String(s))}},G=s=>{const o=R(s);$(s),alert(o?`${t.secretIs??"Secret is:"} ${o}`:t.youAreOutside??"You are Outside the Story (you do NOT know the secret).")},r=(s,o)=>{h(s,o),T(S=>({...S,[s]:o}))},a=()=>{const s=n();if(s){const o=s.roundResult?.outsiderIdentified?t.outsiderIdentified??"Outsider identified!":t.outsiderNotIdentified??"Outsider was NOT identified";alert(o)}};return e.jsx(Y,{title:t.outsideTheStoryTitle??"Outside the Story",levelIndex:0,onBack:()=>window.history.back(),layoutType:"text",instructions:c,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(O,{children:t.selectCategory??"Select Category"})}),e.jsxs(L,{children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("select",{value:P,onChange:s=>V(s.target.value),className:z("px-3 py-2 border rounded-md",_.dir()==="rtl"?"text-right":"text-left"),children:C.map(s=>e.jsx("option",{value:s,children:t[s]??s},s))}),e.jsx(k,{onClick:F,disabled:w,children:t.startRound??"Start Round"}),e.jsx("div",{className:"text-sm text-muted-foreground ml-auto",children:t.languages?`${t.languages}: ${N}`:`Lang: ${N}`})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:b.length>0?`${b.length} ${t.available??""}`:t.loading??""})]})]}),e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(O,{children:t.roundStatus??"Round Status"})}),e.jsx(L,{children:i?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("strong",{children:[t.category??"Category",":"]})," ",t[i.category]??i.category]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("strong",{children:[t.insiders??"Insiders",":"]})," ",i.insiders.length]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("strong",{children:[t.outsider??"Outsider (id)",":"]})," ",i.outsiderId]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:i.revealed?t.roundCompleted??"Round completed":t.roundInProgress??"Round in progress"})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:t.noRounds??"No active round"})})]}),e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(O,{children:t.players??"Players"})}),e.jsx(L,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:l.map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-3 p-2 border rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.points??"Points",": ",s.score]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{size:"sm",onClick:()=>G(s.id),children:t.revealToPlayer??"Reveal"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:D===s.id?t.lastRevealed??"Last revealed":""})]})]},s.id))})})]}),e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(O,{children:t.voting??"Voting"})}),e.jsxs(L,{children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:t.votingInstruction??"Each player votes who they think is the Outsider."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:l.map(s=>e.jsxs("div",{className:"p-2 border rounded",children:[e.jsx("div",{className:"font-medium mb-1",children:s.name}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:l.filter(o=>o.id!==s.id).map(o=>e.jsxs(k,{size:"sm",variant:M[s.id]===o.id?"default":"outline",onClick:()=>r(s.id,o.id),children:[t.voteFor??"Vote for"," ",o.name]},o.id))})]},s.id))}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx(k,{onClick:a,children:t.revealResults??"Reveal Results"})})]})]}),e.jsxs(I,{children:[e.jsx(E,{children:e.jsx(O,{children:t.history??"Rounds History"})}),e.jsx(L,{children:x.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:t.noRounds??"No rounds yet"}):e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsx("div",{className:"p-2 border rounded",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold",children:[t.category??"Category",": ",t[s.category]??s.category]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Secret: ",s.secret]})]}),e.jsx("div",{className:"text-sm",children:s.roundResult?.outsiderIdentified?t.outsiderIdentified??"Outsider identified":t.outsiderNotIdentified??"Outsider not identified"})]})},s.id))})})]})]})})};export{X as default};
