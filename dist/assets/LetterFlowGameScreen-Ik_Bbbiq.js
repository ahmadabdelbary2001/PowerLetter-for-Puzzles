import{_ as o,u as De,a as be,b as xe,c as ge,r as L,j as h,f as se,B as Ve}from"./index-B4fPtU2R.js";import{a as Ce,N as $e,u as Me}from"./Notification-7_OZ9wn8.js";import{B as ke,s as Ne,G as Se}from"./GameLayout-D84wNv_h.js";import{G as Fe}from"./GameControls-B4hR6-Xg.js";import"./GameButton-p4dt7Yua.js";import"./circle-check-big-BJBHKpeN.js";function Ue(r,i,l=70,s=50){if(i<=0)return`hsl(0, ${l}%, ${s}%)`;const m=Math.round(r*360/i)%360,x=s>50?s*.9:s*1.1;return`hsl(${m}, ${l}%, ${x}%)`}class Ge extends ke{async loadLevels(i){const{language:l,difficulty:s}=i;if(!s)return[];try{const m=this.getModulePath(l,"",s),E=Object.assign({"/src/data/ar/formation/easy.json":()=>o(()=>import("./easy-CuHzQLY1.js"),[]),"/src/data/ar/formation/hard.json":()=>o(()=>import("./hard-DzMXngiv.js"),[]),"/src/data/ar/img-choice/animals/data.json":()=>o(()=>import("./data-6hZ_2-dK.js"),[]),"/src/data/ar/img-clue/animals/data.json":()=>o(()=>import("./data-USJTiWy0.js"),[]),"/src/data/ar/img-clue/fruits-and-vegetables/data.json":()=>o(()=>import("./data-DlhJ3pZw.js"),[]),"/src/data/ar/img-clue/shapes/data.json":()=>o(()=>import("./data-B126H-NP.js"),[]),"/src/data/ar/letter-flow/easy.json":()=>o(()=>import("./easy-C68xgLTr.js"),[]),"/src/data/ar/letter-flow/medium.json":()=>o(()=>import("./medium-DnN41iEv.js"),[]),"/src/data/ar/outside-the-story/animals.json":()=>o(()=>import("./animals-BD_uC3F6.js"),[]),"/src/data/ar/outside-the-story/anime.json":()=>o(()=>import("./anime-X9XTb-jh.js"),[]),"/src/data/ar/outside-the-story/cars.json":()=>o(()=>import("./cars-LFoQ5kcr.js"),[]),"/src/data/ar/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-9ln4fVtF.js"),[]),"/src/data/ar/outside-the-story/characters.json":()=>o(()=>import("./characters-BClrgWDD.js"),[]),"/src/data/ar/outside-the-story/clothes.json":()=>o(()=>import("./clothes-DZukcyjc.js"),[]),"/src/data/ar/outside-the-story/drinks.json":()=>o(()=>import("./drinks-DWTisQdZ.js"),[]),"/src/data/ar/outside-the-story/foods.json":()=>o(()=>import("./foods-BPEl4jwc.js"),[]),"/src/data/ar/outside-the-story/football.json":()=>o(()=>import("./football-BkDTW0je.js"),[]),"/src/data/ar/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-CWZ59ral.js"),[]),"/src/data/ar/outside-the-story/gamers.json":()=>o(()=>import("./gamers-DU27ka0Y.js"),[]),"/src/data/ar/outside-the-story/geography.json":()=>o(()=>import("./geography-Bmt1Mp9F.js"),[]),"/src/data/ar/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-CvncURYW.js"),[]),"/src/data/ar/outside-the-story/science.json":()=>o(()=>import("./science-C1rxd0mO.js"),[]),"/src/data/ar/outside-the-story/series.json":()=>o(()=>import("./series-DgCSJJru.js"),[]),"/src/data/ar/outside-the-story/spy.json":()=>o(()=>import("./spy-CTUdze8o.js"),[]),"/src/data/ar/outside-the-story/sweets.json":()=>o(()=>import("./sweets-0_2hbNMS.js"),[]),"/src/data/ar/phrase-clue/animals/easy.json":()=>o(()=>import("./easy-B_GJKLA_.js"),[]),"/src/data/ar/phrase-clue/animals/hard.json":()=>o(()=>import("./hard-7EfMbXs4.js"),[]),"/src/data/ar/phrase-clue/animals/medium.json":()=>o(()=>import("./medium-Bcn1oCUk.js"),[]),"/src/data/ar/phrase-clue/geography/easy.json":()=>o(()=>import("./easy-B_kcdeCx.js"),[]),"/src/data/ar/phrase-clue/geography/hard.json":()=>o(()=>import("./hard-BCuCMNGp.js"),[]),"/src/data/ar/phrase-clue/geography/medium.json":()=>o(()=>import("./medium-CkoNY3Du.js"),[]),"/src/data/ar/phrase-clue/science/easy.json":()=>o(()=>import("./easy-f07zg_lU.js"),[]),"/src/data/ar/phrase-clue/science/hard.json":()=>o(()=>import("./hard-CV32qLEY.js"),[]),"/src/data/ar/phrase-clue/science/medium.json":()=>o(()=>import("./medium-BtIrOjNp.js"),[]),"/src/data/ar/word-choice/animals/data.json":()=>o(()=>import("./data-Bij5nysW.js"),[]),"/src/data/en/formation/easy.json":()=>o(()=>import("./easy-CqPS8TrH.js"),[]),"/src/data/en/img-choice/animals/data.json":()=>o(()=>import("./data-CtXqoHRL.js"),[]),"/src/data/en/img-clue/animals/data.json":()=>o(()=>import("./data-BYo_61tt.js"),[]),"/src/data/en/img-clue/fruits-and-vegetables/data.json":()=>o(()=>import("./data-B6FoT8eG.js"),[]),"/src/data/en/img-clue/shapes/data.json":()=>o(()=>import("./data-Bu1Ld6Qx.js"),[]),"/src/data/en/letter-flow/easy.json":()=>o(()=>import("./easy-DqbTaQjR.js"),[]),"/src/data/en/outside-the-story/animals.json":()=>o(()=>import("./animals-D78oH89-.js"),[]),"/src/data/en/outside-the-story/anime.json":()=>o(()=>import("./anime-DXIlEidq.js"),[]),"/src/data/en/outside-the-story/cars.json":()=>o(()=>import("./cars-Cw03Nxyo.js"),[]),"/src/data/en/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-DwVIQVvA.js"),[]),"/src/data/en/outside-the-story/characters.json":()=>o(()=>import("./characters-Dl2vwTPn.js"),[]),"/src/data/en/outside-the-story/clothes.json":()=>o(()=>import("./clothes-BiLKpCWj.js"),[]),"/src/data/en/outside-the-story/drinks.json":()=>o(()=>import("./drinks-CP1Emjyy.js"),[]),"/src/data/en/outside-the-story/foods.json":()=>o(()=>import("./foods-BKBSmJG2.js"),[]),"/src/data/en/outside-the-story/football.json":()=>o(()=>import("./football-B8eU_HgW.js"),[]),"/src/data/en/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-B5narx4J.js"),[]),"/src/data/en/outside-the-story/gamers.json":()=>o(()=>import("./gamers-Dm5Tu0YA.js"),[]),"/src/data/en/outside-the-story/geography.json":()=>o(()=>import("./geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-BnHY6_tE.js"),[]),"/src/data/en/outside-the-story/science.json":()=>o(()=>import("./science-DF1sazzy.js"),[]),"/src/data/en/outside-the-story/series.json":()=>o(()=>import("./series-dqakDLa9.js"),[]),"/src/data/en/outside-the-story/spy.json":()=>o(()=>import("./spy-DLpfZG_H.js"),[]),"/src/data/en/outside-the-story/sweets.json":()=>o(()=>import("./sweets-DDZ5JqsI.js"),[]),"/src/data/en/phrase-clue/animals/easy.json":()=>o(()=>import("./easy-vc2CgBiI.js"),[]),"/src/data/en/phrase-clue/animals/hard.json":()=>o(()=>import("./hard-BmQiyFGH.js"),[]),"/src/data/en/phrase-clue/animals/medium.json":()=>o(()=>import("./medium-CDppU-oU.js"),[]),"/src/data/en/phrase-clue/geography/easy.json":()=>o(()=>import("./easy-v49lXgS1.js"),[]),"/src/data/en/phrase-clue/geography/hard.json":()=>o(()=>import("./hard-Hc9ZYG1D.js"),[]),"/src/data/en/phrase-clue/geography/medium.json":()=>o(()=>import("./medium-Yt4_5ZKV.js"),[]),"/src/data/en/phrase-clue/science/easy.json":()=>o(()=>import("./easy-CXDUIzZm.js"),[]),"/src/data/en/phrase-clue/science/hard.json":()=>o(()=>import("./hard-BPi6SzUA.js"),[]),"/src/data/en/phrase-clue/science/medium.json":()=>o(()=>import("./medium-Dm_81XWt.js"),[]),"/src/data/en/word-choice/animals/data.json":()=>o(()=>import("./data-BDxquZu-.js"),[])})[m];return E?((await E()).default?.levels||[]).map(y=>this.validateLevel(y,s)).filter(y=>y!==null):[]}catch(m){return console.error(`LetterFlowGameEngine: Failed to load levels for ${l}/${s}.`,m),[this.getErrorLevel()]}}getGameId(){return"letter-flow"}getModulePath(i,l,s){return`/src/data/${i}/letter-flow/${s}.json`}validateLevel(i,l){const s=i;if(s&&typeof s=="object"&&"id"in s&&"solutionWord"in s&&"gridSize"in s&&"endpoints"in s){const{width:m,height:x}=s.gridSize,E=Array.from({length:m*x},(d,P)=>({x:P%m,y:Math.floor(P/m),letter:"",isUsed:!1})),R=s.endpoints,w=Array.from(new Set(R.map(d=>d.letter))),y=new Map;w.forEach((d,P)=>{y.set(d,Ue(P,w.length,72,48))}),R.forEach(d=>{const P=d.y*m+d.x;P<E.length&&(E[P]={...d,isUsed:!1,color:y.get(d.letter)})});const b=s;return{id:String(b.id),difficulty:l??"easy",words:[b.solutionWord],board:E,solution:b.solutionWord,endpoints:b.endpoints.map(d=>({...d,color:y.get(d.letter)}))}}return null}getErrorLevel(){return{id:"error",difficulty:"easy",words:[],board:[],solution:"",endpoints:[]}}generateBoard(i,l,s,m){if(!m)return[];const x=Ne(m.split("")),E=Math.ceil(Math.sqrt(x.length)),R=[];for(let w=0;w<E;w++)for(let y=0;y<E;y++){const b=w*E+y;b<x.length&&R.push({x:y,y:w,letter:x[b],isUsed:!1})}return R}}const he=new Ge,ce=24;function Be(r,i=ce,l=68,s=48){return`hsl(${Math.round(r*360/i)%360}, ${l}%, ${s}%)`}function Ee(r){if(!r)return;let i=0;const l=r.toUpperCase();for(let m=0;m<l.length;m++)i=(i<<5)-i+l.charCodeAt(m),i|=0;const s=Math.abs(i)%ce;return Be(s,ce)}function ze(){const r=De(),i=be(),{language:l,categories:s,difficulty:m,gameMode:x,teams:E,currentTeam:R,consumeHint:w}=xe(),{t:y}=ge(),{loading:b,currentLevel:d,currentLevelIndex:P,nextLevel:N}=Ce(he,{language:l,categories:s,difficulty:m}),[C,V]=L.useState([]),[v,D]=L.useState([]),[e,a]=L.useState([]),[I,f]=L.useState(null),[g,c]=L.useState(null),[J,G]=L.useState("playing");L.useEffect(()=>{if(d){if(d.board&&d.board.length>0&&d.board.some(t=>t.letter))V(d.board.map(t=>({...t})));else{const t=he.generateBoard("",d.difficulty,l,d.board.map(n=>n.letter).join(""));V(t)}a([]),D([]),c(null),G("playing")}},[d,l]);const K=L.useMemo(()=>[...new Set(d?.endpoints.map(t=>t.letter)||[])],[d]),S=L.useMemo(()=>{const t=new Map;return d?.endpoints.forEach(n=>t.set(`${n.x}-${n.y}`,n.color)),t},[d]),ee=L.useCallback(t=>{if(t)return Ee(t)},[]),q=L.useCallback(t=>d?d.endpoints.some(n=>n.x===t.x&&n.y===t.y&&n.letter===t.letter):!1,[d]),ue=L.useCallback((t,n)=>{const u=Math.abs(t.x-n.x),j=Math.abs(t.y-n.y);return u===1&&j===0||u===0&&j===1},[]),_e=L.useCallback(t=>{if(t.length<2)return!0;for(let n=1;n<t.length;n++)if(!ue(t[n-1],t[n]))return!1;return!0},[ue]),me=L.useCallback((t,n,u)=>{if(!t.letter){if(t.isUsed){if(u){const j=e.find($=>$.word===u);if(j&&j.cells.some($=>$.x===t.x&&$.y===t.y))return!1}return!0}return!1}return!(n&&t.x===n.x&&t.y===n.y||u&&t.letter===u&&q(t))},[e,q]),te=L.useCallback(t=>e.length===0?[]:e.filter(n=>n.cells.some(u=>t.some(j=>j.x===u.x&&j.y===u.y))),[e]),O=L.useCallback((t,n="info",u=1200)=>{f({message:t,type:n}),u>0&&setTimeout(()=>f(null),u)},[]),ve=L.useCallback(t=>{if(!q(t))return;const n=e.find(u=>u.word===t.letter);n&&(a(u=>u.filter(j=>j.word!==t.letter)),V(u=>u.map(j=>{const $=n.cells.some(M=>M.x===j.x&&M.y===j.y),F=S.get(`${j.x}-${j.y}`);return $?{...j,isUsed:!1,color:F??void 0}:j})),O(`Removed connection for ${t.letter}`,"info",900)),c(t.letter),D([t])},[e,q,O,S]),je=L.useCallback(t=>{if(!g||v.length===0)return;const n=v[0]||null;if(me(t,n,g)||!(t.letter===g||t.letter===""))return;const u=v[v.length-1];if(u&&u.x===t.x&&u.y===t.y)return;const j=Math.abs(t.x-u.x),$=Math.abs(t.y-u.y);if(j===1&&$===1||j>1||$>1)return;const F=v.findIndex(z=>z.x===t.x&&z.y===t.y);if(F!==-1){D(z=>z.slice(0,F+1));return}if(t.isUsed)return;const M=[...v,t];if(!_e(M))return;if(q(t)&&!(v.length>0&&v[0].x===t.x&&v[0].y===t.y)&&t.letter===g){const z=te(M);z.length>0&&(a(T=>T.filter(A=>!z.includes(A))),V(T=>T.map(A=>{const W=z.some(X=>X.cells.some(Y=>Y.x===A.x&&Y.y===A.y)),Z=S.get(`${A.x}-${A.y}`);return W?{...A,isUsed:!1,color:Z??void 0}:A})),O("Existing connection(s) removed by new connection","warning",1100));const oe=C.find(T=>T.x===M[0].x&&T.y===M[0].y)?.color||ee(M[0].letter);V(T=>T.map(A=>{const W=M.some(X=>X.x===A.x&&X.y===A.y),Z=S.get(`${A.x}-${A.y}`);return W?{...A,isUsed:!0,color:Z??oe}:A}));const ae={word:g,cells:M.map(T=>({...T,color:oe})),startIndex:0};a(T=>[...T.filter(A=>A.word!==g),ae]),O(`Connected ${g}`,"success",900),c(null),D([]);const ie=[...e.map(T=>T.word),g].filter(Boolean),Q=Array.from(new Set(ie));K.every(T=>Q.includes(T))&&(O(y.congrats,"success",2e3),x==="competitive"?setTimeout(()=>N(),2e3):G("won"))}else D(M)},[g,v,me,q,_e,te,C,ee,e,K,N,y,O,S,x,G]),Le=L.useCallback(()=>{if(v.length>0){const t=v[v.length-1];q(t)&&!(v.length>1&&v[0].x===t.x&&v[0].y===t.y)&&t.letter===g||(c(null),D([]),O("Path must connect two endpoints!","error",1200))}},[v,q,g,O]),we=L.useCallback(()=>{if(!d||e.length>=d.endpoints.length/2)return;if(x==="competitive"&&!w(E[R].id)){O(y.noHintsLeft,"error",2e3);return}const t=K.filter(_=>!e.some(p=>p.word===_));if(t.length===0)return;const n=t[0],u=d.endpoints.filter(_=>_.letter===n);if(u.length<2){O(`No endpoints found for ${n}`,"error",1500);return}const j=u[0],$=u[1],F=new Map;C.forEach(_=>F.set(`${_.x}-${_.y}`,_));const M=C.map(_=>_.x),ne=C.map(_=>_.y),z=Math.min(...M),oe=Math.max(...M),ae=Math.min(...ne),ie=Math.max(...ne),Q=`${j.x}-${j.y}`,de=`${$.x}-${$.y}`,T=[Q],A=new Set([Q]),W=new Map([[Q,null]]),Z=(_,p)=>{const k=F.get(`${_}-${p}`);return k?!k.letter||k.letter===n:!1},X=_=>{const[p,k]=_.split("-").map(U=>parseInt(U,10));return[[p+1,k],[p-1,k],[p,k+1],[p,k-1]].filter(([U,B])=>U>=z&&U<=oe&&B>=ae&&B<=ie).map(([U,B])=>`${U}-${B}`)};let Y=!1;for(;T.length>0&&!Y;){const _=T.shift();if(_===de){Y=!0;break}for(const p of X(_)){if(A.has(p))continue;const[k,U]=p.split("-").map(B=>parseInt(B,10));Z(k,U)&&(A.add(p),W.set(p,_),T.push(p))}}if(!Y){O(`No path found for ${n}`,"error",1600);return}const H=[];let re=de;for(;re;){const _=F.get(re);_&&H.push({..._}),re=W.get(re)??null}H.reverse();const le=te(H);le.length>0&&(a(_=>_.filter(p=>!le.includes(p))),V(_=>_.map(p=>{const k=le.some(B=>B.cells.some(pe=>pe.x===p.x&&pe.y===p.y)),U=S.get(`${p.x}-${p.y}`);return k?{...p,isUsed:!1,color:U??void 0}:p})),O("Existing connection(s) removed by hint connection","warning",1100));const fe=F.get(`${H[0].x}-${H[0].y}`)?.color||ee(H[0].letter);V(_=>_.map(p=>{const k=H.some(B=>B.x===p.x&&B.y===p.y),U=S.get(`${p.x}-${p.y}`);return k?{...p,isUsed:!0,color:U??fe}:p}));const Ae={word:n,cells:H.map(_=>({..._,color:fe})),startIndex:0};a(_=>[..._.filter(p=>p.word!==n),Ae]),O(`Hint: Connected ${n}`,"info",900),c(null),D([]);const Re=[...e.map(_=>_.word),n].filter(Boolean),Oe=Array.from(new Set(Re));K.every(_=>Oe.includes(_))&&(O(y.congrats,"success",2e3),x==="competitive"?setTimeout(()=>N(),2e3):G("won"))},[d,C,e,K,S,ee,te,O,x,E,R,w,y,N,G]),Ie=L.useCallback(()=>{if(e.length===0)return;const t=e[e.length-1];a(n=>n.slice(0,-1)),V(n=>n.map(u=>{if(!t.cells.some(F=>F.x===u.x&&F.y===u.y))return u;const $=S.get(`${u.x}-${u.y}`);return{...u,isUsed:!1,color:$??void 0}})),D([]),c(null),O(`Undo: Removed connection for ${t.word}`,"info"),J==="won"&&G("playing")},[e,O,S,J,G]),Pe=L.useCallback(()=>{a([]),V(t=>t.map(n=>{const u=S.get(`${n.x}-${n.y}`);return{...n,isUsed:!1,color:u}})),D([]),c(null),G("playing"),O("Game reset - all connections removed","info")},[O,S,G]),Te=L.useCallback(()=>{r(x==="competitive"?`/team-config/${i.gameType}`:`/game-mode/${i.gameType}`)},[r,i.gameType,x]);return{loading:b,currentLevel:d,currentLevelIndex:P,board:C,selectedPath:v,foundWords:e,notification:I,gameState:J,activeLetter:g,handleBack:Te,handleMouseDown:ve,handleMouseEnter:je,handleMouseUp:Le,clearSelection:()=>{D([]),c(null)},onHint:we,onUndo:Ie,onReset:Pe,nextLevel:N}}function qe({letter:r,x:i,y:l,isSelected:s=!1,isFound:m=!1,isActive:x=!1,onMouseDown:E,onMouseEnter:R,onMouseUp:w,disabled:y=!1,className:b,connectionDirections:d=[],connectionColor:P,cellColor:N}){const C={x:i,y:l,letter:r},V=f=>{y||!E||(f.target.setPointerCapture(f.pointerId),E(C))},v=f=>{if(f.buttons!==1||y||!R)return;const c=document.elementFromPoint(f.clientX,f.clientY)?.closest("[data-cell-x]");if(c){const J=parseInt(c.dataset.cellX||"0",10),G=parseInt(c.dataset.cellY||"0",10),K=c.querySelector(".cell-letter");R({x:J,y:G,letter:K?.textContent?.trim()||""})}},D=f=>{y||!w||(f.target.releasePointerCapture(f.pointerId),w())},e=f=>{y||!E||(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),E(C))},a=56,I=P??N??void 0;return h.jsxs("div",{role:"button",tabIndex:y?-1:0,"aria-disabled":y,"aria-pressed":s||void 0,"data-cell-x":i,"data-cell-y":l,onPointerDown:V,onPointerMove:v,onPointerUp:D,onPointerCancel:D,onKeyDown:e,className:se("aspect-square flex items-center justify-center rounded-md text-xl font-bold select-none relative transition-all duration-150 touch-none",{"bg-gray-50 dark:bg-gray-800":!s&&!m&&!x,"cursor-pointer":!y,"cursor-not-allowed opacity-70":y,"text-gray-900 dark:text-gray-100":!s&&!m&&!x&&!I},b),children:[d.includes("top")&&h.jsx("div",{"aria-hidden":!0,className:"absolute top-0 left-1/2 transform -translate-x-1/2",style:{width:`${Math.max(6,a*.1)}%`,height:"50%",background:P,zIndex:0}}),d.includes("bottom")&&h.jsx("div",{"aria-hidden":!0,className:"absolute bottom-0 left-1/2 transform -translate-x-1/2",style:{width:`${Math.max(6,a*.1)}%`,height:"50%",background:P,zIndex:0}}),d.includes("left")&&h.jsx("div",{"aria-hidden":!0,className:"absolute left-0 top-1/2 transform -translate-y-1/2",style:{height:`${Math.max(6,a*.1)}%`,width:"50%",background:P,zIndex:0}}),d.includes("right")&&h.jsx("div",{"aria-hidden":!0,className:"absolute right-0 top-1/2 transform -translate-y-1/2",style:{height:`${Math.max(6,a*.1)}%`,width:"50%",background:P,zIndex:0}}),h.jsx("div",{className:"flex items-center justify-center rounded-full z-10 pointer-events-none",style:{width:`${a}%`,height:`${a}%`,background:I??"#ffffff",boxShadow:I?"0 2px 8px rgba(0,0,0,0.12)":void 0,border:I?"none":"1px solid rgba(0,0,0,0.06)"},children:r?h.jsx("span",{className:"text-sm font-bold cell-letter",style:{color:I?"#fff":"#111"},children:r}):null})]})}function ye(r){return Ee(r)}function He({cells:r,selectedPath:i,foundWords:l,activeLetter:s,onMouseDown:m,onMouseEnter:x,onMouseUp:E,className:R,dir:w="ltr"}){const y=r.length===0?0:Math.max(...r.map(e=>e.x))+1,b=w==="rtl",d=e=>`${e.x}-${e.y}`,P=new Map;i.forEach(e=>P.set(d(e),e));const N=new Map;l.forEach(e=>e.cells.forEach(a=>N.set(d(a),{word:e.word,cells:e.cells})));const C=e=>{const a=[],I=[...l.map(f=>f.cells),i];for(const f of I){const g=f.findIndex(c=>c.x===e.x&&c.y===e.y);if(g!==-1){if(g>0){const c=f[g-1];c.x===e.x-1&&c.y===e.y&&a.push("left"),c.x===e.x+1&&c.y===e.y&&a.push("right"),c.x===e.x&&c.y===e.y-1&&a.push("top"),c.x===e.x&&c.y===e.y+1&&a.push("bottom")}if(g<f.length-1){const c=f[g+1];c.x===e.x-1&&c.y===e.y&&a.push("left"),c.x===e.x+1&&c.y===e.y&&a.push("right"),c.x===e.x&&c.y===e.y-1&&a.push("top"),c.x===e.x&&c.y===e.y+1&&a.push("bottom")}}}return[...new Set(a)]},V=e=>{for(const a of l)if(a.cells.some(I=>I.x===e.x&&I.y===e.y)){const I=a.cells[0]?.color??a.cells.find(g=>g.color)?.color;if(I)return I;const f=r.find(g=>g.x===a.cells[0].x&&g.y===a.cells[0].y);return f?.color?f.color:ye(a.word)}if(i&&i.length>0&&i.some(a=>a.x===e.x&&a.y===e.y)){const a=i[0];if(a?.color)return a.color;const I=r.find(f=>f.x===a.x&&f.y===a.y);return I?.color?I.color:ye(a?.letter)}if(e.color)return e.color},v=e=>P.has(d(e)),D=e=>N.has(d(e));return h.jsx("div",{className:se("grid gap-1 mx-auto max-w-md",R,{"rtl-direction":b}),style:{gridTemplateColumns:`repeat(${y}, minmax(0, 1fr))`,direction:b?"rtl":"ltr",touchAction:"none"},children:r.map(e=>{const a=C(e),I=V(e),f=D(e)||e.letter!==""&&e.letter!==s&&e.isUsed;return h.jsx(qe,{letter:e.letter,x:e.x,y:e.y,isSelected:v(e),isFound:D(e),isActive:s&&e.letter===s?!0:void 0,onMouseDown:m,onMouseEnter:x,onMouseUp:E,disabled:f,connectionDirections:a,connectionColor:I,cellColor:e.color},`${e.x}-${e.y}`)})})}function Ke({foundWords:r,t:i,className:l}){return r.length===0?null:h.jsxs("div",{className:se("mt-6",l),children:[h.jsxs("div",{className:"text-lg font-semibold mb-2",children:[i.selected,":"]}),h.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((s,m)=>h.jsx("div",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-md",children:s.word},m))})]})}function We({foundWords:r,totalWords:i,t:l,className:s}){const m=r.length/i;return h.jsxs("div",{className:se("mt-6 text-center",s),children:[h.jsxs("div",{className:"text-gray-600",children:[l.selected," ",r.length," ",l.of," ",i]}),h.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:h.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-500",style:{width:`${m*100}%`}})})]})}function Xe(){L.useEffect(()=>{const r=EventTarget.prototype.addEventListener;return EventTarget.prototype.addEventListener=function(i,l,s){if((i==="touchmove"||i==="touchstart"||i==="touchend")&&typeof s=="object"&&s&&!("passive"in s)){const m={...s,passive:!1};return r.call(this,i,l,m)}return r.call(this,i,l,s)},()=>{EventTarget.prototype.addEventListener=r}},[])}const Ye=({notification:r,boardContent:i,foundWordsContent:l,progressContent:s,gameControlsContent:m,...x})=>{const E=r?.message??null,R=r?.type??"info";return h.jsxs(Se,{...x,children:[E&&h.jsx($e,{message:E,type:R}),h.jsxs("div",{className:"flex flex-col items-center gap-4",children:[h.jsx("div",{className:"w-full touch-none transition-colors duration-300",children:i}),l,h.jsx("div",{className:"w-full max-w-md",children:m}),s]})]})},st=()=>{const{t:r}=ge(),{gameMode:i}=xe(),l=Me("letterFlow"),s=l?{title:l.title??"",description:l.description??"",steps:l.steps??[]}:void 0;Xe();const{loading:m,currentLevel:x,board:E,selectedPath:R,foundWords:w,notification:y,gameState:b,activeLetter:d,handleBack:P,handleMouseDown:N,handleMouseEnter:C,handleMouseUp:V,onHint:v,onUndo:D,onReset:e,clearSelection:a,currentLevelIndex:I,nextLevel:f}=ze();if(m)return h.jsx("div",{className:"flex justify-center items-center h-screen",children:h.jsxs("p",{children:[r.loading,"..."]})});if(!x)return h.jsxs("div",{className:"flex flex-col items-center justify-center h-screen gap-4 p-4 text-center",children:[h.jsx("p",{className:"text-xl font-semibold",children:r.noLevelsFound}),h.jsx(Ve,{onClick:P,children:r.back})]});const g=Math.floor((x?.endpoints.length??0)/2);return h.jsx(Ye,{title:r.letterFlowTitle??x.id,levelIndex:I??0,onBack:P,difficulty:x.difficulty,instructions:s,notification:y,boardContent:h.jsx(He,{cells:E,selectedPath:R,foundWords:w,activeLetter:d,onMouseDown:c=>N({...c,isUsed:!1}),onMouseEnter:c=>C({...c,isUsed:!1}),onMouseUp:V}),foundWordsContent:w.length>0?h.jsx(Ke,{foundWords:w,t:{selected:r.selected}}):null,gameControlsContent:h.jsx(Fe,{onReset:e,onRemoveLetter:D,onClearAnswer:a,onHint:v,onNextLevel:f,canRemove:w.length>0,canClear:R.length>0,canCheck:!1,canNext:b==="won",canHint:w.length<g,gameState:b,gameMode:i,isKidsMode:!1,labels:{remove:r.undo,clear:r.clear,check:r.check,hint:r.hint,showSolution:r.showSolution,reset:r.reset,prev:r.prev,next:r.next},showOnly:["remove","hint","reset","next"]}),progressContent:h.jsx(We,{foundWords:w,totalWords:g,t:{selected:r.selected,of:r.of}})})};export{st as default};
