import{_ as o,u as be,a as De,b as Oe,c as xe,r as j,j as E,f as se}from"./index-q4Kcks6h.js";import{s as Ve,u as $e,a as Ce,N as Me}from"./useInstructions-Dfj8CYVP.js";import{G as ke}from"./GameControls-DtC86uxa.js";import{G as Se}from"./GameLayout-CijemBkG.js";import"./GameButton-waPsRqqP.js";import"./circle-check-big-DQ4bArJI.js";function Ne(r,a,c=70,d=50){if(a<=0)return`hsl(0, ${c}%, ${d}%)`;const x=Math.round(r*360/a)%360,I=d>50?d*.9:d*1.1;return`hsl(${x}, ${c}%, ${I}%)`}class Fe{async loadLevels(a){const{language:c,difficulty:d}=a;if(!d)return[];try{const x=`/src/data/${c}/letter-flow/${c}-flow-${d}.json`,A=Object.assign({"/src/data/ar/clue/animals/ar-clue-animals-easy.json":()=>o(()=>import("./ar-clue-animals-easy-B_GJKLA_.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-hard.json":()=>o(()=>import("./ar-clue-animals-hard-7EfMbXs4.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-medium.json":()=>o(()=>import("./ar-clue-animals-medium-Bcn1oCUk.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-words.json":()=>o(()=>import("./ar-clue-animals-words-DxH5pZeF.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-easy.json":()=>o(()=>import("./ar-clue-geography-easy-B_kcdeCx.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-hard.json":()=>o(()=>import("./ar-clue-geography-hard-BCuCMNGp.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-medium.json":()=>o(()=>import("./ar-clue-geography-medium-CkoNY3Du.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-words.json":()=>o(()=>import("./ar-clue-geography-words-C7oqRjv9.js"),[]),"/src/data/ar/clue/science/ar-clue-science-easy.json":()=>o(()=>import("./ar-clue-science-easy-f07zg_lU.js"),[]),"/src/data/ar/clue/science/ar-clue-science-hard.json":()=>o(()=>import("./ar-clue-science-hard-CV32qLEY.js"),[]),"/src/data/ar/clue/science/ar-clue-science-medium.json":()=>o(()=>import("./ar-clue-science-medium-BtIrOjNp.js"),[]),"/src/data/ar/clue/science/ar-clue-science-words.json":()=>o(()=>import("./ar-clue-science-words-DpIQpR0-.js"),[]),"/src/data/ar/formation/ar-formation-easy.json":()=>o(()=>import("./ar-formation-easy-CuHzQLY1.js"),[]),"/src/data/ar/formation/ar-formation-hard.json":()=>o(()=>import("./ar-formation-hard-CRxFgu7h.js"),[]),"/src/data/ar/image-clue/animals/data.json":()=>o(()=>import("./data-USJTiWy0.js"),[]),"/src/data/ar/image-clue/fruits-and-vegetables/data.json":()=>o(()=>import("./data-DlhJ3pZw.js"),[]),"/src/data/ar/image-clue/shapes/data.json":()=>o(()=>import("./data-B126H-NP.js"),[]),"/src/data/ar/letter-flow/ar-flow-easy.json":()=>o(()=>import("./ar-flow-easy-C68xgLTr.js"),[]),"/src/data/ar/letter-flow/ar-flow-medium.json":()=>o(()=>import("./ar-flow-medium-BL27Zp8Y.js"),[]),"/src/data/ar/outside-the-story/animals.json":()=>o(()=>import("./animals-BD_uC3F6.js"),[]),"/src/data/ar/outside-the-story/anime.json":()=>o(()=>import("./anime-X9XTb-jh.js"),[]),"/src/data/ar/outside-the-story/cars.json":()=>o(()=>import("./cars-LFoQ5kcr.js"),[]),"/src/data/ar/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-9ln4fVtF.js"),[]),"/src/data/ar/outside-the-story/characters.json":()=>o(()=>import("./characters-BClrgWDD.js"),[]),"/src/data/ar/outside-the-story/clothes.json":()=>o(()=>import("./clothes-DZukcyjc.js"),[]),"/src/data/ar/outside-the-story/drinks.json":()=>o(()=>import("./drinks-DWTisQdZ.js"),[]),"/src/data/ar/outside-the-story/foods.json":()=>o(()=>import("./foods-BPEl4jwc.js"),[]),"/src/data/ar/outside-the-story/football.json":()=>o(()=>import("./football-BkDTW0je.js"),[]),"/src/data/ar/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-CWZ59ral.js"),[]),"/src/data/ar/outside-the-story/gamers.json":()=>o(()=>import("./gamers-DU27ka0Y.js"),[]),"/src/data/ar/outside-the-story/geography.json":()=>o(()=>import("./geography-Bmt1Mp9F.js"),[]),"/src/data/ar/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-CvncURYW.js"),[]),"/src/data/ar/outside-the-story/science.json":()=>o(()=>import("./science-C1rxd0mO.js"),[]),"/src/data/ar/outside-the-story/series.json":()=>o(()=>import("./series-DgCSJJru.js"),[]),"/src/data/ar/outside-the-story/spy.json":()=>o(()=>import("./spy-CTUdze8o.js"),[]),"/src/data/ar/outside-the-story/sweets.json":()=>o(()=>import("./sweets-0_2hbNMS.js"),[]),"/src/data/ar/picture-choice/animals/data.json":()=>o(()=>import("./data-6hZ_2-dK.js"),[]),"/src/data/ar/word-choice/animals/data.json":()=>o(()=>import("./data-Bij5nysW.js"),[]),"/src/data/en/clue/animals/en-clue-animals-easy.json":()=>o(()=>import("./en-clue-animals-easy-vc2CgBiI.js"),[]),"/src/data/en/clue/animals/en-clue-animals-hard.json":()=>o(()=>import("./en-clue-animals-hard-BmQiyFGH.js"),[]),"/src/data/en/clue/animals/en-clue-animals-medium.json":()=>o(()=>import("./en-clue-animals-medium-CDppU-oU.js"),[]),"/src/data/en/clue/animals/en-clue-animals-words.json":()=>o(()=>import("./en-clue-animals-words-OyMRQ2OB.js"),[]),"/src/data/en/clue/geography/en-clue-geography-easy.json":()=>o(()=>import("./en-clue-geography-easy-v49lXgS1.js"),[]),"/src/data/en/clue/geography/en-clue-geography-hard.json":()=>o(()=>import("./en-clue-geography-hard-Hc9ZYG1D.js"),[]),"/src/data/en/clue/geography/en-clue-geography-medium.json":()=>o(()=>import("./en-clue-geography-medium-Yt4_5ZKV.js"),[]),"/src/data/en/clue/geography/en-clue-geography-words.json":()=>o(()=>import("./en-clue-geography-words-BJFrdNPX.js"),[]),"/src/data/en/clue/science/en-clue-science-easy.json":()=>o(()=>import("./en-clue-science-easy-CXDUIzZm.js"),[]),"/src/data/en/clue/science/en-clue-science-hard.json":()=>o(()=>import("./en-clue-science-hard-Dqcig8Ht.js"),[]),"/src/data/en/clue/science/en-clue-science-medium.json":()=>o(()=>import("./en-clue-science-medium-Dm_81XWt.js"),[]),"/src/data/en/clue/science/en-clue-science-words.json":()=>o(()=>import("./en-clue-science-words-BdiwMlAj.js"),[]),"/src/data/en/formation/en-formation-easy.json":()=>o(()=>import("./en-formation-easy-CqPS8TrH.js"),[]),"/src/data/en/image-clue/animals/data.json":()=>o(()=>import("./data-BYo_61tt.js"),[]),"/src/data/en/image-clue/fruits-and-vegetables/data.json":()=>o(()=>import("./data-B6FoT8eG.js"),[]),"/src/data/en/image-clue/shapes/data.json":()=>o(()=>import("./data-Bu1Ld6Qx.js"),[]),"/src/data/en/letter-flow/en-flow-easy.json":()=>o(()=>import("./en-flow-easy-DqbTaQjR.js"),[]),"/src/data/en/outside-the-story/animals.json":()=>o(()=>import("./animals-D78oH89-.js"),[]),"/src/data/en/outside-the-story/anime.json":()=>o(()=>import("./anime-DXIlEidq.js"),[]),"/src/data/en/outside-the-story/cars.json":()=>o(()=>import("./cars-Cw03Nxyo.js"),[]),"/src/data/en/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-DwVIQVvA.js"),[]),"/src/data/en/outside-the-story/characters.json":()=>o(()=>import("./characters-Dl2vwTPn.js"),[]),"/src/data/en/outside-the-story/clothes.json":()=>o(()=>import("./clothes-BiLKpCWj.js"),[]),"/src/data/en/outside-the-story/drinks.json":()=>o(()=>import("./drinks-CP1Emjyy.js"),[]),"/src/data/en/outside-the-story/foods.json":()=>o(()=>import("./foods-BKBSmJG2.js"),[]),"/src/data/en/outside-the-story/football.json":()=>o(()=>import("./football-B8eU_HgW.js"),[]),"/src/data/en/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-B5narx4J.js"),[]),"/src/data/en/outside-the-story/gamers.json":()=>o(()=>import("./gamers-Dm5Tu0YA.js"),[]),"/src/data/en/outside-the-story/geography.json":()=>o(()=>import("./geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-BnHY6_tE.js"),[]),"/src/data/en/outside-the-story/science.json":()=>o(()=>import("./science-DF1sazzy.js"),[]),"/src/data/en/outside-the-story/series.json":()=>o(()=>import("./series-dqakDLa9.js"),[]),"/src/data/en/outside-the-story/spy.json":()=>o(()=>import("./spy-DLpfZG_H.js"),[]),"/src/data/en/outside-the-story/sweets.json":()=>o(()=>import("./sweets-DDZ5JqsI.js"),[]),"/src/data/en/picture-choice/animals/data.json":()=>o(()=>import("./data-CtXqoHRL.js"),[]),"/src/data/en/word-choice/animals/data.json":()=>o(()=>import("./data-BDxquZu-.js"),[])})[x];return A?((await A()).default?.levels||[]).map(i=>{if(typeof i=="object"&&i!==null&&"id"in i&&"solutionWord"in i&&"gridSize"in i&&"endpoints"in i){const{width:R,height:_}=i.gridSize,$=[];for(let m=0;m<_;m++)for(let e=0;e<R;e++)$.push({x:e,y:m,letter:"",isUsed:!1});const S=i.endpoints,C=Array.from(new Set(S.map(m=>m.letter))),b=new Map;C.forEach((m,e)=>{b.set(m,Ne(e,C.length,72,48))}),S.forEach(m=>{const e=m.y*R+m.x,s=b.get(m.letter);e<$.length&&($[e]={x:m.x,y:m.y,letter:m.letter,isUsed:!1,color:s})});const g=i;return{id:String(g.id),difficulty:d,words:[g.solutionWord],board:$,solution:g.solutionWord,endpoints:g.endpoints.map(m=>({...m,color:b.get(m.letter)}))}}return null}).filter(i=>i!==null):[]}catch(x){return console.error(`LetterFlowGameEngine: Failed to load levels for ${c}/${d}.`,x),[{id:"error",difficulty:"easy",words:[],board:[],solution:"",endpoints:[]}]}}generateBoard(a,c,d,x){if(!x)return[];const I=Ve(x.split("")),A=Math.ceil(Math.sqrt(I.length)),B=[];for(let k=0;k<A;k++)for(let i=0;i<A;i++){const R=k*A+i;R<I.length&&B.push({x:i,y:k,letter:I[R],isUsed:!1})}return B}}const he=new Fe,ue=24;function Ue(r,a=ue,c=68,d=48){return`hsl(${Math.round(r*360/a)%360}, ${c}%, ${d}%)`}function ge(r){if(!r)return;let a=0;const c=r.toUpperCase();for(let x=0;x<c.length;x++)a=(a<<5)-a+c.charCodeAt(x),a|=0;const d=Math.abs(a)%ue;return Ue(d,ue)}function Be(){const r=be(),a=De(),{language:c,categories:d,difficulty:x,gameMode:I,teams:A,currentTeam:B,consumeHint:k}=Oe(),{t:i}=xe(),{loading:R,currentLevel:_,currentLevelIndex:$,nextLevel:S}=$e(he,{language:c,categories:d,difficulty:x}),[C,b]=j.useState([]),[g,m]=j.useState([]),[e,s]=j.useState([]),[O,L]=j.useState(null),[h,u]=j.useState(null),[v,M]=j.useState("playing");j.useEffect(()=>{if(_){if(_.board&&_.board.length>0&&_.board.some(t=>t.letter))b(_.board.map(t=>({...t})));else{const t=he.generateBoard("",_.difficulty,c,_.board.map(n=>n.letter).join(""));b(t)}s([]),m([]),u(null),M("playing")}},[_,c]);const y=j.useMemo(()=>[...new Set(_?.endpoints.map(t=>t.letter)||[])],[_]),V=j.useMemo(()=>{const t=new Map;return _?.endpoints.forEach(n=>t.set(`${n.x}-${n.y}`,n.color)),t},[_]),q=j.useCallback(t=>{if(t)return ge(t)},[]),H=j.useCallback(t=>_?_.endpoints.some(n=>n.x===t.x&&n.y===t.y&&n.letter===t.letter):!1,[_]),_e=j.useCallback((t,n)=>{const f=Math.abs(t.x-n.x),w=Math.abs(t.y-n.y);return f===1&&w===0||f===0&&w===1},[]),me=j.useCallback(t=>{if(t.length<2)return!0;for(let n=1;n<t.length;n++)if(!_e(t[n-1],t[n]))return!1;return!0},[_e]),fe=j.useCallback((t,n,f)=>{if(!t.letter){if(t.isUsed){if(f){const w=e.find(N=>N.word===f);if(w&&w.cells.some(N=>N.x===t.x&&N.y===t.y))return!1}return!0}return!1}return!(n&&t.x===n.x&&t.y===n.y||f&&t.letter===f&&H(t))},[e,H]),oe=j.useCallback(t=>e.length===0?[]:e.filter(n=>n.cells.some(f=>t.some(w=>w.x===f.x&&w.y===f.y))),[e]),D=j.useCallback((t,n=1200)=>{L(t),n>0&&setTimeout(()=>L(null),n)},[]),Ee=j.useCallback(t=>{if(!H(t))return;const n=e.find(f=>f.word===t.letter);n&&(s(f=>f.filter(w=>w.word!==t.letter)),b(f=>f.map(w=>{const N=n.cells.some(F=>F.x===w.x&&F.y===w.y),G=V.get(`${w.x}-${w.y}`);return N?{...w,isUsed:!1,color:G??void 0}:w})),D(`Removed connection for ${t.letter}`,900)),u(t.letter),m([t])},[e,H,D,V]),ve=j.useCallback(t=>{if(!h||g.length===0)return;const n=g[0]||null;if(fe(t,n,h)||!(t.letter===h||t.letter===""))return;const f=g[g.length-1];if(f&&f.x===t.x&&f.y===t.y)return;const w=Math.abs(t.x-f.x),N=Math.abs(t.y-f.y);if(w===1&&N===1||w>1||N>1)return;const G=g.findIndex(X=>X.x===t.x&&X.y===t.y);if(G!==-1){m(X=>X.slice(0,G+1));return}if(t.isUsed)return;const F=[...g,t];if(!me(F))return;if(H(t)&&!(g.length>0&&g[0].x===t.x&&g[0].y===t.y)&&t.letter===h){const X=oe(F);X.length>0&&(s(T=>T.filter(P=>!X.includes(P))),b(T=>T.map(P=>{const K=X.some(Q=>Q.cells.some(Z=>Z.x===P.x&&Z.y===P.y)),te=V.get(`${P.x}-${P.y}`);return K?{...P,isUsed:!1,color:te??void 0}:P})),D("Existing connection(s) removed by new connection",1100));const re=C.find(T=>T.x===F[0].x&&T.y===F[0].y)?.color||q(F[0].letter);b(T=>T.map(P=>{const K=F.some(Q=>Q.x===P.x&&Q.y===P.y),te=V.get(`${P.x}-${P.y}`);return K?{...P,isUsed:!0,color:te??re}:P}));const ie={word:h,cells:F.map(T=>{const P=C.find(K=>K.x===T.x&&K.y===T.y);return{...T,color:P&&P.color||re}}),startIndex:0};s(T=>[...T.filter(K=>K.word!==h),ie]),D(`Connected ${h}`,900),u(null),m([]);const de=[...e.map(T=>T.word),h].filter(Boolean),ee=Array.from(new Set(de));y.every(T=>ee.includes(T))&&(D(i.congrats,2e3),I==="competitive"?setTimeout(()=>S(),2e3):M("won"))}else m(F)},[h,g,fe,H,me,oe,C,q,e,y,S,i,D,V,I]),je=j.useCallback(()=>{if(g.length>0){const t=g[g.length-1];H(t)&&!(g.length>1&&g[0].x===t.x&&g[0].y===t.y)&&t.letter===h||(u(null),m([]),D("Path must connect two endpoints!",1200))}},[g,H,h,D]),we=j.useCallback(()=>{if(!_||e.length>=_.endpoints.length/2)return;if(I==="competitive"&&!k(A[B].id)){D(i.noHintsLeft,2e3);return}const t=y.filter(l=>!e.some(p=>p.word===l));if(t.length===0)return;const n=t[0],f=_.endpoints.filter(l=>l.letter===n);if(f.length<2){D(`No endpoints found for ${n}`,1500);return}const w=f[0],N=f[1],G=new Map;C.forEach(l=>G.set(`${l.x}-${l.y}`,l));const F=C.map(l=>l.x),ae=C.map(l=>l.y),X=Math.min(...F),re=Math.max(...F),ie=Math.min(...ae),de=Math.max(...ae),ee=`${w.x}-${w.y}`,ce=`${N.x}-${N.y}`,T=[ee],P=new Set([ee]),K=new Map;K.set(ee,null);const te=(l,p)=>{const U=`${l}-${p}`,Y=G.get(U);return Y?!Y.letter||Y.letter===n:!1},Q=l=>{const[p,U]=l.split("-").map(z=>parseInt(z,10));return[[p+1,U],[p-1,U],[p,U+1],[p,U-1]].filter(([z,J])=>z>=X&&z<=re&&J>=ie&&J<=de).map(([z,J])=>`${z}-${J}`)};let Z=!1;for(;T.length>0&&!Z;){const l=T.shift();if(l===ce){Z=!0;break}for(const p of Q(l)){if(P.has(p))continue;const[U,Y]=p.split("-").map(z=>parseInt(z,10));te(U,Y)&&(P.add(p),K.set(p,l),T.push(p))}}if(!Z){D(`No path found for ${n}`,1600);return}const W=[];let ne=ce;for(;ne;){const l=G.get(ne);if(!l)break;W.push({...l}),ne=K.get(ne)??null}W.reverse();const le=oe(W);le.length>0&&(s(l=>l.filter(p=>!le.includes(p))),b(l=>l.map(p=>{const U=le.some(z=>z.cells.some(J=>J.x===p.x&&J.y===p.y)),Y=V.get(`${p.x}-${p.y}`);return U?{...p,isUsed:!1,color:Y??void 0}:p})),D("Existing connection(s) removed by hint connection",1100));const pe=G.get(`${W[0].x}-${W[0].y}`)?.color||q(W[0].letter);b(l=>l.map(p=>{const U=W.some(z=>z.x===p.x&&z.y===p.y),Y=V.get(`${p.x}-${p.y}`);return U?{...p,isUsed:!0,color:Y??pe}:p}));const Pe={word:n,cells:W.map(l=>{const p=G.get(`${l.x}-${l.y}`);return{...l,color:p&&p.color||pe}}),startIndex:0};s(l=>[...l.filter(U=>U.word!==n),Pe]),D(`Hint: Connected ${n}`,900),u(null),m([]);const Ae=[...e.map(l=>l.word),n].filter(Boolean),Re=Array.from(new Set(Ae));y.every(l=>Re.includes(l))&&(D(i.congrats,2e3),I==="competitive"?setTimeout(()=>S(),2e3):M("won"))},[_,C,e,y,V,q,oe,D,I,A,B,k,i,S]),Ie=j.useCallback(()=>{if(e.length===0)return;const t=e[e.length-1];s(n=>n.slice(0,-1)),b(n=>n.map(f=>{if(!t.cells.some(G=>G.x===f.x&&G.y===f.y))return f;const N=V.get(`${f.x}-${f.y}`);return{...f,isUsed:!1,color:N??void 0}})),m([]),u(null),D(`Undo: Removed connection for ${t.word}`),v==="won"&&M("playing")},[e,D,V,v]),Le=j.useCallback(()=>{s([]),b(t=>t.map(n=>{const f=V.get(`${n.x}-${n.y}`);return{...n,isUsed:!1,color:f}})),m([]),u(null),M("playing"),D("Game reset - all connections removed")},[D,V]),Te=j.useCallback(()=>{r(I==="competitive"?`/team-config/${a.gameType}`:`/game-mode/${a.gameType}`)},[r,a.gameType,I]);return{loading:R,currentLevel:_,currentLevelIndex:$,board:C,selectedPath:g,foundWords:e,notification:O,gameState:v,isChecking:!1,activeLetter:h,isDrawing:!!h,handleBack:Te,handleMouseDown:Ee,handleMouseEnter:ve,handleMouseUp:je,clearSelection:()=>{m([]),u(null)},onHint:we,onUndo:Ie,onReset:Le}}function Ge({letter:r,x:a,y:c,isSelected:d=!1,isFound:x=!1,isActive:I=!1,onMouseDown:A,onMouseEnter:B,onMouseUp:k,disabled:i=!1,className:R,connectionDirections:_=[],connectionColor:$,cellColor:S}){const C=j.useRef(null),b=v=>{i||(v.target?.setPointerCapture?.(v.pointerId),A?.({x:a,y:c,letter:r}),v.preventDefault())},g=v=>{if(i)return;const y=document.elementFromPoint(v.clientX,v.clientY)?.closest?.("[data-cell-x]");if(y){const V=parseInt(y.getAttribute("data-cell-x")||"0",10),q=parseInt(y.getAttribute("data-cell-y")||"0",10);B?.({x:V,y:q,letter:y.textContent?.trim()||""})}},m=v=>{try{v.target?.releasePointerCapture?.(v.pointerId)}catch(M){console.debug("releasePointerCapture failed",M)}k?.()},e=v=>{if(i)return;v.preventDefault();const M=v.touches[0],y=document.elementFromPoint(M.clientX,M.clientY);if(y&&y.getAttribute("data-cell-x")&&y.getAttribute("data-cell-y")){const V=parseInt(y.getAttribute("data-cell-x")||"0"),q=parseInt(y.getAttribute("data-cell-y")||"0"),H=y.textContent?.trim()||"";A?.({x:V,y:q,letter:H})}},s=v=>{if(i)return;v.preventDefault();const M=v.touches[0],y=document.elementFromPoint(M.clientX,M.clientY);if(y&&y.getAttribute("data-cell-x")&&y.getAttribute("data-cell-y")){const V=parseInt(y.getAttribute("data-cell-x")||"0"),q=parseInt(y.getAttribute("data-cell-y")||"0"),H=y.textContent?.trim()||"";B?.({x:V,y:q,letter:H})}},O=v=>{i||(v.preventDefault(),k?.())},L=v=>{i||(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),A?.({x:a,y:c,letter:r}))},h=56,u=$??S??void 0;return E.jsxs("div",{ref:C,role:"button",tabIndex:i?-1:0,"aria-disabled":i,"aria-pressed":d||void 0,"data-cell-x":a,"data-cell-y":c,onPointerDown:b,onPointerMove:g,onPointerUp:m,onTouchStart:e,onTouchMove:s,onTouchEnd:O,onKeyDown:L,className:se("aspect-square flex items-center justify-center rounded-md text-xl font-bold select-none relative transition-all duration-150",{"bg-gray-50 dark:bg-gray-800":!d&&!x&&!I,"cursor-not-allowed opacity-70":i,"text-gray-900 dark:text-gray-100":!d&&!x&&!I&&!u},R),children:[_.includes("top")&&E.jsx("div",{"aria-hidden":!0,className:"absolute top-0 left-1/2 transform -translate-x-1/2",style:{width:`${Math.max(6,h*.08)}%`,height:"40%",background:$,borderRadius:4,zIndex:0}}),_.includes("bottom")&&E.jsx("div",{"aria-hidden":!0,className:"absolute bottom-0 left-1/2 transform -translate-x-1/2",style:{width:`${Math.max(6,h*.08)}%`,height:"40%",background:$,borderRadius:4,zIndex:0}}),_.includes("left")&&E.jsx("div",{"aria-hidden":!0,className:"absolute left-0 top-1/2 transform -translate-y-1/2",style:{height:`${Math.max(6,h*.08)}%`,width:"40%",background:$,borderRadius:4,zIndex:0}}),_.includes("right")&&E.jsx("div",{"aria-hidden":!0,className:"absolute right-0 top-1/2 transform -translate-y-1/2",style:{height:`${Math.max(6,h*.08)}%`,width:"40%",background:$,borderRadius:4,zIndex:0}}),E.jsx("div",{className:"flex items-center justify-center rounded-full z-10",style:{width:`${h}%`,height:`${h}%`,background:u??"#ffffff",boxShadow:u?"0 2px 8px rgba(0,0,0,0.12)":void 0,border:u?"none":"1px solid rgba(0,0,0,0.06)"},children:r?E.jsx("span",{className:"text-sm font-bold",style:{color:u||d||x||I?"#fff":"#111"},children:r}):null})]})}function ye(r){return ge(r)}function ze({cells:r,selectedPath:a,foundWords:c,activeLetter:d,onMouseDown:x,onMouseEnter:I,onMouseUp:A,className:B,dir:k="ltr"}){const i=r.length===0?0:Math.max(...r.map(e=>e.x))+1,R=k==="rtl",_=e=>`${e.x}-${e.y}`,$=new Map;a.forEach(e=>$.set(_(e),e));const S=new Map;c.forEach(e=>e.cells.forEach(s=>S.set(_(s),{word:e.word,cells:e.cells})));const C=e=>{const s=[],O=[...c.map(L=>L.cells),a];for(const L of O){const h=L.findIndex(u=>u.x===e.x&&u.y===e.y);if(h!==-1){if(h>0){const u=L[h-1];u.x===e.x-1&&u.y===e.y&&s.push("left"),u.x===e.x+1&&u.y===e.y&&s.push("right"),u.x===e.x&&u.y===e.y-1&&s.push("top"),u.x===e.x&&u.y===e.y+1&&s.push("bottom")}if(h<L.length-1){const u=L[h+1];u.x===e.x-1&&u.y===e.y&&s.push("left"),u.x===e.x+1&&u.y===e.y&&s.push("right"),u.x===e.x&&u.y===e.y-1&&s.push("top"),u.x===e.x&&u.y===e.y+1&&s.push("bottom")}}}return[...new Set(s)]},b=e=>{for(const s of c)if(s.cells.some(O=>O.x===e.x&&O.y===e.y)){const O=s.cells[0]?.color??s.cells.find(h=>h.color)?.color;if(O)return O;const L=r.find(h=>h.x===s.cells[0].x&&h.y===s.cells[0].y);return L?.color?L.color:ye(s.word)}if(a&&a.length>0&&a.some(s=>s.x===e.x&&s.y===e.y)){const s=a[0];if(s?.color)return s.color;const O=r.find(L=>L.x===s.x&&L.y===s.y);return O?.color?O.color:ye(s?.letter)}if(e.color)return e.color},g=e=>$.has(_(e)),m=e=>S.has(_(e));return E.jsx("div",{className:se("grid gap-1 mx-auto max-w-md",B,{"rtl-direction":R}),style:{gridTemplateColumns:`repeat(${i}, minmax(0, 1fr))`,direction:R?"rtl":"ltr",touchAction:"none"},children:r.map(e=>{const s=C(e),O=b(e),L=m(e)||e.letter!==""&&e.letter!==d&&e.isUsed;return E.jsx(Ge,{letter:e.letter,x:e.x,y:e.y,isSelected:g(e),isFound:m(e),isActive:d&&e.letter===d?!0:void 0,onMouseDown:x,onMouseEnter:I,onMouseUp:A,disabled:L,connectionDirections:s,connectionColor:O,cellColor:e.color},`${e.x}-${e.y}`)})})}function He({foundWords:r,t:a,className:c}){return r.length===0?null:E.jsxs("div",{className:se("mt-6",c),children:[E.jsxs("div",{className:"text-lg font-semibold mb-2",children:[a.selected,":"]}),E.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((d,x)=>E.jsx("div",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-md",children:d.word},x))})]})}function Ke({foundWords:r,totalWords:a,t:c,className:d}){const x=r.length/a;return E.jsxs("div",{className:se("mt-6 text-center",d),children:[E.jsxs("div",{className:"text-gray-600",children:[c.selected," ",r.length," ",c.of," ",a]}),E.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:E.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-500",style:{width:`${x*100}%`}})})]})}function qe(){j.useEffect(()=>{const r=EventTarget.prototype.addEventListener;return EventTarget.prototype.addEventListener=function(a,c,d){if((a==="touchmove"||a==="touchstart"||a==="touchend")&&typeof d=="object"&&d&&!("passive"in d)){const x={...d,passive:!1};return r.call(this,a,c,x)}return r.call(this,a,c,d)},()=>{EventTarget.prototype.addEventListener=r}},[])}const tt=()=>{const{t:r,i18n:a}=xe(),c=a.dir(),d=Ce("letterFlow"),x=d?{title:d.title??"",description:d.description??"",steps:d.steps??[]}:void 0;qe();const{loading:I,currentLevel:A,board:B,selectedPath:k,foundWords:i,notification:R,gameState:_,activeLetter:$,handleBack:S,handleMouseDown:C,handleMouseEnter:b,handleMouseUp:g,onHint:m,onUndo:e,onReset:s,clearSelection:O,currentLevelIndex:L}=Be(),h=()=>E.jsx(ze,{cells:B,selectedPath:k,foundWords:i,activeLetter:$,onMouseDown:y=>C({...y,isUsed:!1}),onMouseEnter:y=>b({...y,isUsed:!1}),onMouseUp:g}),u=()=>i.length===0?null:E.jsx(He,{foundWords:i,t:{selected:r.selected}}),v=()=>{if(!R)return null;let y="info";return R.includes("congrats")||R===r.congrats?y="success":R.includes("Already found")||R.includes("cannot cross")?y="warning":(R.includes("must connect")||R.includes("horizontal or vertical"))&&(y="error"),E.jsx(Me,{message:R,type:y})};if(I)return E.jsx("div",{className:`flex flex-col items-center justify-center min-h-screen ${c==="rtl"?"text-right":""}`,dir:c,children:E.jsxs("div",{className:"text-xl",children:[r.loading,"..."]})});if(!A)return E.jsxs("div",{className:`flex flex-col items-center justify-center min-h-screen ${c==="rtl"?"text-right":""}`,dir:c,children:[E.jsx("div",{className:"text-xl",children:r.noLevelsFound}),E.jsx("button",{onClick:S,className:"mt-4 btn",children:r.back})]});const M=Math.floor((A?.endpoints.length??0)/2);return E.jsxs(Se,{title:r.letterFlowTitle??A.id,levelIndex:L??0,onBack:S,difficulty:A.difficulty,layoutType:"text",instructions:x,children:[v(),E.jsx("div",{className:`mb-6 touch-none ${c==="rtl"?"arabic-layout":""} transition-colors duration-300`,dir:c,children:h()}),u(),E.jsx(ke,{onReset:s,onRemoveLetter:e,onClearAnswer:O,onHint:m,onNextLevel:void 0,onPrevLevel:void 0,onCheckAnswer:()=>{},onShowSolution:void 0,canRemove:i.length>0,canClear:k.length>0,canCheck:!1,canPrev:!!(L&&L>0),canNext:_==="won",canHint:i.length<M,hintsRemaining:void 0,gameState:_==="won"?"won":"playing",isKidsMode:!1,labels:{remove:r.undo,clear:r.clear,check:r.check,hint:r.hint,showSolution:r.showSolution,reset:r.reset,prev:r.prev,next:r.next},showOnly:["remove","hint","reset","next"]}),E.jsx(Ke,{foundWords:i,totalWords:M,t:{selected:r.selected,of:r.of}})]})};export{tt as default};
