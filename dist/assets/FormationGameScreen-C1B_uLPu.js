import{_ as e,u as q,a as J,b as K,c as N,r as d,j as o,f as O,B as k,C as Q}from"./index-DBe-om3R.js";import{u as X,G as Y,L as Z}from"./useInstructions-ir7OMZQa.js";import{s as ee,u as te,N as se}from"./Notification-B3rLnyjl.js";import{R as re,G as V,a as ae}from"./GameButton-nZcrT6nX.js";class oe{async loadLevels(l){const{language:_,difficulty:i}=l;if(!i)return[];try{const n=`/src/data/${_}/formation/${_}-formation-${i}.json`,p=Object.assign({"/src/data/ar/clue/animals/ar-clue-animals-easy.json":()=>e(()=>import("./ar-clue-animals-easy-B_GJKLA_.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-hard.json":()=>e(()=>import("./ar-clue-animals-hard-7EfMbXs4.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-medium.json":()=>e(()=>import("./ar-clue-animals-medium-Bcn1oCUk.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-words.json":()=>e(()=>import("./ar-clue-animals-words-DxH5pZeF.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-easy.json":()=>e(()=>import("./ar-clue-geography-easy-B_kcdeCx.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-hard.json":()=>e(()=>import("./ar-clue-geography-hard-BCuCMNGp.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-medium.json":()=>e(()=>import("./ar-clue-geography-medium-CkoNY3Du.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-words.json":()=>e(()=>import("./ar-clue-geography-words-C7oqRjv9.js"),[]),"/src/data/ar/clue/science/ar-clue-science-easy.json":()=>e(()=>import("./ar-clue-science-easy-f07zg_lU.js"),[]),"/src/data/ar/clue/science/ar-clue-science-hard.json":()=>e(()=>import("./ar-clue-science-hard-CV32qLEY.js"),[]),"/src/data/ar/clue/science/ar-clue-science-medium.json":()=>e(()=>import("./ar-clue-science-medium-BtIrOjNp.js"),[]),"/src/data/ar/clue/science/ar-clue-science-words.json":()=>e(()=>import("./ar-clue-science-words-DpIQpR0-.js"),[]),"/src/data/ar/formation/ar-formation-easy.json":()=>e(()=>import("./ar-formation-easy-CuHzQLY1.js"),[]),"/src/data/ar/formation/ar-formation-hard.json":()=>e(()=>import("./ar-formation-hard-CRxFgu7h.js"),[]),"/src/data/ar/image-clue/animals/data.json":()=>e(()=>import("./data-USJTiWy0.js"),[]),"/src/data/ar/image-clue/fruits/data.json":()=>e(()=>import("./data-CenmuYLK.js"),[]),"/src/data/ar/image-clue/shapes/data.json":()=>e(()=>import("./data-B126H-NP.js"),[]),"/src/data/ar/letter-flow/ar-flow-easy.json":()=>e(()=>import("./ar-flow-easy-C68xgLTr.js"),[]),"/src/data/ar/letter-flow/ar-flow-medium.json":()=>e(()=>import("./ar-flow-medium-BL27Zp8Y.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-animals.json":()=>e(()=>import("./ar-outside-the-story-animals-0m0m6kXG.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-fruits.json":()=>e(()=>import("./ar-outside-the-story-fruits-zTkTe7Gg.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-geography.json":()=>e(()=>import("./ar-outside-the-story-geography-CVgh5HaL.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-science.json":()=>e(()=>import("./ar-outside-the-story-science-D4AkFF1_.js"),[]),"/src/data/ar/picture-choice/animals/data.json":()=>e(()=>import("./data-6hZ_2-dK.js"),[]),"/src/data/ar/word-choice/animals/data.json":()=>e(()=>import("./data-Bij5nysW.js"),[]),"/src/data/en/clue/animals/en-clue-animals-easy.json":()=>e(()=>import("./en-clue-animals-easy-vc2CgBiI.js"),[]),"/src/data/en/clue/animals/en-clue-animals-hard.json":()=>e(()=>import("./en-clue-animals-hard-BmQiyFGH.js"),[]),"/src/data/en/clue/animals/en-clue-animals-medium.json":()=>e(()=>import("./en-clue-animals-medium-CDppU-oU.js"),[]),"/src/data/en/clue/animals/en-clue-animals-words.json":()=>e(()=>import("./en-clue-animals-words-OyMRQ2OB.js"),[]),"/src/data/en/clue/geography/en-clue-geography-easy.json":()=>e(()=>import("./en-clue-geography-easy-v49lXgS1.js"),[]),"/src/data/en/clue/geography/en-clue-geography-hard.json":()=>e(()=>import("./en-clue-geography-hard-Hc9ZYG1D.js"),[]),"/src/data/en/clue/geography/en-clue-geography-medium.json":()=>e(()=>import("./en-clue-geography-medium-Yt4_5ZKV.js"),[]),"/src/data/en/clue/geography/en-clue-geography-words.json":()=>e(()=>import("./en-clue-geography-words-BJFrdNPX.js"),[]),"/src/data/en/clue/science/en-clue-science-easy.json":()=>e(()=>import("./en-clue-science-easy-CXDUIzZm.js"),[]),"/src/data/en/clue/science/en-clue-science-hard.json":()=>e(()=>import("./en-clue-science-hard-Dqcig8Ht.js"),[]),"/src/data/en/clue/science/en-clue-science-medium.json":()=>e(()=>import("./en-clue-science-medium-Dm_81XWt.js"),[]),"/src/data/en/clue/science/en-clue-science-words.json":()=>e(()=>import("./en-clue-science-words-BdiwMlAj.js"),[]),"/src/data/en/formation/en-formation-easy.json":()=>e(()=>import("./en-formation-easy-CqPS8TrH.js"),[]),"/src/data/en/image-clue/animals/data.json":()=>e(()=>import("./data-BYo_61tt.js"),[]),"/src/data/en/image-clue/fruits/data.json":()=>e(()=>import("./data-OxJ4m8-5.js"),[]),"/src/data/en/image-clue/shapes/data.json":()=>e(()=>import("./data-Bu1Ld6Qx.js"),[]),"/src/data/en/letter-flow/en-flow-easy.json":()=>e(()=>import("./en-flow-easy-DqbTaQjR.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-animals.json":()=>e(()=>import("./en-outside-the-story-animals-QFa7I_eA.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-fruits.json":()=>e(()=>import("./en-outside-the-story-fruits--LJxQFSa.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-geography.json":()=>e(()=>import("./en-outside-the-story-geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-science.json":()=>e(()=>import("./en-outside-the-story-science-DF1sazzy.js"),[]),"/src/data/en/picture-choice/animals/data.json":()=>e(()=>import("./data-CtXqoHRL.js"),[]),"/src/data/en/word-choice/animals/data.json":()=>e(()=>import("./data-BDxquZu-.js"),[])})[n];return p?((await p()).default?.levels||[]).map(t=>typeof t=="object"&&t!==null&&"id"in t&&"words"in t&&Array.isArray(t.words)&&"grid"in t&&"baseLetters"in t?{id:String(t.id),difficulty:i,words:t.words,grid:t.grid,baseLetters:String(t.baseLetters),solution:t.words[0]||""}:null).filter(t=>t!==null):[]}catch(n){return console.error(`FormationGameEngine: Failed to load levels for ${_}/${i}.`,n),[{id:"error",difficulty:"easy",words:[],grid:[],baseLetters:"ERROR",solution:""}]}}generateLetters(l,_,i,n){return n?ee(n.split("")):[]}}const C=new oe;function ne(){const a=q(),l=J(),{language:_,categories:i,difficulty:n,gameMode:m,teams:p,currentTeam:c,consumeHint:r}=K(),{t}=N(),{loading:x,currentLevel:s,currentLevelIndex:f,nextLevel:g}=te(C,{language:_,categories:i,difficulty:n}),[R,I]=d.useState([]),[h,L]=d.useState(""),[A,$]=d.useState(new Set),[T,b]=d.useState(new Set),[z,y]=d.useState(null),[S,P]=d.useState([]);d.useEffect(()=>{s&&(C.generateLetters&&I(C.generateLetters("",s.difficulty,_,s.baseLetters)),$(new Set),L(""),P([]),b(new Set))},[s,_]);const G=d.useCallback((u,w)=>{S.includes(w)||(L(E=>E+u),P(E=>[...E,w]))},[S]),F=d.useCallback(()=>{L(u=>u.slice(0,-1)),P(u=>u.slice(0,-1))},[]),M=d.useCallback(()=>{I(u=>[...u].sort(()=>Math.random()-.5))},[]),W=d.useCallback(()=>{if(!s||h.length===0)return;const u=new Set(A);if(s.words.includes(h)&&!u.has(h)){u.add(h),$(u);const w=s.words.indexOf(h),E=new Set(T);s.grid.forEach(v=>{v.words.includes(w)&&E.add(`${v.x},${v.y}`)}),b(E),y(t.congrats),u.size===s.words.length&&setTimeout(()=>g(),2e3)}else y(u.has(h)?t.alreadyFound:t.wrongAnswer);L(""),P([]),setTimeout(()=>y(null),1500)},[h,s,A,T,t,g]),B=d.useCallback(()=>{if(!s)return;if(m==="competitive"&&!r(p[c].id)){y(t.noHintsLeft),setTimeout(()=>y(null),2e3);return}const u=s.grid.filter(j=>!T.has(`${j.x},${j.y}`));if(u.length===0)return;const w=u[Math.floor(Math.random()*u.length)],E=new Set(T).add(`${w.x},${w.y}`);b(E);const v=[];if(s.words.forEach((j,U)=>{if(A.has(j))return;s.grid.filter(D=>D.words.includes(U)).every(D=>E.has(`${D.x},${D.y}`))&&v.push(j)}),v.length>0){const j=new Set([...A,...v]);$(j),y(`${t.congrats} ${t.found} ${v.join(", ")}`),j.size===s.words.length&&setTimeout(()=>g(),2e3)}else y(t.hintUsed);setTimeout(()=>y(null),1500)},[s,T,A,m,p,c,r,t,g]),H=d.useCallback(()=>{a(m==="competitive"?`/team-config/${l.gameType}`:`/game-mode/${l.gameType}`)},[a,l.gameType,m]);return{loading:x,currentLevel:s,currentLevelIndex:f,letters:R,currentInput:h,revealedCells:T,notification:z,usedLetterIndices:S,handleBack:H,onLetterSelect:G,onRemoveLast:F,onShuffle:M,onCheckWord:W,onHint:B}}const ie=({letter:a="",isRevealed:l=!1,isEmpty:_=!1,size:i=40,className:n})=>_?o.jsx("div",{className:O("rounded-md border-2 border-transparent bg-transparent",n),style:{width:`${i}px`,height:`${i}px`}}):o.jsx("div",{className:O("rounded-md flex items-center justify-center font-bold border-2 flex-shrink-0 transition-all duration-300",l?"bg-primary/90 border-primary text-primary-foreground animate-in fade-in zoom-in-50":"bg-card border-border",n),style:{width:`${i}px`,height:`${i}px`,fontSize:`${i*.5}px`},children:l?a:""}),ce=({grid:a,revealedCells:l,className:_})=>{const[i,n]=d.useState(40);if(d.useEffect(()=>{const r=()=>{const t=window.innerWidth;t<380?n(28):t<640?n(32):t<768?n(36):n(40)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),!a||a.length===0)return null;const m=Math.max(0,...a.map(r=>r.x)),p=Math.max(0,...a.map(r=>r.y)),c=Array.from({length:p+1},()=>Array(m+1).fill(null));return a.forEach(r=>{c[r.y]&&(c[r.y][r.x]=r)}),o.jsx("div",{className:O("flex flex-col gap-0.5 sm:gap-1 w-full overflow-x-auto py-1.5 sm:py-2",_),children:c.map((r,t)=>o.jsx("div",{className:"flex gap-0.5 sm:gap-1 justify-center",children:r.map((x,s)=>o.jsx(ie,{letter:x?.letter,isRevealed:l.has(`${s},${t}`),isEmpty:!x,size:i},`${s}-${t}`))},t))})},de=({letters:a,usedLetterIndices:l,onLetterSelect:_,onShuffle:i,className:n})=>{const[m,p]=d.useState(180),[c,r]=d.useState(40),[t,x]=d.useState(24);return d.useEffect(()=>{const s=()=>{const f=window.innerWidth;f<380?(p(120),r(28),x(16)):f<640?(p(140),r(32),x(20)):f<768?(p(160),r(36),x(24)):(p(180),r(40),x(28))};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),o.jsxs("div",{className:O("relative mx-auto my-0 sm:my-1",n),style:{width:`${m}px`,height:`${m}px`},children:[a.map((s,f)=>{const g=f/a.length*2*Math.PI,R=a.length>6?m*.45:m*.42,I=Math.cos(g)*R,h=Math.sin(g)*R,L=l.includes(f);return o.jsx(k,{onClick:()=>_(s,f),className:O("absolute rounded-full font-bold transition-all",L?"opacity-40 cursor-not-allowed":"hover:scale-105"),style:{width:`${c}px`,height:`${c}px`,fontSize:`${c*.5}px`,top:`calc(50% - ${c/2}px)`,left:`calc(50% - ${c/2}px)`,transform:`translate(${I}px, ${h}px)`},disabled:L,children:s},`${s}-${f}`)}),o.jsx(k,{size:"icon",variant:"ghost",onClick:i,className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full",style:{width:`${c*1.6}px`,height:`${c*1.6}px`},children:o.jsx(re,{className:"text-muted-foreground",style:{width:`${t}px`,height:`${t}px`}})})]})},fe=()=>{const{t:a}=N(),l=X("formation"),_=l?{title:l.title??a.formationTitle,description:l.description??"",steps:l.steps??[]}:void 0,{loading:i,currentLevel:n,currentLevelIndex:m,letters:p,currentInput:c,revealedCells:r,notification:t,usedLetterIndices:x,handleBack:s,onLetterSelect:f,onRemoveLast:g,onShuffle:R,onCheckWord:I,onHint:h}=ne();return i?o.jsx("div",{className:"flex justify-center items-center h-screen",children:o.jsxs("p",{children:[a.loading,"..."]})}):!n||n.baseLetters==="ERROR"?o.jsxs("div",{className:"flex flex-col justify-center items-center h-screen gap-4 p-4 text-center",children:[o.jsx("p",{className:"text-xl font-semibold",children:a.noLevelsFound}),o.jsx(V,{onClick:s,children:a.back})]}):o.jsxs(Y,{title:a.formationTitle,levelIndex:m,onBack:s,difficulty:n.difficulty,instructions:_,children:[t&&o.jsx(se,{message:t,type:"info"}),o.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-3",children:[o.jsx(ce,{grid:n.grid,revealedCells:r}),o.jsx("div",{className:"h-8 sm:h-10 flex justify-center items-center mb-1 sm:mb-2",children:o.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-primary tracking-wider",children:c||"..."})}),o.jsx(de,{letters:p,usedLetterIndices:Array.from(x),onLetterSelect:f,onShuffle:R}),o.jsxs("div",{className:"flex w-full max-w-xs justify-center gap-1 sm:gap-2 px-1 flex-wrap sm:flex-nowrap items-center",children:[o.jsx(V,{variant:"outline",onClick:g,disabled:c.length===0,icon:ae,className:"flex-1 min-w-[80px] sm:min-w-[100px] py-1.5 sm:py-2 h-auto text-xs sm:text-sm px-2",children:a.remove}),o.jsx(V,{variant:"outline",onClick:h,disabled:r.size>=n.grid.length,icon:Z,className:"flex-1 min-w-[80px] sm:min-w-[100px] py-1.5 sm:py-2 h-auto text-xs sm:text-sm px-2",children:a.hint}),o.jsx(V,{isPrimary:!0,onClick:I,disabled:c.length<2,icon:Q,className:"flex-1 min-w-[120px] sm:min-w-[160px] py-2 sm:py-2.5 h-auto text-xs sm:text-sm px-3.5 text-center whitespace-nowrap font-semibold",children:a.check})]})]})]})};export{fe as default};
