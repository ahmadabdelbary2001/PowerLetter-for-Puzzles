import{_ as r,b as H,c as L,r as _,j as e,B as v,u as z}from"./index-q4Kcks6h.js";import{G as V}from"./GameLayout-CijemBkG.js";class J{async loadLevels(t){const{language:s,categories:a}=t,u=Object.assign({"/src/data/ar/outside-the-story/animals.json":()=>r(()=>import("./animals-BD_uC3F6.js"),[]),"/src/data/ar/outside-the-story/anime.json":()=>r(()=>import("./anime-X9XTb-jh.js"),[]),"/src/data/ar/outside-the-story/cars.json":()=>r(()=>import("./cars-LFoQ5kcr.js"),[]),"/src/data/ar/outside-the-story/cartoons.json":()=>r(()=>import("./cartoons-9ln4fVtF.js"),[]),"/src/data/ar/outside-the-story/characters.json":()=>r(()=>import("./characters-BClrgWDD.js"),[]),"/src/data/ar/outside-the-story/clothes.json":()=>r(()=>import("./clothes-DZukcyjc.js"),[]),"/src/data/ar/outside-the-story/drinks.json":()=>r(()=>import("./drinks-DWTisQdZ.js"),[]),"/src/data/ar/outside-the-story/foods.json":()=>r(()=>import("./foods-BPEl4jwc.js"),[]),"/src/data/ar/outside-the-story/football.json":()=>r(()=>import("./football-BkDTW0je.js"),[]),"/src/data/ar/outside-the-story/fruits-and-vegetables.json":()=>r(()=>import("./fruits-and-vegetables-CWZ59ral.js"),[]),"/src/data/ar/outside-the-story/gamers.json":()=>r(()=>import("./gamers-DU27ka0Y.js"),[]),"/src/data/ar/outside-the-story/geography.json":()=>r(()=>import("./geography-Bmt1Mp9F.js"),[]),"/src/data/ar/outside-the-story/k-pop.json":()=>r(()=>import("./k-pop-CvncURYW.js"),[]),"/src/data/ar/outside-the-story/science.json":()=>r(()=>import("./science-C1rxd0mO.js"),[]),"/src/data/ar/outside-the-story/series.json":()=>r(()=>import("./series-DgCSJJru.js"),[]),"/src/data/ar/outside-the-story/spy.json":()=>r(()=>import("./spy-CTUdze8o.js"),[]),"/src/data/ar/outside-the-story/sweets.json":()=>r(()=>import("./sweets-0_2hbNMS.js"),[]),"/src/data/en/outside-the-story/animals.json":()=>r(()=>import("./animals-D78oH89-.js"),[]),"/src/data/en/outside-the-story/anime.json":()=>r(()=>import("./anime-DXIlEidq.js"),[]),"/src/data/en/outside-the-story/cars.json":()=>r(()=>import("./cars-Cw03Nxyo.js"),[]),"/src/data/en/outside-the-story/cartoons.json":()=>r(()=>import("./cartoons-DwVIQVvA.js"),[]),"/src/data/en/outside-the-story/characters.json":()=>r(()=>import("./characters-Dl2vwTPn.js"),[]),"/src/data/en/outside-the-story/clothes.json":()=>r(()=>import("./clothes-BiLKpCWj.js"),[]),"/src/data/en/outside-the-story/drinks.json":()=>r(()=>import("./drinks-CP1Emjyy.js"),[]),"/src/data/en/outside-the-story/foods.json":()=>r(()=>import("./foods-BKBSmJG2.js"),[]),"/src/data/en/outside-the-story/football.json":()=>r(()=>import("./football-B8eU_HgW.js"),[]),"/src/data/en/outside-the-story/fruits-and-vegetables.json":()=>r(()=>import("./fruits-and-vegetables-B5narx4J.js"),[]),"/src/data/en/outside-the-story/gamers.json":()=>r(()=>import("./gamers-Dm5Tu0YA.js"),[]),"/src/data/en/outside-the-story/geography.json":()=>r(()=>import("./geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/k-pop.json":()=>r(()=>import("./k-pop-BnHY6_tE.js"),[]),"/src/data/en/outside-the-story/science.json":()=>r(()=>import("./science-DF1sazzy.js"),[]),"/src/data/en/outside-the-story/series.json":()=>r(()=>import("./series-dqakDLa9.js"),[]),"/src/data/en/outside-the-story/spy.json":()=>r(()=>import("./spy-DLpfZG_H.js"),[]),"/src/data/en/outside-the-story/sweets.json":()=>r(()=>import("./sweets-DDZ5JqsI.js"),[])}),n=[];for(const x of a){const i=`/src/data/${s}/outside-the-story/${x}.json`,c=u[i];if(!c){console.warn(`OutsideStoryGameEngine: Could not find data file at path: ${i}`);continue}try{const d=await c(),g=Array.isArray(d.default?.words)?d.default.words.map(String):[];n.push({id:`${s}-${x}`,language:s,category:x,words:g,meta:d.default?.meta??{}})}catch(d){console.error(`OutsideStoryGameEngine: Failed to load or parse ${i}`,d)}}return n}}const K=new J;function U(){const{teams:o,language:t,categories:s,resetScores:a,setGameMode:u}=H(),{t:n}=L(),[x,i]=_.useState("role_reveal_handoff"),[c,d]=_.useState([]),[g,P]=_.useState(!0),[h,y]=_.useState(null),[N,b]=_.useState([]),[S,R]=_.useState(0),[k,D]=_.useState([]),[C,O]=_.useState(0),w=_.useCallback(l=>{const p=c.find(I=>I.category===l);if(!p||p.words.length<8){console.error(n.notEnoughWords??"Not enough words for this category.");return}if(o.length<3){console.error(n.min3Players??"Add at least 3 players.");return}const j=[...p.words].sort(()=>.5-Math.random()).slice(0,8),f=j[0],T=Math.floor(Math.random()*o.length),E=o[T].id,W=o.map(I=>I.id).filter(I=>I!==E),F={id:`${Date.now()}`,category:l,secret:f,words:j.sort(),outsiderId:E,insiders:W,votes:{},revealed:!1};y(F),R(0),i("role_reveal_handoff")},[c,o,n]);_.useEffect(()=>{let l=!0;return P(!0),(async()=>{try{const p=await K.loadLevels({language:t??"ar",categories:s});l&&d(p)}finally{l&&P(!1)}})(),()=>{l=!1}},[t,s]),_.useEffect(()=>{g||c.length===0||h||w(c[0].category)},[g,c,h,w]);const G=_.useCallback(()=>{if(o.length<2)return;const l=[...o].sort(()=>Math.random()-.5),p=[];for(let m=0;m<l.length;m++){const j=l[m],f=l[(m+1)%l.length];p.push({asker:j,askee:f})}D(p),R(0),i("question_turn")},[o]),$=_.useCallback(()=>{if(!h)return;const l={};for(const f in h.votes)if(parseInt(f,10)!==h.outsiderId){const E=h.votes[f];l[E]=(l[E]||0)+1}let p=0,m=-1;for(const f in l)l[f]>p&&(p=l[f],m=parseInt(f,10));const j={...h,roundResult:{votedPlayerId:m,pointsAwarded:{}}};y(j),i("outsider_guess")},[h]),q=_.useCallback(l=>{if(!h)return;const p=l===h.secret,m={};o.forEach(f=>m[f.id]=0),p&&(m[h.outsiderId]=10);for(const f in h.votes){const T=parseInt(f,10),E=h.votes[f];T!==h.outsiderId&&E===h.outsiderId&&(m[T]=(m[T]||0)+10)}a(m);const j={...h,revealed:!0,roundResult:{...h.roundResult,outsiderGuessedCorrectly:p,pointsAwarded:m}};y(j),b(f=>[j,...f]),i("results")},[h,o,a]),M=()=>{R(l=>l+1)},Q=()=>{O(l=>l+1)},B=_.useCallback(()=>{R(0),O(0),y(null)},[]),Y=_.useCallback(()=>{u("competitive"),a({})},[u,a]);return{players:o,levels:c,loadingLevels:g,currentRound:h,history:N,startRound:w,playAgain:B,changePlayersAndReset:Y,gameState:x,setGameState:i,currentPlayerTurn:S,nextTurn:M,finishVoting:$,handleOutsiderGuess:q,setupQuestionTurns:G,questionPairs:k,submitVote:(l,p)=>{y(m=>m?{...m,votes:{...m.votes,[l]:p}}:null)},votingPlayerIndex:C,nextVoter:Q,t:n}}const A=({game:o})=>{const{t,players:s,currentPlayerTurn:a,setGameState:u}=o;if(_.useEffect(()=>{a>=s.length&&u("question_intro")},[a,s.length,u]),a>=s.length)return null;const n=s[a];return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:n.name}),e.jsx("p",{className:"text-xl",children:t.givePhoneToPlayer?.replace("{player}",n.name)??`Give the phone to ${n.name}`}),e.jsx("p",{className:"text-xl mt-2",children:t.pressNextToSeeRole??"Press next to see if you are in or out of the story. Don't let anyone else see the screen!"}),e.jsx(v,{onClick:()=>u("role_reveal_player"),className:"mt-8 w-full",children:t.next??"Next"})]})},X=({game:o})=>{const{t,players:s,currentRound:a,currentPlayerTurn:u,nextTurn:n,setGameState:x}=o,i=s[u],c=i.id===a?.outsiderId,d=()=>{n(),x("role_reveal_handoff")};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:i.name}),c?e.jsx("p",{className:"text-xl",children:t.youAreTheOutsider??"You are the Outsider! Try to figure out the story from the others' conversation or convince them to vote for the wrong person!"}):e.jsx("p",{className:"text-xl",children:t.youAreAnInsider?.replace("{secret}",a?.secret??"")??`You are an Insider! The story is **${a?.secret}**. Your goal is to find out who among you is the Outsider.`}),e.jsx(v,{onClick:d,className:"mt-8 w-full",children:t.next??"Next"})]})},Z=({game:o})=>{const{t,setupQuestionTurns:s}=o;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.questionTime??"Question Time"}),e.jsx("p",{className:"text-xl",children:t.questionIntroInstruction??"Each person will ask another person a question related to the topic. Press next to see who asks who."}),e.jsx(v,{onClick:s,className:"mt-8 w-full",children:t.next??"Next"})]})},ee=({game:o})=>{const{t,currentPlayerTurn:s,setGameState:a,nextTurn:u,questionPairs:n}=o;if(!n||n.length===0||s>=n.length)return e.jsx("p",{children:t.loading??"Loading..."});const x=n[s],{asker:i,askee:c}=x,d=()=>{s>=n.length-1?a("voting"):u()};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.questionTime??"Question Time"}),e.jsx("p",{className:"text-xl",children:t.askerToAskeeInstruction?.replace("{asker}",i.name).replace("{askee}",c.name)??`${i.name}, ask ${c.name} a question about the topic! Choose your question carefully so the Outsider doesn't figure it out.`}),e.jsx(v,{onClick:d,className:"mt-8 w-full",children:t.next??"Next"})]})},te=({game:o})=>{const{t,players:s,submitVote:a,finishVoting:u,votingPlayerIndex:n,nextVoter:x}=o,[i,c]=_.useState(!1),d=s[n];if(!d)return u(),e.jsx("p",{children:t.loading??"Loading..."});const g=s.filter(y=>y.id!==d.id),P=y=>{a(d.id,y),c(!0)},h=()=>{x(),c(!1)};if(i){const y=s[n+1],N=y?t.passDeviceAndVote?.replace("{player}",y.name)??`Pass the device to ${y.name} to vote.`:t.submitVote??"Submit Vote";return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:N}),e.jsx(v,{onClick:h,className:"mt-8 w-full",children:t.next??"Next"})]})}return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.yourTurnToVote?.replace("{player}",d.name)??`${d.name}, it's your turn to vote.`}),e.jsx("div",{className:"flex flex-col gap-3 w-full",children:g.map(y=>e.jsx(v,{onClick:()=>P(y.id),variant:"secondary",className:"h-16 text-xl",children:y.name},y.id))})]})},se=({game:o})=>{const{t,currentRound:s,handleOutsiderGuess:a,players:u,setGameState:n}=o,x=u.find(i=>i.id===s?.outsiderId);return!s||!x?(n("results"),null):e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.outsiderGuessTitle?.replace("{player}",x.name)??`${x.name}, what's the story?`}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.words.map(i=>e.jsx(v,{onClick:()=>a(i),className:"w-full h-16 text-lg",children:i},i))})]})},re=({game:o})=>{const{t,currentRound:s,players:a,setGameState:u}=o;if(!s||!s.roundResult)return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:t.loadingResults??"Loading results..."}),e.jsx(v,{onClick:()=>u("round_end"),className:"mt-4",children:t.continue??"Continue"})]});const{votedPlayerId:n,outsiderGuessedCorrectly:x}=s.roundResult,i=a.find(d=>d.id===s.outsiderId);let c="";return n===s.outsiderId?x?c=t.outsiderCaughtButGuessed?.replace("{secret}",s.secret)??`You were caught! But you guessed the story (${s.secret}), well done!`:c=t.insidersWin?.replace("{secret}",s.secret)??`The Insiders win! The story was (${s.secret}).`:c=t.outsiderWins?.replace("{player}",i?.name??"")??`${i?.name} fooled you all! They were the Outsider.`,e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-4xl font-bold mb-6",children:t.results??"Results"}),e.jsx("div",{className:"space-y-2 my-4 w-full text-2xl",children:a.map(d=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:d.name}),e.jsx("span",{children:d.score})]},d.id))}),e.jsx("p",{className:"text-xl my-6",children:c}),e.jsx(v,{onClick:()=>u("round_end"),className:"mt-8 w-full",children:t.next??"Next"})]})},oe=({game:o})=>{const{t,playAgain:s,changePlayersAndReset:a}=o,u=z(),n=()=>{a(),u("/settings/teams/outside-the-story")};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t.roundEndTitle??"End of Round!"}),e.jsx("p",{className:"text-xl mb-8",children:t.roundEndInstruction??"You can continue playing, change players, or go back to the category selection screen."}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(v,{onClick:s,className:"w-full",children:t.continuePlay??"Continue Playing"}),e.jsx(v,{onClick:n,variant:"secondary",className:"w-full",children:t.changePlayers??"Change Players"})]})]})},ie=()=>{const{t:o}=L(),t=U();if(t.loadingLevels||!t.currentRound)return e.jsx(V,{title:o.outsideTheStoryTitle??"Outside the Story",onBack:()=>window.history.back(),levelIndex:0,children:e.jsx("div",{className:"w-full h-full flex items-center justify-center p-4 min-h-[50vh]",children:e.jsx("p",{className:"text-xl",children:o.loading??"Loading..."})})});const s=()=>{switch(t.gameState){case"role_reveal_handoff":return e.jsx(A,{game:t});case"role_reveal_player":return e.jsx(X,{game:t});case"question_intro":return e.jsx(Z,{game:t});case"question_turn":return e.jsx(ee,{game:t});case"voting":return e.jsx(te,{game:t});case"outsider_guess":return e.jsx(se,{game:t});case"results":return e.jsx(re,{game:t});case"round_end":return e.jsx(oe,{game:t});default:return e.jsx(A,{game:t})}};return e.jsx(V,{title:o.outsideTheStoryTitle??"Outside the Story",onBack:()=>window.history.back(),layoutType:"text",levelIndex:0,children:e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 bg-blue-500 text-white rounded-lg min-h-[50vh]",children:s()})})};export{ie as default};
