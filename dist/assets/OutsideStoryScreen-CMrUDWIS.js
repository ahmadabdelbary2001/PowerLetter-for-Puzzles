import{_ as o,r as y,j as e,a as E,c as Q,u as W}from"./index-Ch-mORm0.js";import{B as H,u as F,a as K,G as z}from"./GameScreen-DksA4iBX.js";class J extends H{getGameId(){return"outside-the-story"}getModulePath(t,s){return`/src/data/${t}/outside-the-story/${s}.json`}validateLevel(){return null}async loadLevels(t){const{language:s,categories:d}=t,l=Object.assign({"/src/data/ar/outside-the-story/animals.json":()=>o(()=>import("./animals-BD_uC3F6.js"),[]),"/src/data/ar/outside-the-story/anime.json":()=>o(()=>import("./anime-X9XTb-jh.js"),[]),"/src/data/ar/outside-the-story/cars.json":()=>o(()=>import("./cars-LFoQ5kcr.js"),[]),"/src/data/ar/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-9ln4fVtF.js"),[]),"/src/data/ar/outside-the-story/characters.json":()=>o(()=>import("./characters-BClrgWDD.js"),[]),"/src/data/ar/outside-the-story/clothes.json":()=>o(()=>import("./clothes-DZukcyjc.js"),[]),"/src/data/ar/outside-the-story/drinks.json":()=>o(()=>import("./drinks-DWTisQdZ.js"),[]),"/src/data/ar/outside-the-story/foods.json":()=>o(()=>import("./foods-BPEl4jwc.js"),[]),"/src/data/ar/outside-the-story/football.json":()=>o(()=>import("./football-BkDTW0je.js"),[]),"/src/data/ar/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-CWZ59ral.js"),[]),"/src/data/ar/outside-the-story/gamers.json":()=>o(()=>import("./gamers-DU27ka0Y.js"),[]),"/src/data/ar/outside-the-story/geography.json":()=>o(()=>import("./geography-Bmt1Mp9F.js"),[]),"/src/data/ar/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-CvncURYW.js"),[]),"/src/data/ar/outside-the-story/science.json":()=>o(()=>import("./science-C1rxd0mO.js"),[]),"/src/data/ar/outside-the-story/series.json":()=>o(()=>import("./series-DgCSJJru.js"),[]),"/src/data/ar/outside-the-story/spy.json":()=>o(()=>import("./spy-CTUdze8o.js"),[]),"/src/data/ar/outside-the-story/sweets.json":()=>o(()=>import("./sweets-0_2hbNMS.js"),[]),"/src/data/en/outside-the-story/animals.json":()=>o(()=>import("./animals-D78oH89-.js"),[]),"/src/data/en/outside-the-story/anime.json":()=>o(()=>import("./anime-DXIlEidq.js"),[]),"/src/data/en/outside-the-story/cars.json":()=>o(()=>import("./cars-Cw03Nxyo.js"),[]),"/src/data/en/outside-the-story/cartoons.json":()=>o(()=>import("./cartoons-DwVIQVvA.js"),[]),"/src/data/en/outside-the-story/characters.json":()=>o(()=>import("./characters-Dl2vwTPn.js"),[]),"/src/data/en/outside-the-story/clothes.json":()=>o(()=>import("./clothes-BiLKpCWj.js"),[]),"/src/data/en/outside-the-story/drinks.json":()=>o(()=>import("./drinks-CP1Emjyy.js"),[]),"/src/data/en/outside-the-story/foods.json":()=>o(()=>import("./foods-BKBSmJG2.js"),[]),"/src/data/en/outside-the-story/football.json":()=>o(()=>import("./football-B8eU_HgW.js"),[]),"/src/data/en/outside-the-story/fruits-and-vegetables.json":()=>o(()=>import("./fruits-and-vegetables-B5narx4J.js"),[]),"/src/data/en/outside-the-story/gamers.json":()=>o(()=>import("./gamers-Dm5Tu0YA.js"),[]),"/src/data/en/outside-the-story/geography.json":()=>o(()=>import("./geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/k-pop.json":()=>o(()=>import("./k-pop-BnHY6_tE.js"),[]),"/src/data/en/outside-the-story/science.json":()=>o(()=>import("./science-DF1sazzy.js"),[]),"/src/data/en/outside-the-story/series.json":()=>o(()=>import("./series-dqakDLa9.js"),[]),"/src/data/en/outside-the-story/spy.json":()=>o(()=>import("./spy-DLpfZG_H.js"),[]),"/src/data/en/outside-the-story/sweets.json":()=>o(()=>import("./sweets-DDZ5JqsI.js"),[])}),r=[];for(const c of d){const x=`/src/data/${s}/outside-the-story/${c}.json`,_=l[x];if(!_){console.warn(`OutsideStoryGameEngine: Could not find data file at path: ${x}`);continue}try{const i=await _(),a=Array.isArray(i.default?.words)?i.default.words.map(String):[],v=a.length>0?a[0]:"";r.push({id:`${s}-${c}`,language:s,category:c,words:a,solution:v,meta:i.default?.meta??{}})}catch(i){console.error(`OutsideStoryGameEngine: Failed to load or parse ${x}`,i)}}return r.length===0?[this.getErrorLevel()]:r}getErrorLevel(){return{id:"error",language:"en",category:"general",words:["ERROR"],solution:"ERROR"}}}const U=new J;function X(){const n=F({engine:U,gameId:"outsideStory"}),{levels:t,loading:s,gameModeState:d,setNotification:l}=n,{teams:r,resetScores:c,setGameMode:x}=d,[_,i]=y.useState("role_reveal_handoff"),[a,v]=y.useState(null),[f,m]=y.useState([]),[R,I]=y.useState(0),[A,S]=y.useState([]),[L,N]=y.useState(0),T=y.useCallback(u=>{const j=t.find(P=>P.category===u);if(!j||j.words.length<8){l({messageKey:"notEnoughWords",type:"error"});return}if(r.length<3){l({messageKey:"min3Players",type:"error"});return}const p=[...j.words].sort(()=>.5-Math.random()).slice(0,8),g=p[0],$=Math.floor(Math.random()*r.length),O=r[$].id,M=r.map(P=>P.id).filter(P=>P!==O),B={id:`${Date.now()}`,category:u,secret:g,words:p.sort(),outsiderId:O,insiders:M,votes:{},revealed:!1};v(B),I(0),i("role_reveal_handoff")},[t,r,l]);y.useEffect(()=>{s||t.length===0||a||T(t[0].category)},[s,t,a,T]);const b=y.useCallback(()=>{if(r.length<2)return;const u=[...r].sort(()=>Math.random()-.5),j=[];for(let h=0;h<u.length;h++)j.push({asker:u[h],askee:u[(h+1)%u.length]});S(j),I(0),i("question_turn")},[r]),w=y.useCallback(()=>{if(!a)return;const u={};for(const p in a.votes)if(parseInt(p,10)!==a.outsiderId){const g=a.votes[p];u[g]=(u[g]||0)+1}let j=0,h=-1;for(const p in u)u[p]>j&&(j=u[p],h=parseInt(p,10));v(p=>p?{...p,roundResult:{votedPlayerId:h,pointsAwarded:{}}}:null),i("outsider_guess")},[a]),D=y.useCallback(u=>{if(!a)return;const j=u===a.secret,h={};r.forEach(g=>h[g.id]=0),j&&(h[a.outsiderId]=10);for(const g in a.votes)parseInt(g,10)!==a.outsiderId&&a.votes[g]===a.outsiderId&&(h[parseInt(g,10)]=(h[parseInt(g,10)]||0)+10);c(h);const p={...a,revealed:!0,roundResult:{...a.roundResult,outsiderGuessedCorrectly:j,pointsAwarded:h}};v(p),m(g=>[p,...g]),i("results")},[a,r,c]),C=()=>I(u=>u+1),k=()=>N(u=>u+1),G=y.useCallback(()=>{I(0),N(0),v(null)},[]),q=y.useCallback(()=>{x("competitive"),c({})},[x,c]);return{...n,players:r,levels:t,loadingLevels:s,currentRound:a,history:f,startRound:T,playAgain:G,changePlayersAndReset:q,gameState:_,setGameState:i,currentPlayerTurn:R,nextTurn:C,finishVoting:w,handleOutsiderGuess:D,setupQuestionTurns:b,questionPairs:A,submitVote:(u,j)=>{v(h=>h?{...h,votes:{...h.votes,[u]:j}}:null)},votingPlayerIndex:L,nextVoter:k}}const Y=({children:n,...t})=>e.jsx(K,{...t,layoutType:"text",levelIndex:0,children:e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 bg-blue-500 text-white rounded-lg min-h-[50vh]",children:n})}),V=({game:n})=>{const{t,players:s,currentPlayerTurn:d,setGameState:l}=n;if(y.useEffect(()=>{d>=s.length&&l("question_intro")},[d,s.length,l]),d>=s.length)return null;const r=s[d];return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:r.name}),e.jsx("p",{className:"text-xl",children:t("givePhoneToPlayer",{ns:"outside_the_story"})?.replace("{player}",r.name)}),e.jsx("p",{className:"text-xl mt-2",children:t("pressNextToSeeRole",{ns:"outside_the_story"})}),e.jsx(E,{onClick:()=>l("role_reveal_player"),className:"mt-8 w-full",children:t("next")})]})},Z=({game:n})=>{const{t,players:s,currentRound:d,currentPlayerTurn:l,nextTurn:r,setGameState:c}=n,x=s[l],_=x.id===d?.outsiderId,i=()=>{r(),c("role_reveal_handoff")},a=d?.category??"",v=t[a]??a;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:x.name}),_?e.jsx("p",{className:"text-xl",children:t("youAreTheOutsider",{ns:"outside_the_story"})?.replace("{category}",v)}):e.jsx("p",{className:"text-xl",children:t("youAreAnInsider",{ns:"outside_the_story"})?.replace("{secret}",d?.secret??"")}),e.jsx(E,{onClick:i,className:"mt-8 w-full",children:t("next")})]})},ee=({game:n})=>{const{t,setupQuestionTurns:s}=n;return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t("questionTime",{ns:"outside_the_story"})}),e.jsx("p",{className:"text-xl",children:t("questionIntroInstruction",{ns:"outside_the_story"})}),e.jsx(E,{onClick:s,className:"mt-8 w-full",children:t("next")})]})},te=({game:n})=>{const{t,currentPlayerTurn:s,setGameState:d,nextTurn:l,questionPairs:r}=n;if(!r||r.length===0||s>=r.length)return e.jsx("p",{children:t("loading")});const c=r[s],{asker:x,askee:_}=c,i=()=>{s>=r.length-1?d("voting"):l()};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t("questionTime",{ns:"outside_the_story"})}),e.jsx("p",{className:"text-xl",children:t("askerToAskeeInstruction",{ns:"outside_the_story"})?.replace("{asker}",x.name).replace("{askee}",_.name)}),e.jsx(E,{onClick:i,className:"mt-8 w-full",children:t("next")})]})},se=({game:n})=>{const{t,players:s,submitVote:d,finishVoting:l,votingPlayerIndex:r,nextVoter:c}=n,[x,_]=y.useState(!1),i=s[r];if(!i)return l(),e.jsx("p",{children:t("loading")});const a=s.filter(m=>m.id!==i.id),v=m=>{d(i.id,m),_(!0)},f=()=>{c(),_(!1)};if(x){const m=s[r+1],R=m?t("passDeviceAndVote",{ns:"outside_the_story"})?.replace("{player}",m.name):t("submitVote",{ns:"outside_the_story"});return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:R}),e.jsx(E,{onClick:f,className:"mt-8 w-full",children:t("next")})]})}return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t("yourTurnToVote",{ns:"outside_the_story"})?.replace("{player}",i.name)}),e.jsx("div",{className:"flex flex-col gap-3 w-full",children:a.map(m=>e.jsx(E,{onClick:()=>v(m.id),variant:"secondary",className:"h-16 text-xl",children:m.name},m.id))})]})},re=({game:n})=>{const{t,currentRound:s,handleOutsiderGuess:d,players:l,setGameState:r}=n,[c,x]=y.useState(null),[_,i]=y.useState(null),a=l.find(f=>f.id===s?.outsiderId);if(!s||!a)return r("results"),null;const v=f=>{if(c)return;x(f);const m=f===s.secret;i(m?"correct":"incorrect"),setTimeout(()=>{d(f)},1500)};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t("outsiderGuessTitle",{ns:"outside_the_story"})?.replace("{player}",a.name)}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.words.map(f=>{const m=c===f,R=_==="correct",I=_==="incorrect";return e.jsx(E,{onClick:()=>v(f),disabled:!!c,className:Q("w-full h-16 text-lg transition-all duration-300",m&&R&&"bg-green-500 hover:bg-green-600 ring-4 ring-white",m&&I&&"bg-red-500 hover:bg-red-600 ring-4 ring-white",!m&&c&&"opacity-50"),children:f},f)})})]})},oe=({game:n})=>{const{t,currentRound:s,players:d,setGameState:l}=n;if(!s||!s.roundResult)return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:t("loadingResults",{ns:"outside_the_story"})}),e.jsx(E,{onClick:()=>l("round_end"),className:"mt-4",children:t("continue")})]});const{votedPlayerId:r,outsiderGuessedCorrectly:c}=s.roundResult,x=d.find(i=>i.id===s.outsiderId);let _="";return r===s.outsiderId?c?_=t("outsiderCaughtButGuessed",{ns:"outside_the_story"})?.replace("{secret}",s.secret):_=t("insidersWin",{ns:"outside_the_story"})?.replace("{secret}",s.secret):_=t("outsiderWins",{ns:"outside_the_story"})?.replace("{player}",x?.name??""),e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-4xl font-bold mb-6",children:t("results",{ns:"outside_the_story"})}),e.jsx("div",{className:"space-y-2 my-4 w-full text-2xl",children:d.map(i=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:i.name}),e.jsx("span",{children:i.score})]},i.id))}),e.jsx("p",{className:"text-xl my-6",children:_}),e.jsx(E,{onClick:()=>l("round_end"),className:"mt-8 w-full",children:t("next")})]})},ne=({game:n})=>{const{t,playAgain:s,changePlayersAndReset:d}=n,l=W(),r=()=>{d(),l("/settings/teams/outside-the-story")};return e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:t("roundEndTitle",{ns:"outside_the_story"})}),e.jsx("p",{className:"text-xl mb-8",children:t("roundEndInstruction",{ns:"outside_the_story"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(E,{onClick:s,className:"w-full",children:t("continuePlay",{ns:"outside_the_story"})}),e.jsx(E,{onClick:r,variant:"secondary",className:"w-full",children:t("changePlayers",{ns:"outside_the_story"})})]})]})},ae=n=>{const{notification:t,onClearNotification:s,handleBack:d,t:l,instructions:r}=n,c=()=>{switch(n.gameState){case"role_reveal_handoff":return e.jsx(V,{game:n});case"role_reveal_player":return e.jsx(Z,{game:n});case"question_intro":return e.jsx(ee,{game:n});case"question_turn":return e.jsx(te,{game:n});case"voting":return e.jsx(se,{game:n});case"outsider_guess":return e.jsx(re,{game:n});case"results":return e.jsx(oe,{game:n});case"round_end":return e.jsx(ne,{game:n});default:return e.jsx(V,{game:n})}};return e.jsx(Y,{title:l("outsideTheStoryTitle",{ns:"games"}),onBack:d,instructions:r,notification:t,onClearNotification:s,children:c()})},le=()=>e.jsx(z,{useGameHook:X,GameComponent:ae});export{le as default};
