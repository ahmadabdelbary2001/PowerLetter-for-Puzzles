import{_ as r,u as $e,a as Ce,b as Re,c as ye,r as w,j as v,f as se}from"./index-DSv16vA1.js";import{s as De,u as Oe,N as Ve}from"./Notification-YkDueqwU.js";import{G as Me}from"./GameControls-D165LPeM.js";import{u as ke,G as Se}from"./useInstructions-CdIQNVTe.js";import"./GameButton-v5eY_q5k.js";import"./circle-check-big-C7WWpiDY.js";function Ne(o,a,c=70,l=50){if(a<=0)return`hsl(0, ${c}%, ${l}%)`;const y=Math.round(o*360/a)%360,b=l>50?l*.9:l*1.1;return`hsl(${y}, ${c}%, ${b}%)`}class Fe{async loadLevels(a){const{language:c,difficulty:l}=a;if(!l)return[];try{const y=`/src/data/${c}/letter-flow/${c}-flow-${l}.json`,P=Object.assign({"/src/data/ar/clue/animals/ar-clue-animals-easy.json":()=>r(()=>import("./ar-clue-animals-easy-B_GJKLA_.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-hard.json":()=>r(()=>import("./ar-clue-animals-hard-7EfMbXs4.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-medium.json":()=>r(()=>import("./ar-clue-animals-medium-Bcn1oCUk.js"),[]),"/src/data/ar/clue/animals/ar-clue-animals-words.json":()=>r(()=>import("./ar-clue-animals-words-DxH5pZeF.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-easy.json":()=>r(()=>import("./ar-clue-geography-easy-B_kcdeCx.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-hard.json":()=>r(()=>import("./ar-clue-geography-hard-BCuCMNGp.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-medium.json":()=>r(()=>import("./ar-clue-geography-medium-CkoNY3Du.js"),[]),"/src/data/ar/clue/geography/ar-clue-geography-words.json":()=>r(()=>import("./ar-clue-geography-words-C7oqRjv9.js"),[]),"/src/data/ar/clue/science/ar-clue-science-easy.json":()=>r(()=>import("./ar-clue-science-easy-f07zg_lU.js"),[]),"/src/data/ar/clue/science/ar-clue-science-hard.json":()=>r(()=>import("./ar-clue-science-hard-CV32qLEY.js"),[]),"/src/data/ar/clue/science/ar-clue-science-medium.json":()=>r(()=>import("./ar-clue-science-medium-BtIrOjNp.js"),[]),"/src/data/ar/clue/science/ar-clue-science-words.json":()=>r(()=>import("./ar-clue-science-words-DpIQpR0-.js"),[]),"/src/data/ar/formation/ar-formation-easy.json":()=>r(()=>import("./ar-formation-easy-CuHzQLY1.js"),[]),"/src/data/ar/formation/ar-formation-hard.json":()=>r(()=>import("./ar-formation-hard-CRxFgu7h.js"),[]),"/src/data/ar/image-clue/animals/data.json":()=>r(()=>import("./data-USJTiWy0.js"),[]),"/src/data/ar/image-clue/fruits/data.json":()=>r(()=>import("./data-CenmuYLK.js"),[]),"/src/data/ar/image-clue/shapes/data.json":()=>r(()=>import("./data-B126H-NP.js"),[]),"/src/data/ar/letter-flow/ar-flow-easy.json":()=>r(()=>import("./ar-flow-easy-C68xgLTr.js"),[]),"/src/data/ar/letter-flow/ar-flow-medium.json":()=>r(()=>import("./ar-flow-medium-BL27Zp8Y.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-animals.json":()=>r(()=>import("./ar-outside-the-story-animals-0m0m6kXG.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-fruits.json":()=>r(()=>import("./ar-outside-the-story-fruits-zTkTe7Gg.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-geography.json":()=>r(()=>import("./ar-outside-the-story-geography-CVgh5HaL.js"),[]),"/src/data/ar/outside-the-story/ar-outside-the-story-science.json":()=>r(()=>import("./ar-outside-the-story-science-D4AkFF1_.js"),[]),"/src/data/ar/picture-choice/animals/data.json":()=>r(()=>import("./data-6hZ_2-dK.js"),[]),"/src/data/ar/word-choice/animals/data.json":()=>r(()=>import("./data-Bij5nysW.js"),[]),"/src/data/en/clue/animals/en-clue-animals-easy.json":()=>r(()=>import("./en-clue-animals-easy-vc2CgBiI.js"),[]),"/src/data/en/clue/animals/en-clue-animals-hard.json":()=>r(()=>import("./en-clue-animals-hard-BmQiyFGH.js"),[]),"/src/data/en/clue/animals/en-clue-animals-medium.json":()=>r(()=>import("./en-clue-animals-medium-CDppU-oU.js"),[]),"/src/data/en/clue/animals/en-clue-animals-words.json":()=>r(()=>import("./en-clue-animals-words-OyMRQ2OB.js"),[]),"/src/data/en/clue/geography/en-clue-geography-easy.json":()=>r(()=>import("./en-clue-geography-easy-v49lXgS1.js"),[]),"/src/data/en/clue/geography/en-clue-geography-hard.json":()=>r(()=>import("./en-clue-geography-hard-Hc9ZYG1D.js"),[]),"/src/data/en/clue/geography/en-clue-geography-medium.json":()=>r(()=>import("./en-clue-geography-medium-Yt4_5ZKV.js"),[]),"/src/data/en/clue/geography/en-clue-geography-words.json":()=>r(()=>import("./en-clue-geography-words-BJFrdNPX.js"),[]),"/src/data/en/clue/science/en-clue-science-easy.json":()=>r(()=>import("./en-clue-science-easy-CXDUIzZm.js"),[]),"/src/data/en/clue/science/en-clue-science-hard.json":()=>r(()=>import("./en-clue-science-hard-Dqcig8Ht.js"),[]),"/src/data/en/clue/science/en-clue-science-medium.json":()=>r(()=>import("./en-clue-science-medium-Dm_81XWt.js"),[]),"/src/data/en/clue/science/en-clue-science-words.json":()=>r(()=>import("./en-clue-science-words-BdiwMlAj.js"),[]),"/src/data/en/formation/en-formation-easy.json":()=>r(()=>import("./en-formation-easy-CqPS8TrH.js"),[]),"/src/data/en/image-clue/animals/data.json":()=>r(()=>import("./data-BYo_61tt.js"),[]),"/src/data/en/image-clue/fruits/data.json":()=>r(()=>import("./data-OxJ4m8-5.js"),[]),"/src/data/en/image-clue/shapes/data.json":()=>r(()=>import("./data-Bu1Ld6Qx.js"),[]),"/src/data/en/letter-flow/en-flow-easy.json":()=>r(()=>import("./en-flow-easy-DqbTaQjR.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-animals.json":()=>r(()=>import("./en-outside-the-story-animals-QFa7I_eA.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-fruits.json":()=>r(()=>import("./en-outside-the-story-fruits--LJxQFSa.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-geography.json":()=>r(()=>import("./en-outside-the-story-geography-Dw2uVeLE.js"),[]),"/src/data/en/outside-the-story/en-outside-the-story-science.json":()=>r(()=>import("./en-outside-the-story-science-DF1sazzy.js"),[]),"/src/data/en/picture-choice/animals/data.json":()=>r(()=>import("./data-CtXqoHRL.js"),[]),"/src/data/en/word-choice/animals/data.json":()=>r(()=>import("./data-BDxquZu-.js"),[])})[y];return P?((await P()).default?.levels||[]).map(i=>{if(typeof i=="object"&&i!==null&&"id"in i&&"solutionWord"in i&&"gridSize"in i&&"endpoints"in i){const{width:A,height:f}=i.gridSize,O=[];for(let m=0;m<f;m++)for(let e=0;e<A;e++)O.push({x:e,y:m,letter:"",isUsed:!1});const S=i.endpoints,V=Array.from(new Set(S.map(m=>m.letter))),$=new Map;V.forEach((m,e)=>{$.set(m,Ne(e,V.length,72,48))}),S.forEach(m=>{const e=m.y*A+m.x,s=$.get(m.letter);e<O.length&&(O[e]={x:m.x,y:m.y,letter:m.letter,isUsed:!1,color:s})});const g=i;return{id:String(g.id),difficulty:l,words:[g.solutionWord],board:O,solution:g.solutionWord,endpoints:g.endpoints.map(m=>({...m,color:$.get(m.letter)}))}}return null}).filter(i=>i!==null):[]}catch(y){return console.error(`LetterFlowGameEngine: Failed to load levels for ${c}/${l}.`,y),[{id:"error",difficulty:"easy",words:[],board:[],solution:"",endpoints:[]}]}}generateBoard(a,c,l,y){if(!y)return[];const b=De(y.split("")),P=Math.ceil(Math.sqrt(b.length)),B=[];for(let k=0;k<P;k++)for(let i=0;i<P;i++){const A=k*P+i;A<b.length&&B.push({x:i,y:k,letter:b[A],isUsed:!1})}return B}}const pe=new Fe,ue=24;function Ue(o,a=ue,c=68,l=48){return`hsl(${Math.round(o*360/a)%360}, ${c}%, ${l}%)`}function ge(o){if(!o)return;let a=0;const c=o.toUpperCase();for(let y=0;y<c.length;y++)a=(a<<5)-a+c.charCodeAt(y),a|=0;const l=Math.abs(a)%ue;return Ue(l,ue)}function Be(){const o=$e(),a=Ce(),{language:c,categories:l,difficulty:y,gameMode:b,teams:P,currentTeam:B,consumeHint:k}=Re(),{t:i}=ye(),{loading:A,currentLevel:f,currentLevelIndex:O,nextLevel:S}=Oe(pe,{language:c,categories:l,difficulty:y}),[V,$]=w.useState([]),[g,m]=w.useState([]),[e,s]=w.useState([]),[R,I]=w.useState(null),[p,u]=w.useState(null),[E,M]=w.useState("playing");w.useEffect(()=>{if(f){if(f.board&&f.board.length>0&&f.board.some(t=>t.letter))$(f.board.map(t=>({...t})));else{const t=pe.generateBoard("",f.difficulty,c,f.board.map(n=>n.letter).join(""));$(t)}s([]),m([]),u(null),M("playing")}},[f,c]);const x=w.useMemo(()=>[...new Set(f?.endpoints.map(t=>t.letter)||[])],[f]),D=w.useMemo(()=>{const t=new Map;return f?.endpoints.forEach(n=>t.set(`${n.x}-${n.y}`,n.color)),t},[f]),q=w.useCallback(t=>{if(t)return ge(t)},[]),H=w.useCallback(t=>f?f.endpoints.some(n=>n.x===t.x&&n.y===t.y&&n.letter===t.letter):!1,[f]),fe=w.useCallback((t,n)=>{const _=Math.abs(t.x-n.x),j=Math.abs(t.y-n.y);return _===1&&j===0||_===0&&j===1},[]),me=w.useCallback(t=>{if(t.length<2)return!0;for(let n=1;n<t.length;n++)if(!fe(t[n-1],t[n]))return!1;return!0},[fe]),_e=w.useCallback((t,n,_)=>{if(!t.letter){if(t.isUsed){if(_){const j=e.find(N=>N.word===_);if(j&&j.cells.some(N=>N.x===t.x&&N.y===t.y))return!1}return!0}return!1}return!(n&&t.x===n.x&&t.y===n.y||_&&t.letter===_&&H(t))},[e,H]),oe=w.useCallback(t=>e.length===0?[]:e.filter(n=>n.cells.some(_=>t.some(j=>j.x===_.x&&j.y===_.y))),[e]),C=w.useCallback((t,n=1200)=>{I(t),n>0&&setTimeout(()=>I(null),n)},[]),ve=w.useCallback(t=>{if(!H(t))return;const n=e.find(_=>_.word===t.letter);n&&(s(_=>_.filter(j=>j.word!==t.letter)),$(_=>_.map(j=>{const N=n.cells.some(F=>F.x===j.x&&F.y===j.y),G=D.get(`${j.x}-${j.y}`);return N?{...j,isUsed:!1,color:G??void 0}:j})),C(`Removed connection for ${t.letter}`,900)),u(t.letter),m([t])},[e,H,C,D]),Ee=w.useCallback(t=>{if(!p||g.length===0)return;const n=g[0]||null;if(_e(t,n,p)||!(t.letter===p||t.letter===""))return;const _=g[g.length-1];if(_&&_.x===t.x&&_.y===t.y)return;const j=Math.abs(t.x-_.x),N=Math.abs(t.y-_.y);if(j===1&&N===1||j>1||N>1)return;const G=g.findIndex(X=>X.x===t.x&&X.y===t.y);if(G!==-1){m(X=>X.slice(0,G+1));return}if(t.isUsed)return;const F=[...g,t];if(!me(F))return;if(H(t)&&!(g.length>0&&g[0].x===t.x&&g[0].y===t.y)&&t.letter===p){const X=oe(F);X.length>0&&(s(L=>L.filter(T=>!X.includes(T))),$(L=>L.map(T=>{const K=X.some(Q=>Q.cells.some(Z=>Z.x===T.x&&Z.y===T.y)),te=D.get(`${T.x}-${T.y}`);return K?{...T,isUsed:!1,color:te??void 0}:T})),C("Existing connection(s) removed by new connection",1100));const ne=V.find(L=>L.x===F[0].x&&L.y===F[0].y)?.color||q(F[0].letter);$(L=>L.map(T=>{const K=F.some(Q=>Q.x===T.x&&Q.y===T.y),te=D.get(`${T.x}-${T.y}`);return K?{...T,isUsed:!0,color:te??ne}:T}));const ie={word:p,cells:F.map(L=>{const T=V.find(K=>K.x===L.x&&K.y===L.y);return{...L,color:T&&T.color||ne}}),startIndex:0};s(L=>[...L.filter(K=>K.word!==p),ie]),C(`Connected ${p}`,900),u(null),m([]);const le=[...e.map(L=>L.word),p].filter(Boolean),ee=Array.from(new Set(le));x.every(L=>ee.includes(L))&&(C(i.congrats,2e3),b==="competitive"?setTimeout(()=>S(),2e3):M("won"))}else m(F)},[p,g,_e,H,me,oe,V,q,e,x,S,i,C,D,b]),we=w.useCallback(()=>{if(g.length>0){const t=g[g.length-1];H(t)&&!(g.length>1&&g[0].x===t.x&&g[0].y===t.y)&&t.letter===p||(u(null),m([]),C("Path must connect two endpoints!",1200))}},[g,H,p,C]),je=w.useCallback(()=>{if(!f||e.length>=f.endpoints.length/2)return;if(b==="competitive"&&!k(P[B].id)){C(i.noHintsLeft,2e3);return}const t=x.filter(d=>!e.some(h=>h.word===d));if(t.length===0)return;const n=t[0],_=f.endpoints.filter(d=>d.letter===n);if(_.length<2){C(`No endpoints found for ${n}`,1500);return}const j=_[0],N=_[1],G=new Map;V.forEach(d=>G.set(`${d.x}-${d.y}`,d));const F=V.map(d=>d.x),ae=V.map(d=>d.y),X=Math.min(...F),ne=Math.max(...F),ie=Math.min(...ae),le=Math.max(...ae),ee=`${j.x}-${j.y}`,ce=`${N.x}-${N.y}`,L=[ee],T=new Set([ee]),K=new Map;K.set(ee,null);const te=(d,h)=>{const U=`${d}-${h}`,Y=G.get(U);return Y?!Y.letter||Y.letter===n:!1},Q=d=>{const[h,U]=d.split("-").map(z=>parseInt(z,10));return[[h+1,U],[h-1,U],[h,U+1],[h,U-1]].filter(([z,J])=>z>=X&&z<=ne&&J>=ie&&J<=le).map(([z,J])=>`${z}-${J}`)};let Z=!1;for(;L.length>0&&!Z;){const d=L.shift();if(d===ce){Z=!0;break}for(const h of Q(d)){if(T.has(h))continue;const[U,Y]=h.split("-").map(z=>parseInt(z,10));te(U,Y)&&(T.add(h),K.set(h,d),L.push(h))}}if(!Z){C(`No path found for ${n}`,1600);return}const W=[];let re=ce;for(;re;){const d=G.get(re);if(!d)break;W.push({...d}),re=K.get(re)??null}W.reverse();const de=oe(W);de.length>0&&(s(d=>d.filter(h=>!de.includes(h))),$(d=>d.map(h=>{const U=de.some(z=>z.cells.some(J=>J.x===h.x&&J.y===h.y)),Y=D.get(`${h.x}-${h.y}`);return U?{...h,isUsed:!1,color:Y??void 0}:h})),C("Existing connection(s) removed by hint connection",1100));const he=G.get(`${W[0].x}-${W[0].y}`)?.color||q(W[0].letter);$(d=>d.map(h=>{const U=W.some(z=>z.x===h.x&&z.y===h.y),Y=D.get(`${h.x}-${h.y}`);return U?{...h,isUsed:!0,color:Y??he}:h}));const Te={word:n,cells:W.map(d=>{const h=G.get(`${d.x}-${d.y}`);return{...d,color:h&&h.color||he}}),startIndex:0};s(d=>[...d.filter(U=>U.word!==n),Te]),C(`Hint: Connected ${n}`,900),u(null),m([]);const Pe=[...e.map(d=>d.word),n].filter(Boolean),Ae=Array.from(new Set(Pe));x.every(d=>Ae.includes(d))&&(C(i.congrats,2e3),b==="competitive"?setTimeout(()=>S(),2e3):M("won"))},[f,V,e,x,D,q,oe,C,b,P,B,k,i,S]),be=w.useCallback(()=>{if(e.length===0)return;const t=e[e.length-1];s(n=>n.slice(0,-1)),$(n=>n.map(_=>{if(!t.cells.some(G=>G.x===_.x&&G.y===_.y))return _;const N=D.get(`${_.x}-${_.y}`);return{..._,isUsed:!1,color:N??void 0}})),m([]),u(null),C(`Undo: Removed connection for ${t.word}`),E==="won"&&M("playing")},[e,C,D,E]),Ie=w.useCallback(()=>{s([]),$(t=>t.map(n=>{const _=D.get(`${n.x}-${n.y}`);return{...n,isUsed:!1,color:_}})),m([]),u(null),M("playing"),C("Game reset - all connections removed")},[C,D]),Le=w.useCallback(()=>{o(b==="competitive"?`/team-config/${a.gameType}`:`/game-mode/${a.gameType}`)},[o,a.gameType,b]);return{loading:A,currentLevel:f,currentLevelIndex:O,board:V,selectedPath:g,foundWords:e,notification:R,gameState:E,isChecking:!1,activeLetter:p,isDrawing:!!p,handleBack:Le,handleMouseDown:ve,handleMouseEnter:Ee,handleMouseUp:we,clearSelection:()=>{m([]),u(null)},onHint:je,onUndo:be,onReset:Ie}}function Ge({letter:o,x:a,y:c,isSelected:l=!1,isFound:y=!1,isActive:b=!1,onMouseDown:P,onMouseEnter:B,onMouseUp:k,disabled:i=!1,className:A,connectionDirections:f=[],connectionColor:O,cellColor:S}){const V=w.useRef(null),$=E=>{i||(E.target?.setPointerCapture?.(E.pointerId),P?.({x:a,y:c,letter:o}),E.preventDefault())},g=E=>{if(i)return;const x=document.elementFromPoint(E.clientX,E.clientY)?.closest?.("[data-cell-x]");if(x){const D=parseInt(x.getAttribute("data-cell-x")||"0",10),q=parseInt(x.getAttribute("data-cell-y")||"0",10);B?.({x:D,y:q,letter:x.textContent?.trim()||""})}},m=E=>{try{E.target?.releasePointerCapture?.(E.pointerId)}catch(M){console.debug("releasePointerCapture failed",M)}k?.()},e=E=>{if(i)return;E.preventDefault();const M=E.touches[0],x=document.elementFromPoint(M.clientX,M.clientY);if(x&&x.getAttribute("data-cell-x")&&x.getAttribute("data-cell-y")){const D=parseInt(x.getAttribute("data-cell-x")||"0"),q=parseInt(x.getAttribute("data-cell-y")||"0"),H=x.textContent?.trim()||"";P?.({x:D,y:q,letter:H})}},s=E=>{if(i)return;E.preventDefault();const M=E.touches[0],x=document.elementFromPoint(M.clientX,M.clientY);if(x&&x.getAttribute("data-cell-x")&&x.getAttribute("data-cell-y")){const D=parseInt(x.getAttribute("data-cell-x")||"0"),q=parseInt(x.getAttribute("data-cell-y")||"0"),H=x.textContent?.trim()||"";B?.({x:D,y:q,letter:H})}},R=E=>{i||(E.preventDefault(),k?.())},I=E=>{i||(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),P?.({x:a,y:c,letter:o}))},p=56,u=O??S??void 0;return v.jsxs("div",{ref:V,role:"button",tabIndex:i?-1:0,"aria-disabled":i,"aria-pressed":l||void 0,"data-cell-x":a,"data-cell-y":c,onPointerDown:$,onPointerMove:g,onPointerUp:m,onTouchStart:e,onTouchMove:s,onTouchEnd:R,onKeyDown:I,className:se("aspect-square flex items-center justify-center rounded-md text-xl font-bold select-none relative transition-all duration-150",{"bg-gray-50 dark:bg-gray-800":!l&&!y&&!b,"cursor-not-allowed opacity-70":i,"text-gray-900 dark:text-gray-100":!l&&!y&&!b&&!u},A),children:[f.includes("top")&&v.jsx("div",{"aria-hidden":!0,className:"absolute top-0 left-1/2 transform -translate-x-1/2",style:{width:`${Math.max(6,p*.08)}%`,height:"40%",background:O,borderRadius:4,zIndex:0}}),f.includes("bottom")&&v.jsx("div",{"aria-hidden":!0,className:"absolute bottom-0 left-1/2 transform -translate-x-1/2",style:{width:`${Math.max(6,p*.08)}%`,height:"40%",background:O,borderRadius:4,zIndex:0}}),f.includes("left")&&v.jsx("div",{"aria-hidden":!0,className:"absolute left-0 top-1/2 transform -translate-y-1/2",style:{height:`${Math.max(6,p*.08)}%`,width:"40%",background:O,borderRadius:4,zIndex:0}}),f.includes("right")&&v.jsx("div",{"aria-hidden":!0,className:"absolute right-0 top-1/2 transform -translate-y-1/2",style:{height:`${Math.max(6,p*.08)}%`,width:"40%",background:O,borderRadius:4,zIndex:0}}),v.jsx("div",{className:"flex items-center justify-center rounded-full z-10",style:{width:`${p}%`,height:`${p}%`,background:u??"#ffffff",boxShadow:u?"0 2px 8px rgba(0,0,0,0.12)":void 0,border:u?"none":"1px solid rgba(0,0,0,0.06)"},children:o?v.jsx("span",{className:"text-sm font-bold",style:{color:u||l||y||b?"#fff":"#111"},children:o}):null})]})}function xe(o){return ge(o)}function ze({cells:o,selectedPath:a,foundWords:c,activeLetter:l,onMouseDown:y,onMouseEnter:b,onMouseUp:P,className:B,dir:k="ltr"}){const i=o.length===0?0:Math.max(...o.map(e=>e.x))+1,A=k==="rtl",f=e=>`${e.x}-${e.y}`,O=new Map;a.forEach(e=>O.set(f(e),e));const S=new Map;c.forEach(e=>e.cells.forEach(s=>S.set(f(s),{word:e.word,cells:e.cells})));const V=e=>{const s=[],R=[...c.map(I=>I.cells),a];for(const I of R){const p=I.findIndex(u=>u.x===e.x&&u.y===e.y);if(p!==-1){if(p>0){const u=I[p-1];u.x===e.x-1&&u.y===e.y&&s.push("left"),u.x===e.x+1&&u.y===e.y&&s.push("right"),u.x===e.x&&u.y===e.y-1&&s.push("top"),u.x===e.x&&u.y===e.y+1&&s.push("bottom")}if(p<I.length-1){const u=I[p+1];u.x===e.x-1&&u.y===e.y&&s.push("left"),u.x===e.x+1&&u.y===e.y&&s.push("right"),u.x===e.x&&u.y===e.y-1&&s.push("top"),u.x===e.x&&u.y===e.y+1&&s.push("bottom")}}}return[...new Set(s)]},$=e=>{for(const s of c)if(s.cells.some(R=>R.x===e.x&&R.y===e.y)){const R=s.cells[0]?.color??s.cells.find(p=>p.color)?.color;if(R)return R;const I=o.find(p=>p.x===s.cells[0].x&&p.y===s.cells[0].y);return I?.color?I.color:xe(s.word)}if(a&&a.length>0&&a.some(s=>s.x===e.x&&s.y===e.y)){const s=a[0];if(s?.color)return s.color;const R=o.find(I=>I.x===s.x&&I.y===s.y);return R?.color?R.color:xe(s?.letter)}if(e.color)return e.color},g=e=>O.has(f(e)),m=e=>S.has(f(e));return v.jsx("div",{className:se("grid gap-1 mx-auto max-w-md",B,{"rtl-direction":A}),style:{gridTemplateColumns:`repeat(${i}, minmax(0, 1fr))`,direction:A?"rtl":"ltr",touchAction:"none"},children:o.map(e=>{const s=V(e),R=$(e),I=m(e)||e.letter!==""&&e.letter!==l&&e.isUsed;return v.jsx(Ge,{letter:e.letter,x:e.x,y:e.y,isSelected:g(e),isFound:m(e),isActive:l&&e.letter===l?!0:void 0,onMouseDown:y,onMouseEnter:b,onMouseUp:P,disabled:I,connectionDirections:s,connectionColor:R,cellColor:e.color},`${e.x}-${e.y}`)})})}function He({foundWords:o,t:a,className:c}){return o.length===0?null:v.jsxs("div",{className:se("mt-6",c),children:[v.jsxs("div",{className:"text-lg font-semibold mb-2",children:[a.selected,":"]}),v.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((l,y)=>v.jsx("div",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-md",children:l.word},y))})]})}function Ke({foundWords:o,totalWords:a,t:c,className:l}){const y=o.length/a;return v.jsxs("div",{className:se("mt-6 text-center",l),children:[v.jsxs("div",{className:"text-gray-600",children:[c.selected," ",o.length," ",c.of," ",a]}),v.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:v.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-500",style:{width:`${y*100}%`}})})]})}function qe(){w.useEffect(()=>{const o=EventTarget.prototype.addEventListener;return EventTarget.prototype.addEventListener=function(a,c,l){if((a==="touchmove"||a==="touchstart"||a==="touchend")&&typeof l=="object"&&l&&!("passive"in l)){const y={...l,passive:!1};return o.call(this,a,c,y)}return o.call(this,a,c,l)},()=>{EventTarget.prototype.addEventListener=o}},[])}const tt=()=>{const{t:o,i18n:a}=ye(),c=a.dir(),l=ke("letterFlow"),y=l?{title:l.title??"",description:l.description??"",steps:l.steps??[]}:void 0;qe();const{loading:b,currentLevel:P,board:B,selectedPath:k,foundWords:i,notification:A,gameState:f,activeLetter:O,handleBack:S,handleMouseDown:V,handleMouseEnter:$,handleMouseUp:g,onHint:m,onUndo:e,onReset:s,clearSelection:R,currentLevelIndex:I}=Be(),p=()=>v.jsx(ze,{cells:B,selectedPath:k,foundWords:i,activeLetter:O,onMouseDown:x=>V({...x,isUsed:!1}),onMouseEnter:x=>$({...x,isUsed:!1}),onMouseUp:g}),u=()=>i.length===0?null:v.jsx(He,{foundWords:i,t:{selected:o.selected}}),E=()=>{if(!A)return null;let x="info";return A.includes("congrats")||A===o.congrats?x="success":A.includes("Already found")||A.includes("cannot cross")?x="warning":(A.includes("must connect")||A.includes("horizontal or vertical"))&&(x="error"),v.jsx(Ve,{message:A,type:x})};if(b)return v.jsx("div",{className:`flex flex-col items-center justify-center min-h-screen ${c==="rtl"?"text-right":""}`,dir:c,children:v.jsxs("div",{className:"text-xl",children:[o.loading,"..."]})});if(!P)return v.jsxs("div",{className:`flex flex-col items-center justify-center min-h-screen ${c==="rtl"?"text-right":""}`,dir:c,children:[v.jsx("div",{className:"text-xl",children:o.noLevelsFound}),v.jsx("button",{onClick:S,className:"mt-4 btn",children:o.back})]});const M=Math.floor((P?.endpoints.length??0)/2);return v.jsxs(Se,{title:o.letterFlowTitle??P.id,levelIndex:I??0,onBack:S,difficulty:P.difficulty,layoutType:"text",instructions:y,children:[E(),v.jsx("div",{className:`mb-6 touch-none ${c==="rtl"?"arabic-layout":""} transition-colors duration-300`,dir:c,children:p()}),u(),v.jsx(Me,{onReset:s,onRemoveLetter:e,onClearAnswer:R,onHint:m,onNextLevel:void 0,onPrevLevel:void 0,onCheckAnswer:()=>{},onShowSolution:void 0,canRemove:i.length>0,canClear:k.length>0,canCheck:!1,canPrev:!!(I&&I>0),canNext:f==="won",canHint:i.length<M,hintsRemaining:void 0,gameState:f==="won"?"won":"playing",isKidsMode:!1,labels:{remove:o.undo,clear:o.clear,check:o.check,hint:o.hint,showSolution:o.showSolution,reset:o.reset,prev:o.prev,next:o.next},showOnly:["remove","hint","reset","next"]}),v.jsx(Ke,{foundWords:i,totalWords:M,t:{selected:o.selected,of:o.of}})]})};export{tt as default};
